{"version":3,"sources":["redux/actionTypes.js","redux/actions.js","models/soundtrack.js","models/story.ts","models/project.ts","models/image-asset.js","models/room.js","util/Vector2.js","models/hotspot.js","models/door.js","service/ProjectDeserializer.ts","models/storage/StorageProject.ts","models/storage/StorageStory.ts","models/storage/StorageRoom.ts","models/storage/StorageHotspot.ts","models/storage/StorageDoor.ts","models/storage/StorageImageAsset.ts","models/storage/StorageSoundtrack.ts","models/storage/StorageLocation.ts","service/ProjectSerializer.ts","firebase/firebase.ts","firebase/context.ts","components/user-profile/UserProfile.jsx","components/header/Header.jsx","components/dialogs/SignInDialog.jsx","service/ProjectArchiveCreator.ts","components/dialogs/ShareStoryDialog.jsx","components/landing-page/ProjectCard.jsx","components/landing-page/UserStoriesSection.jsx","components/landing-page/PublicStoriesSection.tsx","components/editor/EditorFileSelector.tsx","constants/constants.js","util/FileLoader.js","util/ResizeImage.js","service/ProjectArchiveLoader.ts","components/landing-page/LandingPageRoute.jsx","util/GetHotspotIconName.js","util/Vector3.js","util/IconPosition.js","components/editor/EditorAudioSelector.jsx","components/editor/EditorImageSelector.jsx","components/editor/EditorEditHotspot.jsx","components/editor/EditorHotspot.jsx","components/editor/EditorEditDoor.jsx","components/editor/EditorDoor.jsx","components/editor/EditorBackground.tsx","components/editor/EditorEditStory.jsx","components/editor/EditorHeader.jsx","components/editor/EditorFab.jsx","components/editor/EditorFooter.jsx","components/editor/EditorEditRoom.jsx","components/editor/EditorRoomCard.jsx","components/editor/EditorAddNewRoom.jsx","components/editor/EditorRoomsPanel.jsx","components/editor/EditorRoute.jsx","util/TextMaterialBuilder.js","util/GetImageFromData.js","aframe-components/Hotspot.jsx","aframe-components/Door.jsx","util/ImageLoader.js","aframe-components/Scene.jsx","components/viewer/ViewerRoute.jsx","app.jsx","redux/reducers/user.js","redux/reducers/display.js","redux/reducers/user-stories.js","redux/reducers/public-stories.js","redux/reducers/index.ts","redux/reducers/project.js","redux/store.js","aframe-components/aframe/Hotspot.js","aframe-components/aframe/PulsatingMarker.js","aframe-components/aframe/HiddenMarker.js","aframe-components/aframe/HotspotContent.js","aframe-components/aframe/DoorPulsatingMarker.js","aframe-components/aframe/Door.js","aframe-components/aframe/PreviewSpace.js","aframe-components/aframe/PlayOnce.js","index.tsx"],"names":["SET_USER","CLEAR_USER","SET_USER_DISPLAYNAME","SET_USER_STORIES","SET_PUBLIC_STORIES","SET_IS_SHOWING_SIGNIN_DIALOG","SET_STORY","SET_CURRENT_ROOM","ADD_HOTSPOT","ADD_DOOR","ADD_ROOM","SET_HOTSPOT_LOCATION","SET_STORY_NAME","SET_STORY_TAGS","SET_STORY_SOUNDTRACK","SET_PROJECT","UPDATE_DOOR","SET_ROOM_NAME","SET_ROOM_BACKGROUND","SET_HOTSPOT_NAME","SET_HOTSPOT_TEXT","SET_HOTSPOT_IMAGE","SET_HOTSPOT_AUDIO","SET_ROOM_BACKGROUND_MUSIC","SET_ROOM_BACKGROUND_NARRATION","SET_ROOM_IS_HOME","setUser","value","type","payload","setIsShowingSignInDialog","setProject","project","setStory","setCurrentRoom","room","addHotspot","hotspot","roomId","Soundtrack","data","name","this","id","uuid","fileName","extension","volume","loop","Story","soundtrack","tags","rooms","find","active","Project","isPublic","story","ImageAsset","preloaded","Room","isHome","panoramaUrl","backgroundImage","thumbnail","backgroundMusic","backgroundNarration","hotspots","doors","getRandomPosition","Math","random","Vector2","x","y","vector","a","b","sqrt","Hotspot","label","text","image","audio","location","Door","targetRoomId","ProjectDeserializer","downloadUrlsMap","Map","storageProject","getDownloadUrlsForProjectAssets","deserializeStoryData","storageStory","split","deserializeSoundtrackData","forEach","push","deserializeRoomData","storageRoom","deserializeImageAssetData","panorama","music","narration","deserializeHotspotData","door","deserializeDoorData","storageHotspot","deserializeLocationData","storageDoor","storageSoundtrack","get","storageImageAsset","imageAsset","storageLocation","promises","getDownloadUrlForAsset","remoteFilePath","Promise","all","assetId","firebase","getDownloadUrl","url","set","StorageProject","userId","StorageStory","StorageRoom","StorageHotspot","StorageDoor","StorageImageAsset","StorageSoundtrack","StorageLocation","ProjectSerializer","projectId","serializeProjectData","asset","serializeStoryData","join","serializeSoundtrackData","serializeRoomData","serializeImageAssetData","serializeHotspotData","serializeDoorData","serializeLocationData","getAssetRemoteFilePath","firebaseConfig","apiKey","authDomain","storageBucket","messagingSenderId","appId","measurementId","auth","firestore","storage","currentUser","onUserUpdatedObservers","signOut","loadUser","collection","doc","userSnapshot","exists","createUser","userData","user","_","cloneDeep","updateUser","merge","loadUserStories","storiesData","where","loadPublicStories","stories","storyModels","saveProject","projectSerializer","serialize","uid","JSON","parse","stringify","uploadPromises","uploadFileFromDataUrl","i","length","j","loadProject","projectDeserializer","deserialize","loadProjectWithId","updateProjectPublicFlag","update","uploadPath","fileData","ref","putString","StringFormat","DATA_URL","getDownloadURL","apps","initializeApp","onAuthStateChanged","map","observer","FirebaseContext","React","createContext","styles","makeStyles","signInButton","borderRadius","height","menuListItem","paddingTop","paddingBottom","textAlign","avatar","props","border","userColor","avatarInitialsOnly","backgroundColor","color","userDisplayName","marginTop","marginBottom","marginLeft","marginRight","userEmail","fontWeight","connect","state","userProp","setIsShowingSignInDialogProp","setUserProp","classes","firebaseContext","useContext","anchorRef","useRef","useState","open","setOpen","useEffect","authUser","isNil","handleClose","event","current","contains","target","handleListKeyDown","key","preventDefault","onSignOutClick","Button","className","variant","disableElevation","size","onClick","Typography","IconButton","aria-controls","undefined","aria-haspopup","prevOpen","Avatar","alt","displayName","src","Popper","anchorEl","role","transition","disablePortal","TransitionProps","placement","Grow","style","transformOrigin","Paper","ClickAwayListener","onClickAway","Box","email","Divider","MenuList","autoFocusItem","onKeyDown","MenuItem","theme","root","width","display","flexDirection","justifyContent","alignItems","infoButton","padding","infoButtonLogo","paddingRight","paddingLeft","infoButtonInfoIcon","divider","paper","spacing","colorPicker","menuList","Header","Container","maxWidth","orientation","flexItem","title","body","borderTop","button","emailForm","emailFormItem","minWidth","signUpButton","backButton","position","left","top","error","isShowingSignInDialog","setIsShowingSignInDialogAction","setUserAction","isShowingEmailForm","setIsShowingEmailForm","isShowingUseAsGuestForm","setIsShowingUseAsGuestForm","isShowingEmailSignupForm","setIsShowingEmailSignupForm","errorMessage","setErrorMessage","emailAddressInput","emailAddressSignupInput","passwordInput","passwordSignupInput","displayNameSignupInput","displayNameGuestInput","onClose","onGoogleSigninClick","provider","GoogleAuthProvider","signInWithPopup","authResult","photoURL","isGuest","onEmailSigninClick","querySelectorAll","password","signInWithEmailAndPassword","message","onEmailSignupClick","isEmpty","createUserWithEmailAndPassword","onContinueAsGuestClick","signInAnonymously","onBackClick","Dialog","aria-labelledby","DialogTitle","fullWidth","aria-label","noValidate","autoComplete","TextField","ProjectArchiveCreator","zip","JSZip","storeProjectData","generateAsync","zipFile","download","file","storeStoryData","storeAsset","storeRoomData","storeHotspotData","fetchRemoteAssetFileData","soundtrackData","base64","remotePath","resolve","xhr","XMLHttpRequest","onload","reader","FileReader","result","replace","readAsDataURL","response","responseType","send","contentRoot","titleContainer","closeIcon","storyInfoContainer","borderBottom","boxSizing","storyNameInfo","storyPublicInfo","storyRoomInfo","borderLeft","storyDialogThumbnailImage","backgroundPosition","backgroundSize","shareStoryPublicToggle","shareStoryPublicToggleText","publicStoryInfo","publicDataContainer","ShareStoryDialog","thumbnailUrl","publicLink","setPublicLink","projectIsPublic","setPublic","setQRCode","link","qrCodeCanvas","qrcode","toCanvas","initPublicLink","window","origin","useCallback","node","onPublicToggle","storyInfoIconName","Close","DialogContent","m","Switch","checked","onChange","align","copy","projectCardContainer","boxShadow","projectCardHeader","projectCardTitle","whiteSpace","textOverflow","overflow","cardActionsContainer","storyCardImageContainer","storyCardImage","storyCardOptions","setProjectAction","setStoryAction","setCurrentRoomAction","history","useHistory","setOptionsVisible","setThumbnailUrl","shareStoryDialogOpen","setShareStoryDialogOpen","firstRoom","getHomeRoom","onEditStory","projectModel","onViewStory","homeRoom","onDownloadStoryArchive","create","onMouseEnter","onMouseLeave","cursor","container","signInContent","placeholderImage","userStoriesSignedInContent","gridTemplateColumns","gridGap","userStories","setUserStoriesAction","then","showMoreContainer","seeMoreButton","mapDispatch","setPublicStoriesAction","connector","publicStories","input","dropZone","right","bottom","EditorFileSelector","children","imageInputElement","files","click","onDragOver","onDrop","dataTransfer","MIME_TYPE_JPEG","MIME_TYPE_MAP","video","FileLoaderUtil","acceptedFileType","reject","Error","indexOf","fileReader","onloadend","onerror","getNearestPowerOfTwo","Array","fill","index","power","distance","abs","sort","fitToMax","maxSize","SIZE_OPTIONS","projectThumbnail","hotspotImage","floor","getResizedImage","imageUrl","sizeOption","canvas","document","createElement","img","Image","crossOrigin","resizeDimensions","getX","getY","getContext","drawImage","toDataURL","resizeImageAsync","Object","keys","resizeList","ProjectArchiveLoader","loadAsync","loadProjectData","async","serializer","loadStoryData","loadAssetData","loadRoomData","loadHotspotData","mimeType","mime","contentType","blob","Blob","hero","palette","secondary","main","uploadButton","fontSize","uploadButtonContent","fileInput","processSelectedFile","loadStoryFromArchive","validateFileLoadEvent","getBinaryFileData","resizedImage","loader","load","getHotspotIconName","parts","z","normalizeAbsolutePosition","xRelative","innerWidth","yRelative","innerHeight","clamp","lowerBound","upperBound","max","min","getCoordinatePosition","r","radialDistance","locationX","locationY","theta","phi","cos","sin","Vector3","sphericalToCoordinate","PI","denormalizePosition","xAbsolute","yAbsolute","audioSelectorContainer","audioSelectorTitle","audioSelectorControls","audioSelectorFileName","audioSelectorIcon","audioSelectorPlayControls","audioSelectorVolumeControl","audioSelectorLoopControl","EditorAudioSelector","onPlayInLoopChange","onVolumeChange","onRemove","audioElement","audioData","setAudioData","setFileName","isPlaying","setIsPlaying","currentTime","setCurrentTime","duration","setDuration","addEventListener","setDurationCallback","setCurrentTimeCallback","play","pause","Slider","time","imageSelectorContainer","imageSelectorTitle","imageSelectorImagePreview","backgroundRepeat","optionsContainer","option","EditorImageSelector","removable","processSelectedImage","fileExtension","setHotspotNameAction","hotspotId","setHotspotTextAction","setHotspotImageAction","imageData","setHotspotAudioAction","onImageChange","helperText","multiline","rows","DialogActions","hotspotContainer","hotspotIconContainer","background","hotspotLabelContainer","updateHotspotAction","setPosition","editorOpen","setEditorOpen","hotspotElementRef","mouseOffset","mouseDownPosition","grabbed","getMousePositionOnScreen","mousePosition","clientX","clientY","touches","changedTouches","onMouseDown","hotspotContainerRect","getBoundingClientRect","onMouseMove","onMouseUp","hotspotCenter","mouseUpPosition","distanceTo","absolutePosition","removeEventListener","onTouchStart","onTouchEnd","draggable","updateDoorAction","FormControl","InputLabel","Select","labelId","doorContainer","doorIconContainer","doorLabelContainer","EditorDoor","targetRoomName","doorElementRef","doorContainerRect","doorCenter","addHotspotAction","onFileDropped","isFileOfType","getActiveRoom","activeRoom","setStoryNameAction","setStoryTagsAction","setStorySoundtrackAction","fileMimeType","zIndex","previewContainer","pointerEvents","toolBar","storyName","toolBarIcon","vrButton","primary","dark","editStoryOpen","setEditStoryOpen","saving","setSaving","onSaveStory","component","RouterLink","to","CircularProgress","vrButtonLogo","useStyles","speedDial","addDoorAction","actions","icon","targetRoom","SpeedDial","ariaLabel","SpeedDialIcon","onOpen","direction","action","SpeedDialAction","tooltipTitle","EditorFooter","homeInfoContainer","setRoomNameAction","setRoomIsHomeAction","setRoomBackgroundAction","setRoomBackgroundMusicAction","setRoomBackgroundNarrationAction","onBackgroundImageChange","roomInfoContainer","roomActionsContainer","roomInfo","roomItemsInfo","roomThumbnail","editRoomContainer","editIcon","hotspotCount","doorCount","editDialogOpen","setEditDialogOpen","borderColor","addRoomAction","onRoomPanoramaSelected","header","paginationControls","roomCards","flex","scrollPosition","roomCardsRef","expanded","setExpanded","scrollWidth","clientWidth","scroll","behavior","EditorRoute","TextLine","getTextureSizeFromText","textContext","drawCanvas","g2d","font","fillStyle","fillRect","textLines","context","lineHeight","lines","wordList","lineContent","word","proposedLine","measureText","trim","printWrappedText","fixedFontSize","textLine","fillText","getImageFromData","imageSrc","setImageSrc","imageWidth","setImageWidth","imageHeight","setImageHeight","setupAssets","isAudioOnly","assets","hasImageContent","Boolean","hasTextContent","textSize","adjustedHeight","canvasContext","imgWidth","imgHeight","adjustedWidth","textCanvas","textCanvasContext","imageSize","class","geometry","material","scale","look-at","pulsating-marker","animation__pulsation","alpha-test","animation__scale-in","animation__scale-out","hidden-marker","opacity","animation__fade-in","animation__fade-out","visible","hotspot-content","sound","params","door-pulsating-marker","loadImageForRoom","dataURL","enterVRContainer","sceneRef","skyRef","e","goToRoom","detail","emit","preview-space","device-orientation-permission-ui","loading-screen","vr-mode-ui","wasd-controls-enabled","look-controls-enabled","fov","animation__zoom-in","zoom","near","autoplay","radius","backButtonContainer","projectLoaded","setProjectLoaded","useParams","setHomeRoomAsCurrent","documentElement","classList","remove","goBack","App","useMemo","createMuiTheme","light","typography","fontFamily","textTransform","h1","fontStyle","h2","body1","body2","ThemeProvider","CssBaseline","path","ViewerRoute","LandingPageRoute","initialState","combineReducers","$set","$push","currentRoom","doorRoom","currentRoomIndex","createStore","rootReducer","AFRAME","registerComponent","schema","coordinates","val","parseInt","hideHotspot","el","setAttribute","showHotspot","showOtherHotspots","sceneEl","hideOtherHotspots","showHotspotName","hotspotName","console","log","hideHotspotName","init","contentIsActive","object3D","centerTrigger","querySelector","outerTrigger","contentZoneTrigger","hotspotContent","hiddenMarker","pulsatingMarker","bind","setTimeout","scaleIn","scaleOut","pulsatingHotspot","vectorFrom","getAttribute","clone","fadeIn","fadeOut","animationScaleOut","property","from","startEvents","pauseEvents","easing","animationScaleIn","soundElement","imageElement","showContent","hideContent","components","playSound","stopSound","autoTime","hideDoorway","showDoorway","inTransitionProcess","centerDoorwayTrigger","outerDoorwayTrigger","doorwayPulsatingMarker","camera","countdown","enterVR","switchRoom","pauseSound","zoomCamera","resetCamera","onceAudio","pool","offset","ReactDOM","render","StrictMode","store","Provider","getElementById"],"mappings":"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","file":"static/js/main.8dc3c507.chunk.js","sourcesContent":["// User\nexport const SET_USER = 'SET_USER';\nexport const CLEAR_USER = 'CLEAR_USER';\nexport const SET_USER_DISPLAYNAME = 'SET_USER_DISPLAYNAME';\n\n// User Stories\nexport const SET_USER_STORIES = 'SET_USER_STORIES';\n\n// Public Stories\nexport const SET_PUBLIC_STORIES = 'SET_PUBLIC_STORIES';\n\n// Display\nexport const SET_IS_SHOWING_SIGNIN_DIALOG = 'SET_IS_SHOWING_SIGNIN_DIALOG';\n\n// Story\nexport const SET_STORY = 'SET_STORY';\nexport const SET_CURRENT_ROOM = 'SET_CURRENT_ROOM';\nexport const ADD_HOTSPOT = 'ADD_HOTSPOT';\nexport const ADD_DOOR = 'ADD_DOOR';\nexport const ADD_ROOM = 'ADD_ROOM';\nexport const SET_HOTSPOT_LOCATION = 'SET_HOTSPOT_LOCATION';\nexport const SET_STORY_NAME = 'SET_STORY_NAME';\nexport const SET_STORY_TAGS = 'SET_STORY_TAGS';\nexport const SET_STORY_SOUNDTRACK = 'SET_STORY_SOUNDTRACK';\nexport const SET_PROJECT = 'SET_PROJECT';\nexport const UPDATE_DOOR = 'UPDATE_DOOR';\nexport const SET_ROOM_NAME = 'SET_ROOM_NAME';\nexport const SET_ROOM_BACKGROUND = 'SET_ROOM_BACKGROUND';\nexport const SET_HOTSPOT_NAME = 'SET_HOTSPOT_NAME';\nexport const SET_HOTSPOT_TEXT = 'SET_HOTSPOT_TEXT';\nexport const SET_HOTSPOT_IMAGE = 'SET_HOTSPOT_IMAGE';\nexport const SET_HOTSPOT_AUDIO = 'SET_HOTSPOT_AUDIO';\nexport const SET_ROOM_BACKGROUND_MUSIC = 'SET_ROOM_BACKGROUND_MUSIC';\nexport const SET_ROOM_BACKGROUND_NARRATION = 'SET_ROOM_BACKGROUND_NARRATION';\nexport const SET_ROOM_IS_HOME = 'SET_ROOM_IS_HOME';\n","import {\n    SET_CURRENT_ROOM,\n    SET_IS_SHOWING_SIGNIN_DIALOG,\n    SET_PUBLIC_STORIES,\n    SET_STORY,\n    SET_USER,\n    SET_USER_DISPLAYNAME,\n    SET_USER_STORIES,\n    ADD_HOTSPOT,\n    ADD_ROOM,\n    SET_HOTSPOT_LOCATION,\n    ADD_DOOR,\n    SET_STORY_NAME,\n    SET_STORY_TAGS,\n    SET_STORY_SOUNDTRACK,\n    SET_PROJECT,\n    UPDATE_DOOR,\n    SET_ROOM_NAME,\n    SET_ROOM_BACKGROUND,\n    SET_HOTSPOT_NAME,\n    SET_HOTSPOT_TEXT,\n    SET_HOTSPOT_IMAGE,\n    SET_HOTSPOT_AUDIO,\n    SET_ROOM_BACKGROUND_MUSIC,\n    SET_ROOM_BACKGROUND_NARRATION,\n    SET_ROOM_IS_HOME,\n} from './actionTypes';\n\n// User\nexport const setUser = (value) => {\n    return {\n        type: SET_USER,\n        payload: {\n            value: value,\n        },\n    };\n};\nexport const setUserDisplayName = (value) => {\n    return {\n        type: SET_USER_DISPLAYNAME,\n        payload: {\n            value: value,\n        },\n    };\n};\n\n// User stories\nexport const setUserStories = (value) => {\n    return {\n        type: SET_USER_STORIES,\n        payload: {\n            value: value,\n        },\n    };\n};\n\n// Public stories\nexport const setPublicStories = (value) => {\n    return {\n        type: SET_PUBLIC_STORIES,\n        payload: {\n            value: value,\n        },\n    };\n};\n\n// Display\nexport const setIsShowingSignInDialog = (value) => {\n    return {\n        type: SET_IS_SHOWING_SIGNIN_DIALOG,\n        payload: {\n            value: value,\n        },\n    };\n};\n\n// Project\nexport const setProject = (project) => {\n    return {\n        type: SET_PROJECT,\n        payload: {\n            project: project,\n        },\n    };\n};\nexport const setStory = (value) => {\n    return {\n        type: SET_STORY,\n        payload: {\n            value: value,\n        },\n    };\n};\nexport const setCurrentRoom = (room) => {\n    return {\n        type: SET_CURRENT_ROOM,\n        payload: {\n            room: room,\n        },\n    };\n};\nexport const addHotspot = (hotspot, roomId) => {\n    return {\n        type: ADD_HOTSPOT,\n        payload: {\n            hotspot: hotspot,\n            roomId: roomId,\n        },\n    };\n};\nexport const addDoor = (door, roomId) => {\n    return {\n        type: ADD_DOOR,\n        payload: {\n            door: door,\n            roomId: roomId,\n        },\n    };\n};\nexport const addRoom = (room) => {\n    return {\n        type: ADD_ROOM,\n        payload: {\n            room: room,\n        },\n    };\n};\nexport const updateHotspot = (hotspot) => {\n    return {\n        type: SET_HOTSPOT_LOCATION,\n        payload: {\n            hotspot: hotspot,\n        },\n    };\n};\nexport const setStoryName = (name) => {\n    return {\n        type: SET_STORY_NAME,\n        payload: {\n            name: name,\n        },\n    };\n};\nexport const setStoryTags = (tags) => {\n    return {\n        type: SET_STORY_TAGS,\n        payload: {\n            tags: tags,\n        },\n    };\n};\nexport const setStorySoundtrack = (soundtrack) => {\n    return {\n        type: SET_STORY_SOUNDTRACK,\n        payload: {\n            soundtrack: soundtrack,\n        },\n    };\n};\nexport const updateDoor = (door) => {\n    return {\n        type: UPDATE_DOOR,\n        payload: {\n            door: door,\n        },\n    };\n};\nexport const setRoomName = (roomId, name) => {\n    return {\n        type: SET_ROOM_NAME,\n        payload: {\n            roomId: roomId,\n            name: name,\n        },\n    };\n};\nexport const setRoomBackground = (roomId, background, thumbnail) => {\n    return {\n        type: SET_ROOM_BACKGROUND,\n        payload: {\n            roomId: roomId,\n            background: background,\n            thumbnail: thumbnail,\n        },\n    };\n};\nexport const setHotspotName = (hotspotId, name) => {\n    return {\n        type: SET_HOTSPOT_NAME,\n        payload: {\n            hotspotId: hotspotId,\n            name: name,\n        },\n    };\n};\nexport const setHotspotText = (hotspotId, text) => {\n    return {\n        type: SET_HOTSPOT_TEXT,\n        payload: {\n            hotspotId: hotspotId,\n            text: text,\n        },\n    };\n};\nexport const setHotspotImage = (hotspotId, imageData, extension) => {\n    return {\n        type: SET_HOTSPOT_IMAGE,\n        payload: {\n            hotspotId: hotspotId,\n            imageData: imageData,\n            extension: extension,\n        },\n    };\n};\nexport const setHotspotAudio = (hotspotId, data, name, extension, loop, volume) => {\n    return {\n        type: SET_HOTSPOT_AUDIO,\n        payload: {\n            hotspotId: hotspotId,\n            data: data,\n            name: name,\n            extension: extension,\n            loop: loop,\n            volume: volume,\n        },\n    };\n};\nexport const setRoomBackgroundMusic = (roomId, data, name, extension, loop, volume) => {\n    return {\n        type: SET_ROOM_BACKGROUND_MUSIC,\n        payload: {\n            roomId: roomId,\n            data: data,\n            name: name,\n            extension: extension,\n            loop: loop,\n            volume: volume,\n        },\n    };\n};\nexport const setRoomBackgroundNarration = (roomId, data, name, extension, loop, volume) => {\n    return {\n        type: SET_ROOM_BACKGROUND_NARRATION,\n        payload: {\n            roomId: roomId,\n            data: data,\n            name: name,\n            extension: extension,\n            loop: loop,\n            volume: volume\n        },\n    };\n};\nexport const setRoomIsHome = (roomId, isHome) => {\n    return {\n        type: SET_ROOM_IS_HOME,\n        payload: {\n            roomId: roomId,\n            isHome: isHome,\n        }\n    }\n}\n","import { v1 as uuid } from 'uuid';\n\nexport default class Soundtrack {\n    constructor(data, name) {\n        this.id = uuid();\n        this.data = data;\n        this.fileName = name;\n        this.extension = '';\n        this.volume = 0.5;\n        this.loop = false;\n    }\n}\n","// Models\nimport Room from './room';\nimport Soundtrack from './soundtrack';\n\nexport default class Story {\n    public name = 'My Story';\n    public soundtrack = new Soundtrack();\n    public tags: string[] = [];\n    public rooms: Room[] = [];\n\n    getActiveRoom(): Room {\n        return this.rooms.find((room) => {\n            return room.active;\n        });\n    }\n}\n","// External libraries\nimport { v1 as uuid } from 'uuid';\n\n// Models\nimport Story from './story';\n\nexport default class Project {\n    public id = uuid();\n    public isPublic = false;\n    public story = new Story();\n}\n","import { v1 as uuid } from 'uuid';\n\nexport default class ImageAsset {\n    constructor(data) {\n        this.id = uuid();\n        this.data = data;\n        this.extension = '';\n        this.preloaded = false;\n    }\n}\n","import { v1 as uuid } from 'uuid';\n\nimport ImageAsset from './image-asset';\nimport Soundtrack from './soundtrack';\n\nexport default class Room {\n    constructor() {\n        this.id = uuid();\n        this.name = 'New Room';\n        this.active = false;\n        this.isHome = false;\n        this.panoramaUrl = {\n            backgroundImage: new ImageAsset(),\n            thumbnail: new ImageAsset(),\n        };\n        this.backgroundMusic = new Soundtrack();\n        this.backgroundNarration = new Soundtrack();\n        this.hotspots = [];\n        this.doors = [];\n    }\n}\n","const LOCATION_JITTER = 10;\n\nfunction getPosNeg() {\n    return Math.random() > 0.5 ? -1 : 1;\n}\n\nfunction getRandomPosition() {\n    return getPosNeg() * LOCATION_JITTER * Math.random();\n}\n\nexport default class Vector2 {\n    constructor(x, y) {\n        this.x = x;\n        this.y = y;\n    }\n\n    static build() {\n        const x = 180 + getRandomPosition();\n        const y = getRandomPosition();\n        return new Vector2(x, y);\n    }\n\n    getX() {\n        return this.x;\n    }\n\n    setX(x) {\n        this.x = x;\n    }\n\n    getY() {\n        return this.y;\n    }\n\n    setY(y) {\n        this.y = y;\n    }\n\n    setPosition(x, y) {\n        this.x = x;\n        this.y = y;\n    }\n\n    toString() {\n        return `<${this.x},${this.y}>`;\n    }\n\n    distanceTo(vector) {\n        const a = this.x - vector.x;\n        const b = this.y - vector.y;\n\n        return Math.sqrt(a * a + b * b);\n    }\n}\n","// External libraries\nimport { v1 as uuid } from 'uuid';\n\n// Util\nimport Vector2 from '../util/Vector2';\n\n// Models\nimport ImageAsset from './image-asset';\nimport Soundtrack from './soundtrack';\n\nexport default class Hotspot {\n    constructor() {\n        this.id = uuid();\n        this.label = 'Hotspot';\n        this.text = '';\n        this.image = new ImageAsset();\n        this.audio = new Soundtrack();\n        this.location = new Vector2();\n    }\n}\n","// External libraries\nimport { v1 as uuid } from 'uuid';\n\n// Util\nimport Vector2 from '../util/Vector2';\n\nexport default class Door {\n    constructor() {\n        this.id = uuid();\n        this.label = 'Door';\n        this.targetRoomId = '';\n        this.location = new Vector2();\n    }\n}\n","// Models\nimport Project from \"../models/project\";\nimport Story from \"../models/story\";\nimport Room from \"../models/room\";\nimport Soundtrack from \"../models/soundtrack\";\n\n// Models - Storage\nimport StorageProject from \"../models/storage/StorageProject\";\nimport StorageStory from \"../models/storage/StorageStory\";\nimport StorageSoundtrack from \"../models/storage/StorageSoundtrack\";\nimport StorageRoom from \"../models/storage/StorageRoom\";\n\n// Firebase\nimport firebase from '../firebase/firebase';\nimport StorageImageAsset from \"../models/storage/StorageImageAsset\";\nimport ImageAsset from \"../models/image-asset\";\nimport StorageHotspot from \"../models/storage/StorageHotspot\";\nimport Hotspot from \"../models/hotspot\";\nimport StorageLocation from \"../models/storage/StorageLocation\";\nimport Vector2 from \"../util/Vector2\";\nimport StorageDoor from \"../models/storage/StorageDoor\";\nimport Door from \"../models/door\";\n\nexport default class ProjectDeserializer {\n    private downloadUrlsMap = new Map<string, string>();\n\n    public async deserialize(storageProject: StorageProject): Promise<Project> {\n        await this.getDownloadUrlsForProjectAssets(storageProject);\n\n        const project = new Project();\n\n        project.id = storageProject.id;\n        project.isPublic = storageProject.isPublic;\n        project.story = this.deserializeStoryData(storageProject.story);\n\n        return project;\n    }\n\n    private deserializeStoryData(storageStory: StorageStory): Story {\n        const story = new Story();\n\n        story.name = storageStory.name;\n        story.tags = storageStory.tags ? storageStory.tags.split(',') : [];\n        if (storageStory.soundtrack) {\n            story.soundtrack = this.deserializeSoundtrackData(storageStory.soundtrack);\n        }\n\n        storageStory.rooms.forEach((room) => {\n            story.rooms.push(this.deserializeRoomData(room));\n        });\n\n        return story;\n    }\n\n    private deserializeRoomData(storageRoom: StorageRoom): Room {\n        const room = new Room();\n\n        room.id = storageRoom.id;\n        room.name = storageRoom.name;\n        room.isHome = storageRoom.isHome;\n        room.panoramaUrl.backgroundImage = this.deserializeImageAssetData(storageRoom.panorama);\n        room.panoramaUrl.thumbnail = this.deserializeImageAssetData(storageRoom.thumbnail);\n        if (storageRoom.music) {\n            room.backgroundMusic = this.deserializeSoundtrackData(storageRoom.music);\n        }\n        if (storageRoom.narration) {\n            room.backgroundNarration = this.deserializeSoundtrackData(storageRoom.narration);\n        }\n\n        storageRoom.hotspots.forEach((hotspot) => {\n            room.hotspots.push(this.deserializeHotspotData(hotspot));\n        });\n        storageRoom.doors.forEach((door) => {\n            room.doors.push(this.deserializeDoorData(door));\n        });\n\n        return room;\n    }\n\n    private deserializeHotspotData(storageHotspot: StorageHotspot): Hotspot {\n        const hotspot = new Hotspot();\n\n        hotspot.id = storageHotspot.id;\n        hotspot.label = storageHotspot.label;\n        hotspot.text = storageHotspot.text;\n        hotspot.location = this.deserializeLocationData(storageHotspot.location);\n        if (storageHotspot.image) {\n            hotspot.image = this.deserializeImageAssetData(storageHotspot.image);\n        }\n        if (storageHotspot.audio) {\n            hotspot.audio = this.deserializeSoundtrackData(storageHotspot.audio);\n        }\n\n        return hotspot;\n    }\n\n    private deserializeDoorData(storageDoor: StorageDoor): Door {\n        const door = new Door();\n\n        door.id = storageDoor.id;\n        door.label = storageDoor.label;\n        door.targetRoomId = storageDoor.targetRoomId;\n        door.location = this.deserializeLocationData(storageDoor.location);\n\n        return door;\n    }\n\n    private deserializeSoundtrackData(storageSoundtrack: StorageSoundtrack): Soundtrack {\n        const soundtrack = new Soundtrack();\n\n        soundtrack.id = storageSoundtrack.id;\n        soundtrack.fileName = storageSoundtrack.fileName;\n        soundtrack.extension = storageSoundtrack.extension;\n        soundtrack.volume = storageSoundtrack.volume;\n        soundtrack.data = this.downloadUrlsMap.get(storageSoundtrack.id);\n\n        return soundtrack;\n    }\n\n    private deserializeImageAssetData(storageImageAsset: StorageImageAsset): ImageAsset {\n        const imageAsset = new ImageAsset();\n\n        imageAsset.id = storageImageAsset.id;\n        imageAsset.extension = storageImageAsset.extension;\n        imageAsset.data = this.downloadUrlsMap.get(storageImageAsset.id);\n\n        return imageAsset;\n    }\n\n    private deserializeLocationData(storageLocation: StorageLocation): Vector2 {\n        return new Vector2(storageLocation.x, storageLocation.y);\n    }\n\n    private async getDownloadUrlsForProjectAssets(project: StorageProject) {\n        const promises = [];\n\n        const story = project.story;\n        if (story.soundtrack) {\n            promises.push(this.getDownloadUrlForAsset(story.soundtrack.remoteFilePath, story.soundtrack.id));\n        }\n\n        const rooms = story.rooms;\n        rooms.forEach((room) => {\n            promises.push(this.getDownloadUrlForAsset(room.panorama.remoteFilePath, room.panorama.id));\n            promises.push(this.getDownloadUrlForAsset(room.thumbnail.remoteFilePath, room.thumbnail.id));\n            if (room.music) {\n                promises.push(this.getDownloadUrlForAsset(room.music.remoteFilePath, room.music.id));\n            }\n            if (room.narration) {\n                promises.push(this.getDownloadUrlForAsset(room.narration.remoteFilePath, room.narration.id));\n            }\n\n            room.hotspots.forEach((hotspot) => {\n                if (hotspot.image) {\n                    promises.push(this.getDownloadUrlForAsset(hotspot.image.remoteFilePath, hotspot.image.id));\n                }\n                if (hotspot.audio) {\n                    promises.push(this.getDownloadUrlForAsset(hotspot.audio.remoteFilePath, hotspot.audio.id));\n                }\n            });\n        });\n\n        await Promise.all(promises);\n    }\n\n    private async getDownloadUrlForAsset(remoteFilePath: string, assetId: string) {\n        const url = await firebase.getDownloadUrl(remoteFilePath);\n\n        this.downloadUrlsMap.set(assetId, url);\n    }\n}\n","// Models - Storage\nimport StorageStory from './StorageStory';\n\nexport default class StorageProject {\n    public id: string;\n    public isPublic: boolean;\n    public userId: string;\n    public story: StorageStory;\n}\n","// Models - Storage\nimport StorageSoundtrack from './StorageSoundtrack';\nimport StorageRoom from './StorageRoom';\n\nexport default class StorageStory {\n    public name: string;\n    public tags: string;\n    public soundtrack: StorageSoundtrack;\n    public rooms: StorageRoom[] = [];\n}\n","// Models - Storage\nimport StorageImageAsset from \"./StorageImageAsset\";\nimport StorageSoundtrack from \"./StorageSoundtrack\";\nimport StorageHotspot from \"./StorageHotspot\";\nimport StorageDoor from \"./StorageDoor\";\n\nexport default class StorageRoom {\n    public id: string;\n    public name: string;\n    public isHome: boolean;\n    public panorama: StorageImageAsset;\n    public thumbnail: StorageImageAsset;\n    public music: StorageSoundtrack;\n    public narration: StorageSoundtrack;\n    public hotspots: StorageHotspot[] = [];\n    public doors: StorageDoor[] = [];\n}\n","// Models - Storage\nimport StorageImageAsset from \"./StorageImageAsset\";\nimport StorageLocation from \"./StorageLocation\";\nimport StorageSoundtrack from \"./StorageSoundtrack\";\n\nexport default class StorageHotspot {\n    public id: string;\n    public label: string;\n    public text: string;\n    public image: StorageImageAsset;\n    public audio: StorageSoundtrack;\n    public location: StorageLocation;\n}\n","// Models - Storage\nimport StorageLocation from \"./StorageLocation\";\n\nexport default class StorageDoor {\n    public id: string;\n    public label: string;\n    public targetRoomId: string;\n    public location: StorageLocation;\n}\n","export default class StorageImageAsset {\n    public id: string;\n    public remoteFilePath: string;\n    public extension: string;\n}\n","export default class StorageSoundtrack {\n    public id: string;\n    public remoteFilePath: string;\n    public fileName: string;\n    public extension: string;\n    public volume: number;\n    public loop: boolean;\n}\n","export default class StorageLocation {\n    public x: number;\n    public y: number;\n}\n","// Models\nimport Project from \"../models/project\";\nimport Story from \"../models/story\";\nimport Room from \"../models/room\";\nimport Hotspot from \"../models/hotspot\";\nimport Door from \"../models/door\";\nimport ImageAsset from \"../models/image-asset\";\nimport Soundtrack from \"../models/soundtrack\";\n\n// Models - Storage\nimport StorageProject from \"../models/storage/StorageProject\";\nimport StorageStory from \"../models/storage/StorageStory\";\nimport StorageRoom from \"../models/storage/StorageRoom\";\nimport StorageHotspot from \"../models/storage/StorageHotspot\";\nimport StorageDoor from \"../models/storage/StorageDoor\";\nimport StorageImageAsset from \"../models/storage/StorageImageAsset\";\nimport StorageSoundtrack from \"../models/storage/StorageSoundtrack\";\n\n// Util\nimport Vector2 from \"../util/Vector2\";\nimport StorageLocation from \"../models/storage/StorageLocation\";\n\nexport default class ProjectSerializer {\n    private projectId: string;\n    private userId: string;\n\n    public serialize(project: Project, userId: string): StorageProject {\n        this.projectId = project.id;\n        this.userId = userId;\n\n        return this.serializeProjectData(project);\n    }\n\n    public getAssetRemoteFilePath(asset: ImageAsset | Soundtrack): string {\n        return `projects/${this.projectId}/asset-${asset.id}.${asset.extension}`\n    }\n\n    private serializeProjectData(project: Project): StorageProject {\n        const storageProject = new StorageProject();\n\n        storageProject.id = project.id;\n        storageProject.isPublic = project.isPublic;\n        storageProject.userId = this.userId;\n        storageProject.story = this.serializeStoryData(project.story);\n\n        return storageProject;\n    }\n\n    private serializeStoryData(story: Story): StorageStory {\n        const storageStory = new StorageStory();\n\n        storageStory.name = story.name;\n        storageStory.tags = story.tags.join(',');\n\n        if (story.soundtrack.data) {\n            storageStory.soundtrack = this.serializeSoundtrackData(story.soundtrack);\n        }\n\n        story.rooms.forEach((room) => {\n            storageStory.rooms.push(this.serializeRoomData(room));\n        });\n\n        return storageStory;\n    }\n\n    private serializeRoomData(room: Room): StorageRoom {\n        const storageRoom = new StorageRoom();\n\n        storageRoom.id = room.id;\n        storageRoom.name = room.name;\n        storageRoom.isHome = room.isHome;\n        storageRoom.panorama = this.serializeImageAssetData(room.panoramaUrl.backgroundImage);\n        storageRoom.thumbnail = this.serializeImageAssetData(room.panoramaUrl.thumbnail);\n        if (room.backgroundMusic.data) {\n            storageRoom.music = this.serializeSoundtrackData(room.backgroundMusic);\n        }\n        if (room.backgroundNarration.data) {\n            storageRoom.narration = this.serializeSoundtrackData(room.backgroundNarration);\n        }\n\n        room.hotspots.forEach((hotspot) => {\n            storageRoom.hotspots.push(this.serializeHotspotData(hotspot));\n        });\n\n        room.doors.forEach((door) => {\n            storageRoom.doors.push(this.serializeDoorData(door));\n        });\n\n        return storageRoom;\n    }\n\n    private serializeHotspotData(hotspot: Hotspot): StorageHotspot {\n        const storageHotspot = new StorageHotspot();\n\n        storageHotspot.id = hotspot.id;\n        storageHotspot.label = hotspot.label;\n        storageHotspot.text = hotspot.text;\n        storageHotspot.location = this.serializeLocationData(hotspot.location);\n        if (hotspot.image.data) {\n            storageHotspot.image = this.serializeImageAssetData(hotspot.image);\n        }\n        if (hotspot.audio.data) {\n            storageHotspot.audio = this.serializeSoundtrackData(hotspot.audio);\n        }\n\n        return storageHotspot;\n    }\n\n    private serializeDoorData(door: Door): StorageDoor {\n        const storageDoor = new StorageDoor();\n\n        storageDoor.id = door.id;\n        storageDoor.label = door.label;\n        storageDoor.targetRoomId = door.targetRoomId;\n        storageDoor.location = this.serializeLocationData(door.location);\n\n        return storageDoor;\n    }\n\n    private serializeImageAssetData(imageAsset: ImageAsset): StorageImageAsset {\n        const storageImageAsset = new StorageImageAsset();\n\n        storageImageAsset.id = imageAsset.id;\n        storageImageAsset.extension = imageAsset.extension;\n        storageImageAsset.remoteFilePath = this.getAssetRemoteFilePath(imageAsset);\n\n        return storageImageAsset;\n    }\n\n    private serializeSoundtrackData(soundtrack: Soundtrack): StorageSoundtrack {\n        const storageSoundtrack = new StorageSoundtrack();\n\n        storageSoundtrack.id = soundtrack.id;\n        storageSoundtrack.fileName = soundtrack.fileName;\n        storageSoundtrack.extension = soundtrack.extension;\n        storageSoundtrack.volume = soundtrack.volume;\n        storageSoundtrack.remoteFilePath = this.getAssetRemoteFilePath(soundtrack);\n\n        return storageSoundtrack;\n    }\n\n    private serializeLocationData(location: Vector2): StorageLocation {\n        const storageLocation = new StorageLocation();\n\n        storageLocation.x = location.x;\n        storageLocation.y = location.y;\n\n        return storageLocation;\n    }\n}\n","\nimport firebase from 'firebase/app';\nimport 'firebase/auth';\nimport 'firebase/firestore';\nimport 'firebase/storage';\nimport _ from 'lodash';\nimport Project from '../models/project';\nimport StorageProject from '../models/storage/StorageProject';\nimport User from '../models/user';\nimport ProjectDeserializer from '../service/ProjectDeserializer';\nimport ProjectSerializer from '../service/ProjectSerializer';\n\nconst firebaseConfig = {\n    apiKey: 'AIzaSyDedbwugU4axXQG20TPK63RCBWqMVdc3hA',\n    authDomain: 'simplevr-stage.firebaseapp.com',\n    projectId: 'simplevr-stage',\n    storageBucket: 'simplevr-stage.appspot.com',\n    messagingSenderId: '13689155429',\n    appId: '1:13689155429:web:f362fa80462b5b88e87b8c',\n    measurementId: 'G-9TNR7X5YDJ',\n};\n\nclass Firebase {\n    private auth: firebase.auth.Auth;\n    private firestore: firebase.firestore.Firestore;\n    private storage: firebase.storage.Storage;\n\n    private currentUser: firebase.User;\n    private onUserUpdatedObservers: Array<(user: firebase.User) => void> = [];\n\n    constructor() {\n        if (!firebase.apps.length) {\n            firebase.initializeApp(firebaseConfig);\n        }\n\n        this.auth = firebase.auth();\n        this.firestore = firebase.firestore();\n        this.storage = firebase.storage();\n\n        firebase.auth().onAuthStateChanged((user) => {\n            // console.log('onAuthStateChanged', user);\n            if (user) {\n                this.currentUser = user;\n                this.onUserUpdatedObservers.map((observer) => {\n                    return observer(user);\n                });\n            } else {\n                // No user is signed in.\n                this.currentUser = null;\n                this.onUserUpdatedObservers.map((observer) => {\n                    return observer(null);\n                });\n            }\n        });\n    }\n\n    public signOut = () => {\n        this.auth.signOut();\n    }\n\n    // User\n    public loadUser = async (id: string) => {\n        const userSnapshot = await this.firestore.collection('users').doc(id).get();\n        if (userSnapshot.exists) {\n            return { id: userSnapshot.id, ...userSnapshot.data() };\n        }\n        return null;\n    }\n\n    public createUser = async (userData: User) => {\n        const user = _.cloneDeep(userData);\n        delete user.id;\n\n        await this.firestore.collection('users')\n            .doc(userData.id)\n            .set(user);\n    }\n\n    private updateUser = async (id: string, userData: User) => {\n        const user = _.cloneDeep(userData);\n        delete user.id;\n\n        await this.firestore.collection('users')\n            .doc(id)\n            .set(user, { merge: true });\n    }\n\n    loadUserStories = async (userId: string) => {\n        const storiesData: Project[] = [];\n\n        const stories = await this.firestore\n            .collection('projects')\n            .where('userId', '==', userId)\n            .get();\n\n        stories.forEach((story) => {\n            storiesData.push(story.data() as Project);\n        });\n\n        return storiesData;\n    }\n\n    loadPublicStories = async () => {\n        const stories = await this.firestore\n            .collection('projects')\n            .where('isPublic', '==', true)\n            .get();\n\n        const storyModels: Project[] = [];\n        stories.forEach((story) => {\n            storyModels.push(story.data() as Project);\n        });\n        return storyModels;\n    }\n\n    saveProject = async (project: Project) => {\n        const projectSerializer = new ProjectSerializer();\n        const storageProject = projectSerializer.serialize(project, this.currentUser.uid);\n\n        // Save story data in Firebase Firestore\n        await this.firestore.collection('projects')\n            .doc(project.id)\n            // Firestore does not accept custom objects, so we need to use this method to get pure JS object\n            .set(JSON.parse(JSON.stringify(storageProject)), { merge: true });\n\n        const uploadPromises = [];\n\n        // Save story soundtrack data in Firebase Storage\n        if (project.story.soundtrack.data) {\n            uploadPromises.push(this.uploadFileFromDataUrl(projectSerializer.getAssetRemoteFilePath(project.story.soundtrack), project.story.soundtrack.data));\n        }\n\n        // Save story rooms data in Firebase Storage\n        for (let i = 0; i < project.story.rooms.length; i += 1) {\n            const room = project.story.rooms[i];\n\n            uploadPromises.push(this.uploadFileFromDataUrl(projectSerializer.getAssetRemoteFilePath(room.panoramaUrl.backgroundImage), room.panoramaUrl.backgroundImage.data));\n            uploadPromises.push(this.uploadFileFromDataUrl(projectSerializer.getAssetRemoteFilePath(room.panoramaUrl.thumbnail), room.panoramaUrl.thumbnail.data));\n            uploadPromises.push(this.uploadFileFromDataUrl(projectSerializer.getAssetRemoteFilePath(room.backgroundMusic), room.backgroundMusic.data));\n            uploadPromises.push(this.uploadFileFromDataUrl(projectSerializer.getAssetRemoteFilePath(room.backgroundNarration), room.backgroundNarration.data));\n\n            // Save room hotspots data in Firebase storage\n            for (let j = 0; j < room.hotspots.length; j++) {\n                const hotspot = room.hotspots[j];\n\n                uploadPromises.push(this.uploadFileFromDataUrl(projectSerializer.getAssetRemoteFilePath(hotspot.image), hotspot.image.data));\n                uploadPromises.push(this.uploadFileFromDataUrl(projectSerializer.getAssetRemoteFilePath(hotspot.audio), hotspot.audio.data));\n            }\n        }\n\n        await Promise.all(uploadPromises);\n    }\n\n    loadProject = async (storageProject: StorageProject): Promise<Project> => {\n        const projectDeserializer = new ProjectDeserializer();\n\n        return await projectDeserializer.deserialize(storageProject);\n    }\n\n    loadProjectWithId = async (projectId: string) => {\n        const project = await this.firestore\n            .collection('projects')\n            .doc(projectId)\n            .get();\n\n        return project.data() as StorageProject;\n    }\n\n    updateProjectPublicFlag = async (projectId: string, isPublic: boolean) => {\n        await this.firestore.collection('projects')\n            .doc(projectId)\n            .update({\n                isPublic: isPublic,\n            });\n    }\n\n    uploadFileFromDataUrl = async (uploadPath: string, fileData: string) => {\n        if (!fileData) {\n            return;\n        }\n        await this.storage.ref(uploadPath).putString(fileData, firebase.storage.StringFormat.DATA_URL);\n    }\n\n    getDownloadUrl = async (remoteFilePath: string) => {\n        return this.storage.ref(remoteFilePath).getDownloadURL();\n    }\n}\n\nexport default new Firebase();\n","import React from 'react';\nimport firebase from './firebase';\n\nconst FirebaseContext = React.createContext(firebase);\n\nexport default FirebaseContext;\n","// External libraries\nimport _ from 'lodash';\nimport {\n    React,\n    useContext,\n    useEffect,\n    useRef,\n    useState,\n} from 'react';\nimport { connect } from 'react-redux';\n\n// External UI Components\nimport {\n    Avatar,\n    Box,\n    Button,\n    ClickAwayListener,\n    Divider,\n    Grow,\n    IconButton,\n    makeStyles,\n    MenuItem,\n    MenuList,\n    Paper,\n    Popper,\n    Typography,\n} from '@material-ui/core';\n\n// Actions\nimport { setIsShowingSignInDialog, setUser } from '../../redux/actions';\n\n// Database\nimport FirebaseContext from '../../firebase/context.ts';\n\nconst styles = makeStyles(() => {\n    return {\n        signInButton: {\n            borderRadius: '24px',\n            height: '48px',\n        },\n        menuListItem: {\n            paddingTop: '1rem',\n            paddingBottom: '1rem',\n            textAlign: 'center',\n        },\n        avatar: (props) => {\n            return {\n                border: `solid 2px ${props.userColor}`,\n            };\n        },\n        avatarInitialsOnly: (props) => {\n            return {\n                backgroundColor: props.userColor,\n                color: '#FFFFFF',\n            };\n        },\n        userDisplayName: {\n            marginTop: 0,\n            marginBottom: '0rem',\n            paddingTop: '1rem',\n            marginLeft: '1rem',\n            marginRight: '1rem',\n        },\n        userEmail: {\n            marginLeft: '1rem',\n            marginRight: '1rem',\n            marginTop: 0,\n            fontWeight: 500,\n        },\n    };\n});\nfunction UserProfile({\n    setIsShowingSignInDialogProp,\n    setUserProp,\n    userProp,\n}) {\n    const classes = styles();\n\n    const firebaseContext = useContext(FirebaseContext);\n\n    const anchorRef = useRef();\n\n    const [open, setOpen] = useState(false);\n\n    useEffect(() => {\n        firebaseContext.onUserUpdatedObservers.push(async (authUser) => {\n            if (!_.isNil(authUser)) {\n                const user = await firebaseContext.loadUser(authUser.uid);\n                if (!_.isNil(user)) {\n                    setUserProp(user);\n                }\n            }\n        });\n    }, []);\n\n    const onSignInClick = () => {\n        setIsShowingSignInDialogProp(true);\n    };\n\n    const handleToggle = () => {\n        setOpen((prevOpen) => {\n            return !prevOpen;\n        });\n    };\n\n    const handleClose = (event) => {\n        if (anchorRef.current && anchorRef.current.contains(event.target)) {\n            return;\n        }\n\n        setOpen(false);\n    };\n\n    function handleListKeyDown(event) {\n        if (event.key === 'Tab') {\n            event.preventDefault();\n            setOpen(false);\n        }\n    }\n\n    const onSignOutClick = () => {\n        firebaseContext.signOut();\n        setUserProp(null);\n    };\n\n    return (\n        <>\n            {!userProp && (\n                <Button className={classes.signInButton} variant=\"contained\" color=\"primary\" disableElevation size=\"large\" onClick={onSignInClick}>\n                    <Typography variant=\"h2\">\n                        Sign in\n                    </Typography>\n                </Button>\n            )}\n            {userProp && (\n                <>\n                    <IconButton\n                        ref={anchorRef}\n                        aria-controls={open ? 'menu-list-grow' : undefined}\n                        aria-haspopup=\"true\"\n                        onClick={handleToggle}\n                    >\n                        {\n                            !_.isNil(userProp.avatar)\n                            && <Avatar className={classes.avatar} alt={userProp.displayName} src={userProp.avatar} />\n                        }\n                        {\n                            _.isNil(userProp.avatar)\n                            && <Avatar className={classes.avatarInitialsOnly} alt={userProp.displayName} />\n                        }\n                    </IconButton>\n\n                    <Popper open={open} anchorEl={anchorRef.current} role={undefined} transition disablePortal>\n                        {({ TransitionProps, placement }) => {\n                            return (\n                                <Grow\n                                    {...TransitionProps}\n                                    style={{ transformOrigin: placement === 'bottom' ? 'center top' : 'center bottom' }}\n                                >\n                                    <Paper size=\"md\">\n                                        <ClickAwayListener onClickAway={handleClose}>\n                                            <Box>\n\n                                                <h2 className={classes.userDisplayName}>{userProp.displayName}</h2>\n                                                <h3 className={classes.userEmail}>{userProp.email}</h3>\n\n                                                <Divider />\n                                                <MenuList autoFocusItem={open} id=\"menu-list-grow\" onKeyDown={handleListKeyDown}>\n                                                    <MenuItem onClick={onSignOutClick} className={classes.menuListItem}>Sign out</MenuItem>\n                                                </MenuList>\n                                            </Box>\n                                        </ClickAwayListener>\n                                    </Paper>\n                                </Grow>\n                            );\n                        }}\n                    </Popper>\n                </>\n            )}\n        </>\n    );\n}\n\nconst mapStateToProps = (state) => {\n    return {\n        userProp: state.user,\n    };\n};\n\nexport default connect(\n    mapStateToProps,\n    {\n        setIsShowingSignInDialogProp: setIsShowingSignInDialog,\n        setUserProp: setUser,\n    },\n)(UserProfile);\n","import {\n    Box,\n    Button,\n    Container,\n    Divider,\n} from '@material-ui/core';\nimport React from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\n\nimport UserProfile from '../user-profile/UserProfile';\n\nconst styles = makeStyles((theme) => {\n    return {\n        root: {\n            height: '96px',\n            width: '100%',\n\n            display: 'flex',\n            flexDirection: 'row',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n        },\n        signInButton: {\n            borderRadius: '24px',\n            height: '48px',\n        },\n        infoButton: {\n            backgroundColor: 'rgba(0,0,0,0.6)',\n            padding: 0,\n            '&:hover': {\n                backgroundColor: 'rgba(0,0,0,0.4)',\n            },\n            borderRadius: '24px',\n        },\n        infoButtonLogo: {\n            paddingRight: 12,\n            paddingLeft: 22,\n        },\n        infoButtonInfoIcon: {\n            paddingRight: 22,\n            paddingLeft: 12,\n        },\n        divider: {\n            height: 48,\n            color: 'white',\n            backgroundColor: 'rgba(255, 255, 255, 0.2)',\n        },\n        paper: {\n            marginRight: theme.spacing(2),\n            borderRadius: '16px',\n        },\n        colorPicker: {\n            padding: '1rem',\n        },\n        menuList: {\n        },\n        menuListItem: {\n            paddingTop: '1rem',\n            paddingBottom: '1rem',\n            textAlign: 'center',\n        },\n        avatar: (props) => {\n            return {\n                border: `solid 2px ${props.userColor}`,\n            };\n        },\n        avatarInitialsOnly: (props) => {\n            return {\n                backgroundColor: props.userColor,\n                color: '#FFFFFF',\n            };\n        },\n        userDisplayName: {\n            marginTop: 0,\n            marginBottom: '0rem',\n            paddingTop: '1rem',\n            marginLeft: '1rem',\n            marginRight: '1rem',\n        },\n        userEmail: {\n            marginLeft: '1rem',\n            marginRight: '1rem',\n            marginTop: 0,\n            fontWeight: 500,\n        },\n    };\n});\n\nexport default function Header() {\n    const classes = styles();\n\n    return (\n        <Container maxWidth=\"md\">\n            <Box className={classes.root}>\n                <Button className={classes.infoButton} disableElevation size=\"large\" variant=\"contained\">\n                    <img className={classes.infoButtonLogo} src=\"/logo.svg\" alt=\"logo\" />\n                    <Divider className={classes.divider} orientation=\"vertical\" flexItem />\n                    <img className={classes.infoButtonInfoIcon} src=\"/icons/info.svg\" alt=\"info\" />\n                </Button>\n                <UserProfile />\n            </Box>\n        </Container>\n    );\n}\n","import React, { useState, useContext, useRef } from 'react';\nimport _ from 'lodash';\nimport firebase from 'firebase/app';\nimport ArrowBackIcon from '@material-ui/icons/ArrowBack';\nimport { connect } from 'react-redux';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Dialog from '@material-ui/core/Dialog';\nimport IconButton from '@material-ui/core/IconButton';\nimport TextField from '@material-ui/core/TextField';\nimport Box from '@material-ui/core/Box';\nimport Button from '@material-ui/core/Button';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { setIsShowingSignInDialog, setUser } from '../../redux/actions';\nimport FirebaseContext from '../../firebase/context.ts';\n\nconst styles = makeStyles({\n    title: {\n        textAlign: 'center',\n    },\n    body: {\n        padding: '1rem',\n        borderTop: 'solid 1px rgba(255,255,255,0.1)',\n    },\n    button: {\n        marginBottom: '1rem',\n        textAlign: 'center',\n    },\n    emailForm: {\n        display: 'flex',\n        flexDirection: 'column',\n    },\n    emailFormItem: {\n        marginBottom: '1rem',\n        minWidth: '300px',\n    },\n    signUpButton: {\n        fontWeight: 600,\n    },\n    backButton: {\n        position: 'absolute',\n        left: 4,\n        top: 8,\n    },\n    error: {\n        textAlign: 'center',\n        marginBottom: '2rem',\n        fontWeight: 600,\n    },\n});\n\nconst SignInDialog = ({ isShowingSignInDialog, setIsShowingSignInDialogAction, setUserAction }) => {\n    const classes = styles();\n\n    const firebaseContext = useContext(FirebaseContext);\n\n    const [isShowingEmailForm, setIsShowingEmailForm] = useState(false);\n    const [isShowingUseAsGuestForm, setIsShowingUseAsGuestForm] = useState(false);\n    const [isShowingEmailSignupForm, setIsShowingEmailSignupForm] = useState(false);\n    const [errorMessage, setErrorMessage] = useState(null);\n\n    const emailAddressInput = useRef();\n    const emailAddressSignupInput = useRef();\n    const passwordInput = useRef();\n    const passwordSignupInput = useRef();\n    const displayNameSignupInput = useRef();\n    const displayNameGuestInput = useRef();\n\n    const onClose = () => {\n        setIsShowingEmailForm(false);\n        setIsShowingEmailSignupForm(false);\n        setErrorMessage(null);\n        setIsShowingSignInDialogAction(false);\n        setIsShowingUseAsGuestForm(false);\n    };\n\n    const onGoogleSigninClick = async () => {\n        onClose();\n        const provider = new firebase.auth.GoogleAuthProvider();\n\n        const authResult = await firebaseContext.auth.signInWithPopup(provider);\n        const authUser = authResult.user;\n        let user = await firebaseContext.loadUser(authUser.uid);\n        if (_.isNil(user)) {\n            user = {\n                displayName: authUser.displayName,\n                email: authUser.email,\n                avatar: authUser.photoURL,\n                id: authUser.uid,\n                isGuest: false,\n            };\n            await firebaseContext.createUser(user);\n        }\n    };\n\n    const onShowEmailSigninClick = () => {\n        setIsShowingEmailForm(true);\n    };\n\n    const onEmailSigninClick = async () => {\n        const email = emailAddressInput.current.querySelectorAll('input')[0].value;\n        const password = passwordInput.current.querySelectorAll('input')[0].value;\n        try {\n            await firebaseContext.auth.signInWithEmailAndPassword(email, password);\n            onClose();\n        } catch (e) {\n            setErrorMessage(e.message);\n        }\n    };\n\n    const onEmailSignupClick = async () => {\n        const email = emailAddressSignupInput.current.querySelectorAll('input')[0].value;\n        const password = passwordSignupInput.current.querySelectorAll('input')[0].value;\n        const displayName = displayNameSignupInput.current.querySelectorAll('input')[0].value;\n        if (!_.isEmpty(displayName)) {\n            try {\n                const authResult = await firebaseContext.auth.createUserWithEmailAndPassword(email, password);\n                const authUser = authResult.user;\n\n                const user = {\n                    displayName: displayName,\n                    email: email,\n                    id: authUser.uid,\n                    isGuest: false,\n                };\n\n                await firebaseContext.createUser(user);\n                setUserAction(user);\n                onClose();\n            } catch (e) {\n                setErrorMessage(e.message);\n            }\n        } else {\n            setErrorMessage('Please enter a name');\n        }\n    };\n\n    const onShowEmailSignupClick = () => {\n        setIsShowingEmailForm(false);\n        setIsShowingEmailSignupForm(true);\n        setIsShowingUseAsGuestForm(false);\n    };\n\n    const onUseAsGuestClick = () => {\n        setIsShowingUseAsGuestForm(true);\n    };\n\n    const onContinueAsGuestClick = async () => {\n        const displayName = displayNameGuestInput.current.querySelectorAll('input')[0].value;\n        if (!_.isEmpty(displayName)) {\n            try {\n                const authResult = await firebaseContext.auth.signInAnonymously();\n\n                const authUser = authResult.user;\n\n                const user = {\n                    isGuest: true,\n                    displayName: displayName,\n                    id: authUser.uid,\n                };\n\n                await firebaseContext.createUser(user);\n                setUserAction(user);\n                onClose();\n            } catch (e) {\n                setErrorMessage(e.message);\n            }\n        } else {\n            setErrorMessage('Please enter a name');\n        }\n    };\n\n    const onBackClick = () => {\n        setIsShowingEmailForm(false);\n        setIsShowingEmailSignupForm(false);\n        setErrorMessage(null);\n        setIsShowingUseAsGuestForm(false);\n    };\n\n    return (\n        <>\n            <Dialog onClose={onClose} aria-labelledby=\"simple-dialog-title\" open={isShowingSignInDialog}>\n                {\n                    !isShowingEmailForm && !isShowingEmailSignupForm && !isShowingUseAsGuestForm\n                    && (\n                        <>\n                            <DialogTitle className={classes.title} id=\"simple-dialog-title\">\n\n                                Sign in\n                            </DialogTitle>\n                            <Box className={classes.body}>\n                                <Button\n                                    className={classes.button}\n                                    fullWidth\n                                    color=\"secondary\"\n                                    variant=\"contained\"\n                                    disableElevation\n                                    onClick={onGoogleSigninClick}\n                                >\n                                    Continue with Google\n                                </Button>\n                                <Button\n                                    className={classes.button}\n                                    fullWidth\n                                    color=\"secondary\"\n                                    variant=\"contained\"\n                                    disableElevation\n                                    onClick={onShowEmailSigninClick}\n                                >\n                                    Sign in with email\n                                </Button>\n                                <Button\n                                    className={classes.button}\n                                    fullWidth\n                                    color=\"secondary\"\n                                    variant=\"contained\"\n                                    disableElevation\n                                    onClick={onUseAsGuestClick}\n                                >\n                                    Use as guest\n                                </Button>\n                                <p style={{ textAlign: 'center' }}>\n                                    Don&apos;t have an account yet?\n                                </p>\n                                <Button className={classes.signUpButton} fullWidth disableElevation onClick={onShowEmailSignupClick}>Sign up</Button>\n                            </Box>\n                        </>\n                    )\n                }\n                {\n                    isShowingEmailForm\n                    && (\n                        <>\n                            <DialogTitle className={classes.title} id=\"simple-dialog-title\">\n                                <IconButton aria-label=\"close\" className={classes.backButton} onClick={onBackClick}>\n                                    <ArrowBackIcon />\n                                </IconButton>\n                                Sign in with email\n                            </DialogTitle>\n                            <Box className={classes.body}>\n                                <form className={classes.emailForm} noValidate autoComplete=\"off\">\n                                    <TextField\n                                        type=\"email\"\n                                        ref={emailAddressInput}\n                                        className={classes.emailFormItem}\n                                        label=\"Email address\"\n                                        variant=\"outlined\"\n                                    />\n                                    <TextField ref={passwordInput} className={classes.emailFormItem} label=\"Password\" variant=\"outlined\" type=\"password\" />\n                                    {\n                                        errorMessage\n                                        && (\n                                            <p className={classes.error}>{errorMessage}</p>\n                                        )\n                                    }\n                                    <Button\n                                        className={classes.button}\n                                        fullWidth\n                                        color=\"primary\"\n                                        variant=\"contained\"\n                                        disableElevation\n                                        onClick={onEmailSigninClick}\n                                    >\n                                        <strong>Sign in</strong>\n                                    </Button>\n                                </form>\n\n                            </Box>\n                        </>\n                    )\n                }\n                {\n                    isShowingUseAsGuestForm\n                    && (\n                        <>\n                            <DialogTitle className={classes.title} id=\"simple-dialog-title\">\n                                <IconButton aria-label=\"close\" className={classes.backButton} onClick={onBackClick}>\n                                    <ArrowBackIcon />\n                                </IconButton>\n                                Continue as guest\n                            </DialogTitle>\n                            <Box className={classes.body}>\n                                <form className={classes.emailForm} noValidate autoComplete=\"off\">\n                                    <TextField ref={displayNameGuestInput} className={classes.emailFormItem} label=\"Name\" variant=\"outlined\" />\n                                    {\n                                        errorMessage\n                                        && (\n                                            <p className={classes.error}>{errorMessage}</p>\n                                        )\n                                    }\n                                    <Button\n                                        className={classes.button}\n                                        fullWidth\n                                        color=\"primary\"\n                                        variant=\"contained\"\n                                        disableElevation\n                                        onClick={onContinueAsGuestClick}\n                                    >\n                                        <strong>Continue as guest</strong>\n                                    </Button>\n                                </form>\n\n                            </Box>\n                        </>\n                    )\n                }\n                {\n                    isShowingEmailSignupForm\n                    && (\n                        <>\n                            <DialogTitle className={classes.title} id=\"simple-dialog-title\">\n                                <IconButton aria-label=\"close\" className={classes.backButton} onClick={onBackClick}>\n                                    <ArrowBackIcon />\n                                </IconButton>\n                                Sign up with email\n                            </DialogTitle>\n                            <Box className={classes.body}>\n                                <form className={classes.emailForm} noValidate autoComplete=\"off\">\n                                    <TextField\n                                        ref={displayNameSignupInput}\n                                        className={classes.emailFormItem}\n                                        label=\"Name\"\n                                        variant=\"outlined\"\n                                    />\n                                    <TextField\n                                        type=\"email\"\n                                        ref={emailAddressSignupInput}\n                                        className={classes.emailFormItem}\n                                        label=\"Email address\"\n                                        variant=\"outlined\"\n                                    />\n                                    <TextField\n                                        ref={passwordSignupInput}\n                                        className={classes.emailFormItem}\n                                        label=\"Password\"\n                                        variant=\"outlined\"\n                                        type=\"password\"\n                                    />\n                                    {\n                                        errorMessage\n                                        && (\n                                            <p className={classes.error}>{errorMessage}</p>\n                                        )\n                                    }\n                                    <Button\n                                        className={classes.button}\n                                        fullWidth\n                                        color=\"primary\"\n                                        variant=\"contained\"\n                                        disableElevation\n                                        onClick={onEmailSignupClick}\n                                    >\n                                        <strong>Sign up</strong>\n                                    </Button>\n                                </form>\n\n                            </Box>\n                        </>\n                    )\n                }\n\n            </Dialog>\n        </>\n    );\n};\n\nconst mapStateToProps = (state) => {\n    return {\n        user: state.user,\n        isShowingSignInDialog: state.display.isShowingSignInDialog,\n    };\n};\n\nexport default connect(\n    mapStateToProps,\n    {\n        setIsShowingSignInDialogAction: setIsShowingSignInDialog,\n        setUserAction: setUser,\n    },\n)(SignInDialog);\n","// External\nimport JSZip from 'jszip';\nimport download from 'downloadjs';\n\n// Models\nimport StorageProject from '../models/storage/StorageProject';\n\n// Firebase\nimport firebase from '../firebase/firebase';\n\n// Models - Storage\nimport StorageSoundtrack from '../models/storage/StorageSoundtrack';\nimport StorageStory from '../models/storage/StorageStory';\nimport StorageRoom from '../models/storage/StorageRoom';\nimport StorageImageAsset from '../models/storage/StorageImageAsset';\nimport StorageHotspot from '../models/storage/StorageHotspot';\n\nexport default class ProjectArchiveCreator {\n    private zip = new JSZip();\n\n    public async create(project: StorageProject): Promise<void> {\n        await this.storeProjectData(project);\n\n        const zipFile = await this.zip.generateAsync({\n            type: 'blob'\n        });\n\n        download(zipFile, project.story.name);\n    }\n\n    private async storeProjectData(project: StorageProject) {\n        this.zip.file('project-data.json', JSON.stringify(project));\n\n        await this.storeStoryData(project.story);\n    }\n\n    private async storeStoryData(story: StorageStory) {\n        const promises = [];\n\n        if (story.soundtrack) {\n            promises.push(this.storeAsset(story.soundtrack));\n        }\n\n        story.rooms.forEach((room) => {\n            promises.push(this.storeRoomData(room));\n        });\n\n        await Promise.all(promises);\n    }\n\n    private async storeRoomData(room: StorageRoom) {\n        const promises = [];\n\n        promises.push(this.storeAsset(room.panorama));\n        promises.push(this.storeAsset(room.thumbnail));\n        if (room.music) {\n            promises.push(this.storeAsset(room.music));\n        }\n        if (room.narration) {\n            promises.push(this.storeAsset(room.narration));\n        }\n\n        room.hotspots.forEach((hotspot) => {\n            promises.push(this.storeHotspotData(hotspot));\n        });\n\n        await Promise.all(promises);\n    }\n\n    private async storeHotspotData(hotspot: StorageHotspot) {\n        const promises = [];\n\n        if (hotspot.image) {\n            promises.push(this.storeAsset(hotspot.image));\n        }\n        if (hotspot.audio) {\n            promises.push(this.storeAsset(hotspot.audio));\n        }\n\n        await Promise.all(promises);\n    }\n\n    private async storeAsset(asset: StorageSoundtrack | StorageImageAsset) {\n        const soundtrackData = await this.fetchRemoteAssetFileData(asset.remoteFilePath);\n\n        this.zip.file(`${asset.id}.${asset.extension}`, soundtrackData, { base64: true });\n    }\n\n    private async fetchRemoteAssetFileData(remotePath: string): Promise<string | ArrayBuffer> {\n        const url = await firebase.getDownloadUrl(remotePath);\n\n        return new Promise((resolve) => {\n            const xhr = new XMLHttpRequest();\n            xhr.onload = function () {\n                const reader = new FileReader();\n                reader.onload = function () {\n                    if (typeof reader.result === 'string') {\n                        // Convert data URL to base64 string\n                        const result = reader.result.replace(/^data:.+;base64,/, '');\n                        resolve(result);\n                    }\n                };\n                reader.readAsDataURL(xhr.response);\n            };\n\n            xhr.open('GET', url);\n            xhr.responseType = 'blob';\n            xhr.send();\n        });\n    }\n}\n","import React, {\n    useCallback,\n    useContext,\n    useEffect,\n    useState,\n} from 'react';\nimport qrcode from 'qrcode';\nimport copy from 'copy-to-clipboard';\n\nimport {\n    Box,\n    Button,\n    Dialog,\n    DialogContent,\n    DialogTitle,\n    IconButton,\n    makeStyles,\n    Typography,\n    Switch,\n} from '@material-ui/core';\n\nimport { Close } from '@material-ui/icons';\nimport FirebaseContext from '../../firebase/context.ts';\n\nconst styles = makeStyles(() => {\n    return {\n        root: {\n            padding: '0px',\n        },\n        contentRoot: {\n            padding: '0px 0px 16px 0px',\n        },\n        titleContainer: {\n            width: '100%',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            height: '48px',\n        },\n        closeIcon: {\n            position: 'absolute',\n        },\n        storyInfoContainer: {\n            display: 'flex',\n            alignItems: 'center',\n            paddingLeft: '24px',\n            justifyContent: 'space-between',\n            backgroundColor: 'rgba(0, 0, 0, 0.1)',\n            borderBottom: '1px solid rgba(0, 0, 0, 0.1)',\n            borderTop: '1px solid rgba(0, 0, 0, 0.1)',\n            boxSizing: 'content-box',\n        },\n        storyNameInfo: {\n            display: 'flex',\n            flexDirection: 'column',\n        },\n        storyPublicInfo: {\n            display: 'flex',\n        },\n        storyRoomInfo: {\n            display: 'flex',\n            flexDirection: 'column',\n            justifyContent: 'center',\n            borderLeft: '1px solid rgba(0, 0, 0, 0.1)',\n        },\n        storyDialogThumbnailImage: {\n            width: '80px',\n            height: '40px',\n            backgroundPosition: 'center',\n            backgroundSize: 'cover',\n        },\n        shareStoryPublicToggle: {\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'space-between',\n            height: '48px',\n            marginTop: '12px',\n            marginLeft: '24px',\n            marginRight: '24px',\n            boxSizing: 'content-box',\n        },\n        shareStoryPublicToggleText: {\n            display: 'flex',\n        },\n        publicStoryInfo: {\n            paddingLeft: '24px',\n            paddingRight: '24px',\n            paddingTop: '8px',\n        },\n        publicDataContainer: {\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n            paddingTop: '12px',\n            paddingLeft: '24px',\n            paddingRight: '24px',\n            paddingBottom: '24px',\n        },\n    };\n});\nexport default function ShareStoryDialog({ thumbnailUrl, project, onClose }) {\n    const classes = styles();\n\n    const firebaseContext = useContext(FirebaseContext);\n\n    const [publicLink, setPublicLink] = useState('');\n    const [projectIsPublic, setPublic] = useState(project.isPublic);\n\n    const generateSharableLink = () => {\n        return `${window.location.origin}/view/${project.id}`;\n    };\n\n    const setQRCode = (link) => {\n        if (!qrCodeCanvas.current) {\n            return;\n        }\n\n        qrcode.toCanvas(qrCodeCanvas.current, link);\n    };\n\n    const initPublicLink = async () => {\n        const link = generateSharableLink();\n\n        setPublicLink(link);\n        setQRCode(link);\n    };\n\n    const qrCodeCanvas = useCallback((node) => {\n        qrCodeCanvas.current = node;\n\n        if (node && projectIsPublic) {\n            initPublicLink();\n        }\n    }, []);\n\n    useEffect(async () => {\n        if (projectIsPublic) {\n            initPublicLink();\n        }\n\n        await firebaseContext.updateProjectPublicFlag(project.id, projectIsPublic);\n\n        project.isPublic = projectIsPublic;\n    }, [projectIsPublic]);\n\n    const onPublicToggle = async () => {\n        setPublic(!projectIsPublic);\n    };\n\n    const onCopyLink = () => {\n        copy(publicLink);\n    };\n\n    const storyInfoIconName = projectIsPublic ? 'public-story-icon.svg' : 'private-story-icon.svg';\n\n    return (\n        <Dialog onClose={onClose} open maxWidth=\"xs\" fullWidth>\n            <DialogTitle className={classes.root}>\n                <IconButton onClick={onClose} className={classes.closeIcon}>\n                    <Close />\n                </IconButton>\n                <div className={classes.titleContainer}>\n                    <Typography variant=\"body1\">\n                        Share story\n                    </Typography>\n                </div>\n            </DialogTitle>\n            <DialogContent className={classes.contentRoot}>\n                <div className={classes.storyInfoContainer}>\n                    <div className={classes.storyNameInfo}>\n                        <Typography variant=\"body2\">\n                            {project.story.name}\n                        </Typography>\n                        <Box m={0.5} />\n                        <div className={classes.storyPublicInfo}>\n                            <img src={`/icons/${storyInfoIconName}`} alt=\"public-story-icon\" />\n                            <Box m={0.3} />\n                            <Typography variant=\"caption\">\n                                {projectIsPublic ? 'Public story' : 'Only visible to you'}\n                            </Typography>\n                        </div>\n                    </div>\n                    <div className={classes.storyRoomInfo}>\n                        <div className={classes.storyDialogThumbnailImage} style={{ backgroundImage: `url(${thumbnailUrl})` }} />\n                        <Box m={0.5} />\n                        <Typography variant=\"caption\">\n                            {1} rooms\n                        </Typography>\n                    </div>\n                </div>\n                <div className={classes.shareStoryPublicToggle}>\n                    <div className={classes.shareStoryPublicToggleText}>\n                        <img src=\"/icons/public-story-icon.svg\" alt=\"make-story-public\" />\n                        <Box m={0.3} />\n                        <Typography variant=\"body1\">\n                            Make public\n                        </Typography>\n                    </div>\n                    <Switch checked={projectIsPublic} onChange={onPublicToggle} />\n                </div>\n                <div className={classes.publicStoryInfo}>\n                    <Typography variant=\"caption\">\n                        Public stories can be searched and viewed with a link. Only you can edit your stories.\n                    </Typography>\n                </div>\n                {projectIsPublic\n                && (\n                    <div className={classes.publicDataContainer}>\n                        <canvas ref={qrCodeCanvas} />\n                        <Typography variant=\"body2\" align=\"center\">\n                            {publicLink}\n                        </Typography>\n                        <Box m={2} />\n                        <Button fullWidth variant=\"outlined\" onClick={onCopyLink}>\n                            Copy link\n                        </Button>\n                    </div>\n                )}\n            </DialogContent>\n        </Dialog>\n    );\n}\n","// External libraries\nimport { useContext, useEffect, useState } from 'react';\nimport { connect } from 'react-redux';\nimport { useHistory } from 'react-router-dom';\n\n// External UI Components\nimport { IconButton, makeStyles, Typography } from '@material-ui/core';\n\n// Firebase\nimport FirebaseContext from '../../firebase/context.ts';\n\n// Redux\nimport { setCurrentRoom, setProject, setStory } from '../../redux/actions';\n\n// Service\nimport ProjectArchiveCreator from '../../service/ProjectArchiveCreator';\n\n// Components\nimport ShareStoryDialog from '../dialogs/ShareStoryDialog';\n\nconst styles = makeStyles(() => {\n    return {\n        projectCardContainer: {\n            width: '100%',\n            backgroundColor: 'white',\n            display: 'flex',\n            flexDirection: 'column',\n            boxShadow: '0px 1px 1px rgba(0, 0, 0, 0.08), -1px 0px 1px rgba(0, 0, 0, 0.08), 1px 0px 1px rgba(0, 0, 0, 0.08), 0px -1px 1px rgba(0, 0, 0, 0.08)',\n            borderRadius: '12px',\n            height: '200px'\n        },\n        projectCardHeader: {\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'space-between'\n        },\n        projectCardTitle: {\n            display: 'flex',\n            flexDirection: 'column',\n            padding: '12px',\n        },\n        title: {\n            whiteSpace: 'nowrap',\n            textOverflow: 'ellipsis',\n            width: '95px',\n            overflow: 'hidden',\n        },\n        cardActionsContainer: {\n            display: 'flex',\n            height: '48px'\n        },\n        storyCardImageContainer: {\n            borderRadius: '0px 0px 12px 12px',\n            display: 'flex',\n            position: 'relative',\n            height: '100%'\n        },\n        storyCardImage: {\n            width: '100%',\n            height: '100%',\n            borderRadius: '0px 0px 12px 12px',\n            backgroundSize: 'cover',\n            backgroundPosition: 'center',\n        },\n        storyCardOptions: {\n            position: 'absolute',\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'center',\n            left: '0px',\n            top: '0px',\n            width: '100%',\n            height: '100%',\n            backgroundColor: 'rgba(255, 255, 255, 0.9)',\n            borderRadius: '0px 0px 12px 12px',\n        },\n    };\n});\nfunction ProjectCard({\n    project,\n    isPublic,\n    setProjectAction,\n    setStoryAction,\n    setCurrentRoomAction,\n}) {\n    const classes = styles();\n\n    const firebaseContext = useContext(FirebaseContext);\n\n    const history = useHistory();\n\n    const [optionsVisible, setOptionsVisible] = useState(false);\n    const [thumbnailUrl, setThumbnailUrl] = useState('');\n    const [shareStoryDialogOpen, setShareStoryDialogOpen] = useState(false);\n\n    useEffect(async () => {\n        const firstRoom = getHomeRoom(project.story.rooms);\n\n        const url = await firebaseContext.getDownloadUrl(firstRoom.thumbnail.remoteFilePath);\n\n        setThumbnailUrl(url);\n    }, []);\n\n    const onMouseEnter = () => {\n        if (!isPublic) {\n            setOptionsVisible(true);\n        }\n    };\n\n    const onMouseLeave = () => {\n        if (!isPublic) {\n            setOptionsVisible(false);\n        }\n    };\n\n    const onClick = () => {\n        if (isPublic) {\n            onViewStory();\n        }\n    }\n\n    const onOpenShareStory = () => {\n        setShareStoryDialogOpen(true);\n        setOptionsVisible(false);\n    };\n\n    const onCloseShareStory = () => {\n        setShareStoryDialogOpen(false);\n    };\n\n    const onEditStory = async () => {\n        const projectModel = await firebaseContext.loadProject(project);\n\n        // Set newly loaded story (and first room) as active story in redux\n        setProjectAction(projectModel);\n        setStoryAction(projectModel.story);\n        setCurrentRoomAction(projectModel.story.rooms[0]);\n\n        // Navigate to editor for further story edits\n        history.push('/editor');\n    };\n\n    const onViewStory = async () => {\n        const projectModel = await firebaseContext.loadProject(project);\n\n        // Set newly loaded story (and first room) as active story in redux\n        setProjectAction(projectModel);\n        setStoryAction(projectModel.story);\n        setCurrentRoomAction(projectModel.story.rooms[0]);\n\n        history.push(`/view/${project.id}`);\n    }\n\n    const getHomeRoom = (rooms) => {\n        let homeRoom = rooms.find((room) => {\n            return room.isHome;\n        });\n        if (!homeRoom) {\n            homeRoom = rooms[0];\n        }\n        return homeRoom;\n    }\n\n    const onDownloadStoryArchive = async () => {\n        const archiver = new ProjectArchiveCreator();\n        archiver.create(project);\n    }\n\n    return (\n        <div className={classes.projectCardContainer} onMouseEnter={onMouseEnter} onMouseLeave={onMouseLeave} onClick={onClick} style={{\n            cursor: isPublic ? 'pointer' : 'default'\n        }}>\n            <div className={classes.projectCardHeader}>\n                <div className={classes.projectCardTitle}>\n                    <Typography variant=\"body2\" className={classes.title}>\n                        {project.story.name}\n                    </Typography>\n                    <Typography variant=\"caption\">\n                        Tags:\n                        {\n                            project.story.tags || 'n/a'\n                        }\n                    </Typography>\n                </div>\n                <div className={classes.cardActionsContainer}>\n                    {!isPublic &&\n                    <IconButton onClick={onEditStory}>\n                        <img src=\"/icons/edit-icon.svg\" alt=\"edit\" />\n                    </IconButton>}\n                    {!isPublic &&\n                    <IconButton onClick={onOpenShareStory}>\n                        <img src=\"/icons/share-icon.svg\" alt=\"share\" />\n                    </IconButton>}\n                    {!isPublic &&\n                    <IconButton onClick={onDownloadStoryArchive}>\n                        <img src=\"/icons/share-icon.svg\" alt=\"share\" />\n                    </IconButton>}\n                </div>\n            </div>\n            <div className={classes.storyCardImageContainer}>\n                {thumbnailUrl\n                && (\n                    <div\n                        className={classes.storyCardImage}\n                        style={{\n                            backgroundImage: `url(${thumbnailUrl})`,\n                        }}\n                    />\n                )}\n            </div>\n            {shareStoryDialogOpen && <ShareStoryDialog onClose={onCloseShareStory} thumbnailUrl={thumbnailUrl} project={project} />}\n        </div>\n    );\n}\n\nconst mapStateToProps = () => {\n    return {};\n};\n\nexport default connect(\n    mapStateToProps,\n    {\n        setProjectAction: setProject,\n        setStoryAction: setStory,\n        setCurrentRoomAction: setCurrentRoom,\n    },\n)(ProjectCard);\n","// External libraries\nimport React, { useContext, useEffect } from 'react';\nimport { connect } from 'react-redux';\nimport _ from 'lodash';\n\n// External UI Components\nimport {\n    Typography,\n    Button,\n    Container,\n    makeStyles,\n    Box,\n} from '@material-ui/core';\n\n// Actions\nimport { setIsShowingSignInDialog, setUserStories } from '../../redux/actions';\n\n// Firebase\nimport FirebaseContext from '../../firebase/context.ts';\nimport ProjectCard from './ProjectCard';\n\nconst styles = makeStyles(() => {\n    return {\n        container: {\n            paddingTop: '48px',\n        },\n        signInContent: {\n            display: 'flex',\n            alignItems: 'center',\n            flexDirection: 'column',\n            width: '100%',\n            marginTop: '12px',\n        },\n        placeholderImage: {\n            paddingBottom: '24px',\n        },\n        signInButton: {\n            marginTop: '12px',\n            height: '48px',\n            borderRadius: '24px',\n        },\n        userStoriesSignedInContent: {\n            display: 'grid',\n            gridTemplateColumns: 'repeat(4, 1fr)',\n            gridGap: '12px',\n            width: '100%',\n        },\n    };\n});\nfunction UserStoriesSection({\n    user,\n    userStories,\n    setUserStoriesAction,\n    setIsShowingSignInDialogAction,\n}) {\n    const firebaseContext = useContext(FirebaseContext);\n\n    const classes = styles();\n\n    useEffect(() => {\n        firebaseContext.onUserUpdatedObservers.push(async (authUser) => {\n            if (!_.isNil(authUser)) {\n                firebaseContext.loadUserStories(authUser.uid).then((stories) => {\n                    setUserStoriesAction(stories);\n                });\n            }\n        });\n    }, []);\n\n    function onSignInClick() {\n        setIsShowingSignInDialogAction(true);\n    }\n\n    return (\n        <Container maxWidth=\"md\" className={classes.container}>\n            {/* In case user is not logged in, show a prompt asking user to log in to view his/her stories */}\n            {!user\n            && (\n                <div>\n                    <Typography variant=\"body1\" className=\"light-text-90\">\n                        Your stories\n                    </Typography>\n                    <div className={classes.signInContent}>\n                        <img src=\"images/user-stories-placeholder.svg\" alt=\"user story placeholder\" className={classes.placeholderImage} />\n                        <Typography variant=\"body1\" className=\"light-text-70\">\n                            To see your stories, please sign in\n                        </Typography>\n                        <Button variant=\"contained\" color=\"primary\" size=\"large\" className={classes.signInButton} disableElevation onClick={onSignInClick}>\n                            <Typography variant=\"h2\">\n                                Sign in\n                            </Typography>\n                        </Button>\n                    </div>\n                </div>\n            )}\n            {/* In case user is logged in, show a list of his stories */}\n            {user\n            && (\n                <div>\n                    <Typography variant=\"body1\" className=\"light-text-90\">\n                        Your stories (\n                        {\n                            userStories.length\n                        }\n                        )\n                    </Typography>\n                    <Box m={2} />\n                    <div className={classes.userStoriesSignedInContent}>\n                        {userStories.map((story) => {\n                            return (\n                                <ProjectCard key={story.id} project={story} />\n                            );\n                        })}\n                    </div>\n                </div>\n            )}\n            {/* Show a 'See more' button to load more stories for user */}\n            {false\n            && (\n                <div className=\"user-stories-action-container\">\n                    <Button label=\"See more\" />\n                </div>\n            )}\n        </Container>\n    );\n}\n\nconst mapStateToProps = (state) => {\n    return {\n        user: state.user,\n        userStories: state.userStories,\n    };\n};\n\nexport default connect(\n    mapStateToProps,\n    {\n        setUserStoriesAction: setUserStories,\n        setIsShowingSignInDialogAction: setIsShowingSignInDialog,\n    },\n)(UserStoriesSection);\n","import { useContext, useEffect, FC } from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\n\nimport {\n    Container,\n    makeStyles,\n    Typography,\n} from '@material-ui/core';\nimport FirebaseContext from '../../firebase/context';\nimport { setPublicStories } from '../../redux/actions';\n\nimport ProjectCard from './ProjectCard';\nimport StorageProject from '../../models/storage/StorageProject';\n\nconst styles = makeStyles(() => {\n    return {\n        container: {\n            paddingTop: '48px',\n        },\n        showMoreContainer: {\n            display: 'flex',\n            justifyContent: 'center',\n            width: '100%',\n            paddingTop: '12px',\n        },\n        seeMoreButton: {\n            borderRadius: '24px',\n            height: '48px',\n        },\n        userStoriesSignedInContent: {\n            marginTop: '12px',\n            marginBottom: '24px',\n            display: 'grid',\n            gridTemplateColumns: 'repeat(4, 1fr)',\n            gridGap: '12px',\n            width: '100%',\n        },\n    };\n});\n\nconst mapStateToProps = (state: any) => {\n    return {\n        publicStories: state.publicStories,\n    };\n};\n\nconst mapDispatch = {\n    setPublicStoriesAction: setPublicStories\n}\n\nconst connector = connect(\n    mapStateToProps,\n    mapDispatch,\n);\n\ntype ReduxProps = ConnectedProps<typeof connector>\n\nconst PublicStoriesSection: FC<ReduxProps> = ({ publicStories, setPublicStoriesAction }) => {\n    const firebaseContext = useContext(FirebaseContext);\n\n    const classes = styles();\n\n    useEffect(() => {\n        firebaseContext.loadPublicStories().then((stories) => {\n            setPublicStoriesAction(stories);\n        });\n    }, []);\n\n    return (\n        <Container maxWidth=\"md\" className={classes.container}>\n            {/* Show a list of public stories */}\n            <div>\n                <Typography variant=\"body1\" className=\"light-text-90\">\n                    Explore public stories\n                </Typography>\n                <Typography variant=\"body2\" className=\"light-text-70\">\n                    Explore public stories\n                </Typography>\n                <div className={classes.userStoriesSignedInContent}>\n                    {publicStories.map((project: StorageProject) => {\n                        return (\n                            <ProjectCard key={project.id} project={project} isPublic />\n                        );\n                    })}\n                </div>\n            </div>\n        </Container>\n    );\n}\nexport default connector(PublicStoriesSection);\n","// External libraries\nimport React, { FC, useRef, useState } from \"react\";\n\n// External UI Components\nimport { Button, makeStyles } from \"@material-ui/core\";\n\ninterface EditorFileSelectorProps {\n    onChange: (file: File) => void;\n}\nconst styles = makeStyles(() => {\n    return {\n        input: {\n            display: 'none',\n        },\n        container: {\n            position: 'relative',\n        },\n        dropZone: {\n            position: 'absolute',\n            left: 0,\n            right: 0,\n            top: 0,\n            bottom: 0,\n            cursor: 'pointer'\n        }\n    };\n});\nconst EditorFileSelector: FC<EditorFileSelectorProps> = ({children, onChange}) => {\n    const classes = styles();\n\n    const imageInputElement = useRef<HTMLInputElement>();\n\n    const selectImage = () => {\n        imageInputElement.current.click();\n    };\n\n    const onImageSelected = (event: React.ChangeEvent<HTMLInputElement>) => {\n        const file = event.target.files && event.target.files[0];\n        onChange(file);\n    };\n\n    const onImageDropped = (event: React.DragEvent<HTMLDivElement>) => {\n        event.preventDefault();\n\n        const file = event.dataTransfer.files && event.dataTransfer.files[0];\n        onChange(file);\n    }\n\n    const onDragOver = (event: React.DragEvent<HTMLDivElement>) => {\n        event.preventDefault();\n    }\n\n    return (\n        <>\n            <input\n                type=\"file\"\n                className={classes.input}\n                ref={imageInputElement}\n                onChange={onImageSelected}\n                style={{ display: 'none' }}\n            />\n            <div className={classes.container}>\n                {children}\n                <div\n                    onClick={selectImage}\n                    onDragOver={onDragOver}\n                    onDrop={onImageDropped}\n                    className={classes.dropZone}\n                />\n            </div>\n        </>\n    );\n}\nexport default EditorFileSelector;\n","export const MIME_TYPE_TEXT = 'text/plain';\nexport const MIME_TYPE_UTF8 = 'text/plain;charset=utf-8';\nexport const MIME_TYPE_MP3 = 'audio/mp3';\nexport const MIME_TYPE_WAV = 'audio/wav';\nexport const MIME_TYPE_AAC = 'audio/aac';\nexport const MIME_TYPE_XM4A = 'audio/x-m4a';\nexport const MIME_TYPE_MPEG = 'audio/mpeg';\nexport const MIME_TYPE_XWAV = 'audio/x-wav';\nexport const MIME_TYPE_PNG = 'image/png';\nexport const MIME_TYPE_JPG = 'image/jpg';\nexport const MIME_TYPE_JPEG = 'image/jpeg';\nexport const MIME_TYPE_ZIP = 'application/zip';\nexport const MIME_TYPE_X_ZIP = 'application/x-zip';\nexport const MIME_TYPE_OCTET_STREAM = 'application/octet-stream';\nexport const MIME_TYPE_X_ZIP_COMPRESSED = 'application/x-zip-compressed';\nexport const MIME_TYPE_MP4 = 'video/mp4';\n\nexport const MIME_TYPE_MAP = {\n    video: [MIME_TYPE_MP4],\n    audio: [\n        MIME_TYPE_MP3,\n        MIME_TYPE_WAV,\n        MIME_TYPE_MPEG,\n        MIME_TYPE_XWAV,\n        MIME_TYPE_AAC,\n        MIME_TYPE_XM4A,\n    ],\n    image: [MIME_TYPE_PNG, MIME_TYPE_JPG, MIME_TYPE_JPEG],\n    zip: [MIME_TYPE_ZIP, MIME_TYPE_X_ZIP, MIME_TYPE_OCTET_STREAM, MIME_TYPE_X_ZIP_COMPRESSED],\n};\n","import { MIME_TYPE_MAP } from '../constants/constants';\n\nexport default class FileLoaderUtil {\n    static validateFileLoadEvent(file, acceptedFileType) {\n        return new Promise((resolve, reject) => {\n            if (!MIME_TYPE_MAP[acceptedFileType]) {\n                reject(new Error('Accepted file type not valid'));\n            }\n            if (MIME_TYPE_MAP[acceptedFileType].indexOf(file.type) < 0) {\n                const errorMessage = `File is not a valid type, must be of type: ${acceptedFileType}.\\n`\n                + `Accepted file types: ${MIME_TYPE_MAP[acceptedFileType].join(', ')}`;\n                reject(errorMessage);\n            }\n            resolve(file);\n        });\n    }\n\n    static isFileOfType(file, type) {\n        if (!MIME_TYPE_MAP[type]) {\n            return false;\n        }\n        else if(MIME_TYPE_MAP[type].indexOf(file.type) > 0) {\n            return true;\n        }\n\n        return false;\n    }\n\n    static getBinaryFileData(file) {\n        return new Promise((resolve, reject) => {\n            const fileReader = new FileReader();\n            fileReader.onloadend = () => {\n                resolve(fileReader.result);\n            };\n            fileReader.onerror = () => {\n                const { error } = fileReader;\n                reject(error);\n            };\n            fileReader.readAsDataURL(file);\n        });\n    }\n}\n","import Vector2 from './Vector2';\nimport { MIME_TYPE_JPEG } from '../constants/constants';\n\nconst MAX_SIZE_HOTSPOT = 1024;\n\nfunction getNearestPowerOfTwo(x) {\n    return new Array(14).fill(null)\n        .map((_, index) => {\n            return 2 ** index;\n        })\n        .map((power) => {\n            const distance = Math.abs(x - power);\n            return { distance: distance, value: power };\n        })\n        .sort((a, b) => {\n            return a.distance - b.distance;\n        })[0].value;\n}\n\nexport function fitToMax(width, height, maxSize) {\n    let x;\n    let y;\n    if (width > height && width > maxSize) {\n        x = maxSize;\n        y = (height / width) * maxSize;\n    } else if (height > width && height > maxSize) {\n        x = (width / height) * maxSize;\n        y = maxSize;\n    } else if (width === height && width > maxSize) {\n        x = maxSize;\n        y = maxSize;\n    } else {\n        x = width;\n        y = height;\n    }\n    return new Vector2(x, y);\n}\n\nconst SIZE_OPTIONS = {\n    projectThumbnail: () => {\n        return new Vector2(336, 168);\n    },\n    hotspotImage: (width, height) => {\n        return fitToMax(width, height, MAX_SIZE_HOTSPOT);\n    },\n    backgroundImage: (width, height) => {\n        if (width >= height) {\n            const x = getNearestPowerOfTwo(width);\n            const y = Math.floor((height / width) * x);\n            return new Vector2(x, y);\n        }\n\n        const y = getNearestPowerOfTwo(height);\n        const x = Math.floor((width / height) * y);\n        return new Vector2(x, y);\n    },\n};\n\nfunction getResizedImage(imageUrl, sizeOption) {\n    return new Promise((resolve, reject) => {\n        try {\n            const canvas = (document.createElement('canvas'));\n            const img = new Image();\n            img.crossOrigin = 'anonymous';\n\n            img.onload = () => {\n                const resizeDimensions = SIZE_OPTIONS[sizeOption](img.width, img.height);\n\n                canvas.width = resizeDimensions.getX();\n                canvas.height = resizeDimensions.getY();\n                canvas.getContext('2d').drawImage(img, 0, 0, img.width, img.height, 0, 0, resizeDimensions.getX(), resizeDimensions.getY());\n\n                resolve(canvas.toDataURL(MIME_TYPE_JPEG, 0.8));\n            };\n\n            img.src = imageUrl;\n        } catch (error) {\n            reject(error);\n        }\n    });\n}\n\nexport default async function resizeImageAsync(imageUrl, sizeOption) {\n    if (!SIZE_OPTIONS[sizeOption]) {\n        return Promise.reject(new Error(`resizeImage must have a valid size option: ${Object.keys(SIZE_OPTIONS).join(', ')}`));\n    }\n    if (sizeOption === 'backgroundImage') {\n        const resizeList = await Promise.all([\n            getResizedImage(imageUrl, 'backgroundImage'),\n            getResizedImage(imageUrl, 'projectThumbnail'),\n        ]);\n        return {\n            backgroundImage: resizeList[0],\n            thumbnail: resizeList[1],\n        };\n    }\n\n    return getResizedImage(imageUrl, sizeOption);\n}\n","// External\nimport JSZip from 'jszip';\nimport mime from 'mime-types';\n\n// Models\nimport Project from '../models/project';\nimport Soundtrack from '../models/soundtrack';\nimport Story from '../models/story';\nimport ImageAsset from '../models/image-asset';\nimport Room from '../models/room';\nimport Hotspot from '../models/hotspot';\n\n// Services\nimport ProjectDeserializer from './ProjectDeserializer';\n\nexport default class ProjectArchiveLoader {\n    private zip: JSZip;\n    private project: Project;\n\n    public async load(file: File): Promise<Project> {\n        this.zip = await JSZip.loadAsync(file);\n\n        await this.loadProjectData();\n\n        return this.project;\n    }\n\n    private async loadProjectData(): Promise<void> {\n        const data = await this.zip.file('project-data.json').async('text');\n\n        const serializer = new ProjectDeserializer();\n        this.project = await serializer.deserialize(JSON.parse(data));\n\n        this.loadStoryData(this.project.story);\n    }\n\n    private async loadStoryData(story: Story) {\n        story.soundtrack.data = await this.loadAssetData(story.soundtrack);\n\n        story.rooms.forEach((room) => {\n            this.loadRoomData(room);\n        });\n    }\n\n    private async loadRoomData(room: Room) {\n        room.panoramaUrl.backgroundImage.data = await this.loadAssetData(room.panoramaUrl.backgroundImage);\n        room.panoramaUrl.thumbnail.data = await this.loadAssetData(room.panoramaUrl.thumbnail);\n        room.backgroundMusic.data = await this.loadAssetData(room.backgroundMusic);\n        room.backgroundNarration.data = await this.loadAssetData(room.backgroundNarration);\n\n        room.hotspots.forEach((hotspot) => {\n            this.loadHotspotData(hotspot);\n        });\n    }\n\n    private async loadHotspotData(hotspot: Hotspot) {\n        hotspot.image.data = await this.loadAssetData(hotspot.image);\n        hotspot.audio.data = await this.loadAssetData(hotspot.audio);\n    }\n\n    private async loadAssetData(asset: ImageAsset | Soundtrack): Promise<string | ArrayBuffer> {\n        const mimeType = mime.contentType(asset.extension);\n        if (typeof mimeType === 'boolean') {\n            return;\n        }\n\n        const file = this.zip.file(`${asset.id}.${asset.extension}`);\n        if (!file) {\n            return;\n        }\n        const fileData = await file.async('blob');\n        const blob = new Blob([fileData], { type: mimeType });\n\n        return new Promise((resolve) => {\n            const reader = new FileReader();\n            reader.onload = function () {\n                resolve(reader.result);\n            };\n            reader.readAsDataURL(blob);\n        });\n    }\n}\n","// External libraries\nimport React, { useRef } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { connect } from 'react-redux';\n\n// External UI Components\nimport { makeStyles } from '@material-ui/core/styles';\nimport {\n    Box,\n    Button,\n    Container,\n    Typography,\n} from '@material-ui/core';\n\n// Components\nimport Header from '../header/Header';\nimport SignInDialog from '../dialogs/SignInDialog';\nimport UserStoriesSection from './UserStoriesSection';\nimport PublicStoriesSection from './PublicStoriesSection.tsx';\nimport EditorFileSelector from '../editor/EditorFileSelector';\n\n// Redux Actions\nimport { setCurrentRoom, setProject, setStory } from '../../redux/actions';\n\n// Util\nimport FileLoaderUtil from '../../util/FileLoader';\nimport resizeImageAsync from '../../util/ResizeImage';\n\n// Models\nimport Room from '../../models/room';\nimport Project from '../../models/project.ts';\n\n// Services\nimport ProjectArchiveLoader from '../../service/ProjectArchiveLoader';\n\nconst styles = makeStyles((theme) => {\n    return {\n        hero: {\n            backgroundColor: theme.palette.secondary.main,\n            padding: '32px 64px',\n            borderRadius: '24px',\n            textAlign: 'center',\n        },\n        uploadButton: {\n            padding: '24px 48px',\n            border: '2px dashed #e34b78',\n            borderRadius: '60px',\n            boxSizing: 'content-box',\n            fontSize: '20px',\n            fontWeight: 600,\n            marginTop: '32px',\n        },\n        uploadButtonContent: {\n            display: 'flex',\n            flexDirection: 'column',\n        },\n        input: {\n            display: 'none',\n        },\n    };\n});\nfunction LandingPageRoute({ setProjectAction, setStoryAction, setCurrentRoomAction }) {\n    const classes = styles();\n    const fileInput = useRef();\n    const history = useHistory();\n\n    const onStoryPanoramaSelected = (event) => {\n        const file = event.target.files && event.target.files[0];\n\n        processSelectedFile(file);\n    };\n\n    const processSelectedFile = async (file) => {\n        if (file.type === 'application/zip') {\n            loadStoryFromArchive(file);\n            return;\n        }\n\n        // Verify if input file is of valid type and format\n        await FileLoaderUtil.validateFileLoadEvent(file, 'image');\n\n        const fileData = await FileLoaderUtil.getBinaryFileData(file);\n        const resizedImage = await resizeImageAsync(fileData, 'backgroundImage');\n\n        // Create new project\n        const project = new Project();\n\n        const room = new Room();\n        room.panoramaUrl.backgroundImage.data = resizedImage.backgroundImage;\n        room.panoramaUrl.backgroundImage.extension = 'jpeg';\n        room.panoramaUrl.thumbnail.data = resizedImage.thumbnail;\n        room.panoramaUrl.thumbnail.extension = 'jpeg';\n\n        project.story.rooms.push(room);\n\n        // Set newly created story (and first room) as active story in redux\n        setProjectAction(project);\n        setStoryAction(project.story);\n        setCurrentRoomAction(room);\n\n        // Navigate to editor for further story edits\n        history.push('/editor');\n    }\n\n    const onCreateStoryClick = () => {\n        fileInput.current.click();\n    };\n\n    const loadStoryFromArchive = async (file) => {\n        const loader = new ProjectArchiveLoader();\n        const project = await loader.load(file);\n\n        setProjectAction(project);\n        setStoryAction(project.story);\n        setCurrentRoomAction(project.story.rooms[0]);\n\n        // Navigate to editor for further story edits\n        history.push('/editor');\n    }\n\n    return (\n        <>\n            <Header />\n            <Container maxWidth=\"md\">\n                <Box className={classes.hero}>\n                    <Typography variant=\"body1\" className=\"light-text\">\n                        Start creating your immersive story by combining 360 photos with audio recordings, images, and text\n                    </Typography>\n                    <input\n                        id=\"welcome-message-input\"\n                        type=\"file\"\n                        className={classes.input}\n                        ref={fileInput}\n                        onChange={onStoryPanoramaSelected}\n                    />\n                    <EditorFileSelector onChange={processSelectedFile}>\n                        <Button\n                            className={classes.uploadButton}\n                            size=\"large\"\n                            color=\"primary\"\n                            onClick={onCreateStoryClick}\n                        >\n                            <div className={classes.uploadButtonContent}>\n                                <Typography variant=\"h1\">\n                                    Upload 360 panorama image\n                                </Typography>\n                                <Typography variant=\"h2\">\n                                    or a story .zip\n                                </Typography>\n                            </div>\n                        </Button>\n                    </EditorFileSelector>\n                </Box>\n            </Container>\n            <UserStoriesSection />\n            <PublicStoriesSection />\n            <SignInDialog />\n        </>\n    );\n}\n\nconst mapStateToProps = () => {\n    return {};\n};\n\nexport default connect(\n    mapStateToProps,\n    {\n        setProjectAction: setProject,\n        setStoryAction: setStory,\n        setCurrentRoomAction: setCurrentRoom,\n    },\n)(LandingPageRoute);\n","export default function getHotspotIconName(hotspot, extension) {\n    const parts = [];\n\n    if (hotspot.image.data) {\n        parts.push('image');\n    }\n\n    if (hotspot.text) {\n        parts.push('text');\n    }\n\n    if (hotspot.audio.data) {\n        parts.push('audio');\n    }\n    return `icon-${parts.length > 0 ? parts.join('-') : 'add'}.${extension || 'png'}`;\n}\n","const LOCATION_JITTER = 10;\n\nfunction getPosNeg() {\n    return Math.random() > 0.5 ? -1 : 1;\n}\n\nfunction getRandomPosition() {\n    return getPosNeg() * LOCATION_JITTER * Math.random();\n}\n\nexport default class Vector2 {\n    constructor(x, y, z) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n    }\n\n    static build() {\n        const x = 180 + getRandomPosition();\n        const y = getRandomPosition();\n        return new Vector2(x, y);\n    }\n\n    getX() {\n        return this.x;\n    }\n\n    setX(x) {\n        this.x = x;\n    }\n\n    getY() {\n        return this.y;\n    }\n\n    setY(y) {\n        this.y = y;\n    }\n\n    setPosition(x, y) {\n        this.x = x;\n        this.y = y;\n    }\n\n    toString() {\n        return `<${this.x},${this.y}>`;\n    }\n\n    distanceTo(vector) {\n        const a = this.x - vector.x;\n        const b = this.y - vector.y;\n\n        return Math.sqrt(a * a + b * b);\n    }\n}\n","import Vector2 from './Vector2';\nimport Vector3 from './Vector3';\n\n// xy screen position to normalized position: [0, 360], [-90, 90]\nexport function normalizeAbsolutePosition(x, y) {\n    const xRelative = 360 * (x / window.innerWidth);\n    const yRelative = -180 * (y / window.innerHeight) + 90;\n    return new Vector2(xRelative, yRelative);\n}\n\nexport function clamp(value, lowerBound, upperBound) {\n    return Math.max(lowerBound, Math.min(upperBound, value));\n}\n\n// spherical to xyz\nexport function sphericalToCoordinate(radialDistance, theta, phi) {\n    const x = radialDistance * Math.cos(theta) * Math.sin(phi);\n    const z = radialDistance * Math.sin(theta) * Math.sin(phi);\n    const y = radialDistance * Math.cos(phi);\n    return new Vector3(x, y, z);\n}\n\n// given coordinates where 0 <= x <= 360 and -90 <= y <= 90, get 3D position\nexport function getCoordinatePosition(x, y, r) {\n    const radialDistance = r || 300;\n    const locationX = clamp(x, 0, 360);\n    const locationY = clamp(-y, -90, 90);\n    const radianPositionX = (locationX / 180) * Math.PI;\n    const radianPositionY = ((locationY + 90) / 180) * Math.PI;\n    return sphericalToCoordinate(radialDistance, radianPositionX, radianPositionY);\n}\n\n// normalized position [0, 360], [-90, 90] to screen position\nexport function denormalizePosition(x, y) {\n    const xAbsolute = (x / 360) * window.innerWidth;\n    const yAbsolute = (y / -180 + 0.5) * window.innerHeight;\n    return new Vector2(xAbsolute, yAbsolute);\n}\n","import { useEffect, useRef, useState } from 'react';\n\nimport {\n    IconButton,\n    Typography,\n    makeStyles,\n    Box,\n    Slider,\n    Switch,\n    Button,\n} from '@material-ui/core';\nimport { Close } from '@material-ui/icons';\n\nimport EditorFileSelector from './EditorFileSelector';\n\nconst styles = makeStyles(() => {\n    return {\n        audioSelectorContainer: {\n            display: 'flex',\n            flexDirection: 'column',\n        },\n        audioSelectorTitle: {\n            paddingRight: '16px',\n            marginBottom: '8px',\n            display: 'flex',\n            alignItems: 'center',\n        },\n        audioSelectorControls: {\n            width: '100%',\n            display: 'flex',\n            flexDirection: 'column',\n            boxShadow: '0px -1px 1px rgba(0, 0, 0, 0.08), 1px 0px 1px rgba(0, 0, 0, 0.08), -1px 0px 1px rgba(0, 0, 0, 0.08), 0px 1px 1px rgba(0, 0, 0, 0.08);',\n            borderRadius: '12px',\n        },\n        audioSelectorFileName: {\n            height: '48px',\n            display: 'flex',\n            flexDirection: 'row',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n            paddingLeft: '16px',\n            paddingRight: '16px',\n        },\n        audioSelectorIcon: {\n            cursor: 'pointer',\n        },\n        audioSelectorPlayControls: {\n            height: '48px',\n            display: 'flex',\n            flexDirection: 'row',\n            alignItems: 'center',\n            paddingLeft: '16px',\n            paddingRight: '16px',\n        },\n        audioSelectorVolumeControl: {\n            height: '48px',\n            display: 'flex',\n            flexDirection: 'row',\n            alignItems: 'center',\n            paddingLeft: '16px',\n            paddingRight: '16px',\n            backgroundColor: 'rgba(0, 0, 0, 0.05)',\n        },\n        audioSelectorLoopControl: {\n            height: '48px',\n            display: 'flex',\n            flexDirection: 'row',\n            alignItems: 'center',\n            paddingLeft: '16px',\n            paddingRight: '16px',\n            backgroundColor: 'rgba(0, 0, 0, 0.05)',\n            justifyContent: 'space-between',\n            borderRadius: '0px 0px 12px 12px',\n        },\n    };\n});\nexport default function EditorAudioSelector({\n    title,\n    name,\n    loop,\n    data,\n    volume,\n    onChange,\n    onPlayInLoopChange,\n    onVolumeChange,\n    onRemove,\n}) {\n    const classes = styles();\n\n    const audioElement = useRef();\n\n    const [audioData, setAudioData] = useState(data || null);\n    const [fileName, setFileName] = useState(name || '');\n    const [isPlaying, setIsPlaying] = useState(false);\n    const [currentTime, setCurrentTime] = useState(0);\n    const [duration, setDuration] = useState(0);\n\n    useEffect(() => {\n        audioElement.current.addEventListener('canplaythrough', setDurationCallback);\n        audioElement.current.addEventListener('timeupdate', setCurrentTimeCallback);\n    }, []);\n\n    useEffect(() => {\n        if (!isPlaying) {\n            audioElement.current.pause();\n        } else {\n            audioElement.current.play();\n        }\n    }, [isPlaying]);\n\n    const onAudioSelected = (event) => {\n        const file = event.target.files[0];\n\n        processSelectedFile(file);\n    };\n\n    const processSelectedFile = (file) => {\n        const fileReader = new FileReader();\n        fileReader.onloadend = () => {\n            setAudioData(fileReader.result);\n            setFileName(file.name);\n\n            onChange(fileReader.result, file.name, file.type);\n        };\n        fileReader.readAsDataURL(file);\n    }\n\n    const removeAudio = () => {\n        setAudioData(null);\n        setFileName('');\n\n        onRemove();\n    };\n\n    const togglePlay = () => {\n        setIsPlaying(!isPlaying);\n    };\n\n    const onSeek = (event, time) => {\n        setCurrentTime(time);\n\n        audioElement.current.currentTime = time;\n    };\n\n    const togglePlayInLoop = () => {\n        onPlayInLoopChange(!loop);\n    };\n\n    const handleVolumeChange = (event, value) => {\n        audioElement.current.volume = value / 100;\n\n        onVolumeChange(Math.max(0.01, value / 100));\n    }\n\n    const setCurrentTimeCallback = () => {\n        if (!audioElement.current) {\n            return;\n        }\n        setCurrentTime(audioElement.current.currentTime);\n    }\n\n    const setDurationCallback = () => {\n        if (!audioElement.current) {\n            return;\n        }\n        setDuration(audioElement.current.duration);\n    }\n\n    return (\n        <div className={classes.audioSelectorContainer}>\n            <audio\n                ref={audioElement}\n                src={audioData}\n                loop={loop}\n            />\n\n            <div className={classes.audioSelectorTitle}>\n                <Typography variant=\"body1\">\n                    {title}\n                </Typography>\n            </div>\n            <input type=\"file\" id=\"audio-selector-input\" style={{ display: 'none' }} onChange={onAudioSelected} />\n            {!audioData\n            && (\n                <EditorFileSelector onChange={processSelectedFile}>\n                    <Button variant=\"outlined\" fullWidth >\n                        Select audio\n                    </Button>\n                </EditorFileSelector>\n            )}\n            {audioData\n            && (\n                <div className={classes.audioSelectorControls}>\n                    <div className={classes.audioSelectorFileName}>\n                        <Typography variant=\"body2\">\n                            {fileName}\n                        </Typography>\n                        <IconButton onClick={removeAudio}>\n                            <Close />\n                        </IconButton>\n                    </div>\n                    <div className={classes.audioSelectorPlayControls}>\n                        <img src=\"icons/play-small.svg\" className={classes.audioSelectorIcon} onClick={togglePlay} alt=\"play\" />\n                        <Box m={1} />\n                        <Slider value={currentTime} max={duration} min={0} onChange={onSeek} />\n                    </div>\n                    <div className={classes.audioSelectorVolumeControl}>\n                        <img src=\"icons/volume-on.svg\" className={classes.audioSelectorIcon} alt=\"volume-control\" />\n                        <Box m={1} />\n                        <Typography variant=\"body2\" style={{ whiteSpace: 'nowrap' }}>\n                            Playback volume\n                        </Typography>\n                        <Box m={1} />\n                        <Slider value={volume * 100} max={100} min={0} onChange={handleVolumeChange} />\n                    </div>\n                    <div className={classes.audioSelectorLoopControl}>\n                        <div style={{ display: 'flex' }}>\n                            <img src=\"icons/loop.svg\" alt=\"play-in-loop\" />\n                            <Box m={1} />\n                            <Typography variant=\"body2\">\n                                Play in-loop\n                            </Typography>\n                        </div>\n                        <div>\n                            <Switch checked={loop || false} onChange={togglePlayInLoop} />\n                        </div>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n","import { Button, makeStyles, Typography } from '@material-ui/core';\nimport mime from 'mime-types';\nimport { useRef } from 'react';\n\nimport FileLoaderUtil from '../../util/FileLoader';\n\nimport EditorFileSelector from './EditorFileSelector.tsx';\n\nconst styles = makeStyles(() => {\n    return {\n        imageSelectorContainer: {\n            display: 'flex',\n            flexDirection: 'column',\n        },\n        imageSelectorTitle: {\n            paddingRight: '16px',\n            marginBottom: '8px',\n            display: 'flex',\n            alignItems: 'center',\n        },\n        imageSelectorImagePreview: {\n            width: '100%',\n            display: 'flex',\n            flexDirection: 'column',\n            borderRadius: '12px',\n            height: '150px',\n            backgroundSize: 'contain',\n            backgroundRepeat: 'no-repeat',\n            backgroundPosition: 'center',\n            position: 'relative',\n        },\n        optionsContainer: {\n            width: '100%',\n            height: '36px',\n            position: 'absolute',\n            right: '8px',\n            top: '8px',\n            display: 'flex',\n            justifyContent: 'flex-end',\n            alignItems: 'center',\n            cursor: 'pointer',\n        },\n        option: {\n            marginLeft: '8px',\n            width: '36px',\n            height: '36px',\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'center',\n            cursor: 'pointer',\n            boxShadow: '0px 0px 2px rgba(0, 0, 0, 0.15), 0px 4px 6px rgba(0, 0, 0, 0.15);',\n            borderRadius: '32px',\n            backgroundColor: 'white',\n        },\n    };\n});\nexport default function EditorImageSelector({\n    title,\n    value,\n    onChange,\n    onRemove,\n    removable,\n}) {\n    const classes = styles();\n\n    const imageInputElement = useRef();\n\n    const processSelectedImage = async (file) => {\n        // Verify if input file is of valid type and format\n        await FileLoaderUtil.validateFileLoadEvent(file, 'image');\n\n        const fileData = await FileLoaderUtil.getBinaryFileData(file);\n\n        const fileExtension = mime.extension(file.type);\n\n        onChange(fileData, fileExtension);\n    }\n\n    const selectImage = () => {\n        imageInputElement.current.click();\n    };\n\n    const onImageSelected = (event) => {\n        const file = event.target.files && event.target.files[0];\n        processSelectedImage(file);\n    };\n\n    const removeImage = () => {\n        onRemove();\n    };\n\n    return (\n        <div className={classes.imageSelectorContainer}>\n            <input\n                type=\"file\"\n                ref={imageInputElement}\n                onChange={onImageSelected}\n                style={{ display: 'none' }}\n            />\n            <div className={classes.imageSelectorTitle}>\n                <Typography variant=\"body1\">\n                    {title}\n                </Typography>\n            </div>\n            {!value\n            && (\n                <EditorFileSelector onChange={processSelectedImage}>\n                    <Button variant=\"outlined\" fullWidth >\n                        Select image\n                    </Button>\n                </EditorFileSelector>\n            )}\n            {value && (\n                <div className={classes.imageSelectorImagePreview} style={{ backgroundImage: `url(${value})` }}>\n                    <div className={classes.optionsContainer}>\n                        <div className={classes.option}>\n                            <img src=\"icons/pencil-dark.svg\" alt=\"remove\" onClick={selectImage} />\n                        </div>\n                        {removable && (\n                            <div className={classes.option}>\n                                <img src=\"icons/cancel.svg\" alt=\"remove\" onClick={removeImage} />\n                            </div>\n                        )}\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n","import React from 'react';\nimport mime from 'mime-types';\nimport { connect } from 'react-redux';\nimport {\n    Box,\n    Button,\n    Dialog,\n    DialogActions,\n    DialogContent,\n    DialogTitle,\n    IconButton,\n    makeStyles,\n    TextField,\n    Typography,\n} from '@material-ui/core';\nimport { Close } from '@material-ui/icons';\n\nimport EditorAudioSelector from './EditorAudioSelector';\nimport EditorImageSelector from './EditorImageSelector';\nimport {\n    setHotspotName,\n    setHotspotText,\n    setHotspotImage,\n    setHotspotAudio,\n} from '../../redux/actions';\nimport resizeImageAsync from '../../util/ResizeImage';\n\nconst styles = makeStyles(() => {\n    return {\n        root: {\n            padding: '0px',\n        },\n        titleContainer: {\n            width: '100%',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            height: '48px',\n        },\n        closeIcon: {\n            position: 'absolute',\n        },\n    };\n});\nfunction EditorEditHotspot({\n    hotspot,\n    onClose,\n    setHotspotNameAction,\n    setHotspotTextAction,\n    setHotspotImageAction,\n    setHotspotAudioAction,\n}) {\n    const classes = styles();\n\n    const onNameChange = (event) => {\n        setHotspotNameAction(hotspot.id, event.target.value);\n    };\n\n    const onTextChange = (event) => {\n        setHotspotTextAction(hotspot.id, event.target.value);\n    };\n\n    const onImageChange = async (imageData, extension) => {\n        const resizedImage = await resizeImageAsync(imageData, 'hotspotImage');\n\n        setHotspotImageAction(hotspot.id, resizedImage, extension);\n    };\n\n    const onImageRemove = () => {\n        setHotspotImageAction(hotspot.id, null, '');\n    };\n\n    const onAudioChange = (data, name, type) => {\n        const extension = mime.extension(type);\n\n        setHotspotAudioAction(hotspot.id, data, name, extension, hotspot.audio.loop, hotspot.audio.volume);\n    };\n\n    const onRemoveAudio = () => {\n        setHotspotAudioAction(hotspot.id, null, '', '', false, 0.5);\n    };\n\n    const onLoopChange = (loop) => {\n        setHotspotAudioAction(hotspot.id, hotspot.audio.data, hotspot.audio.fileName, hotspot.audio.extension, loop, hotspot.audio.volume);\n    }\n\n    const onVolumeChange = (volume) => {\n        setHotspotAudioAction(hotspot.id, hotspot.audio.data, hotspot.audio.fileName, hotspot.audio.extension, hotspot.audio.loop, volume);\n    }\n\n    return (\n        <Dialog onClose={onClose} open maxWidth=\"xs\" fullWidth>\n            <DialogTitle className={classes.root}>\n                <IconButton onClick={onClose} className={classes.closeIcon}>\n                    <Close />\n                </IconButton>\n                <div className={classes.titleContainer}>\n                    <Typography variant=\"body1\">\n                        Edit hotspot\n                    </Typography>\n                </div>\n            </DialogTitle>\n            <DialogContent>\n                <TextField\n                    size=\"small\"\n                    id=\"hotspot-name-input\"\n                    label=\"Hotspot name\"\n                    helperText=\"Enter a short name for your hotspot\"\n                    variant=\"outlined\"\n                    fullWidth\n                    value={hotspot.label}\n                    onChange={onNameChange}\n                />\n                <Box m={4} />\n                <TextField\n                    fullWidth\n                    multiline\n                    rows={3}\n                    id=\"hotspot-text-input\"\n                    label=\"Add text\"\n                    helperText=\"Describe your hotspot\"\n                    variant=\"outlined\"\n                    value={hotspot.text}\n                    onChange={onTextChange}\n                />\n                <Box m={4} />\n                <EditorImageSelector\n                    title=\"Add image\"\n                    value={hotspot.image.data}\n                    onChange={onImageChange}\n                    removable\n                    onRemove={onImageRemove}\n                />\n                <Box m={4} />\n                <EditorAudioSelector\n                    title=\"Add audio\"\n                    name={hotspot.audio.fileName}\n                    data={hotspot.audio.data}\n                    loop={hotspot.audio.loop}\n                    volume={hotspot.audio.volume}\n                    onPlayInLoopChange={onLoopChange}\n                    onVolumeChange={onVolumeChange}\n                    onChange={onAudioChange}\n                    onRemove={onRemoveAudio}\n                />\n            </DialogContent>\n            <DialogActions>\n                <Button variant=\"text\" color=\"primary\">\n                    Delete hotspot\n                </Button>\n            </DialogActions>\n        </Dialog>\n    );\n}\n\nconst mapStateToProps = () => {\n    return {};\n};\n\nexport default connect(\n    mapStateToProps,\n    {\n        setHotspotNameAction: setHotspotName,\n        setHotspotTextAction: setHotspotText,\n        setHotspotImageAction: setHotspotImage,\n        setHotspotAudioAction: setHotspotAudio,\n    },\n)(EditorEditHotspot);\n","// External libraries\nimport { makeStyles, Typography } from '@material-ui/core';\nimport React, { useEffect, useRef, useState } from 'react';\nimport { connect } from 'react-redux';\nimport { updateHotspot } from '../../redux/actions';\nimport getHotspotIconName from '../../util/GetHotspotIconName';\nimport { normalizeAbsolutePosition, denormalizePosition } from '../../util/IconPosition';\nimport Vector2 from '../../util/Vector2';\n\nimport EditorEditHotspot from './EditorEditHotspot';\n\nconst styles = makeStyles(() => {\n    return {\n        hotspotContainer: {\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n            position: 'fixed',\n        },\n        hotspotIconContainer: {\n            background: 'white',\n            border: '1px solid rgba(0, 0, 0, 0.1)',\n            boxSizing: 'border-box',\n            borderRadius: '48px',\n            width: '48px',\n            height: '48px',\n            boxShadow: '0px 4px 6px rgba(0, 0, 0, 0.15), 0px 0px 2px rgba(0, 0, 0, 0.15);',\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'center',\n        },\n        hotspotLabelContainer: {\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'center',\n            padding: '8px 12px',\n            background: 'rgba(255, 255, 255, 0.9)',\n            boxShadow: '0px 4px 6px rgba(0, 0, 0, 0.15), 0px 0px 2px rgba(0, 0, 0, 0.15);',\n            borderRadius: '4px',\n            marginTop: '4px',\n        },\n    };\n});\nfunction EditorHotspot({ hotspot }) {\n    const classes = styles();\n\n    const [position, setPosition] = useState({\n        x: 100,\n        y: 400,\n    });\n    const [editorOpen, setEditorOpen] = useState(false);\n\n    const hotspotElementRef = useRef();\n    const mouseOffset = useRef(new Vector2());\n    const mouseDownPosition = useRef(new Vector2());\n    const grabbed = useRef(false);\n\n    const style = {\n        left: `${position.x}px`,\n        top: `${position.y}px`,\n    };\n\n    function getMousePositionOnScreen(event) {\n        const mousePosition = new Vector2(event.clientX, event.clientY);\n        if (event.clientX && event.clientY) {\n            mousePosition.setPosition(\n                event.clientX,\n                event.clientY,\n            )\n        }\n        else if (event.touches[0]) {\n            mousePosition.setPosition(\n                event.touches[0].clientX,\n                event.touches[0].clientY,\n            )\n        }\n        else if (event.changedTouches[0]) {\n            mousePosition.setPosition(\n                event.changedTouches[0].clientX,\n                event.changedTouches[0].clientY,\n            )\n        }\n\n        return mousePosition;\n    }\n\n    function onMouseDown(event) {\n        const hotspotContainerRect = hotspotElementRef.current.getBoundingClientRect();\n\n        const mousePosition = getMousePositionOnScreen(event);\n\n        grabbed.current = true;\n        mouseOffset.current.setPosition(\n            mousePosition.x - hotspotContainerRect.left,\n            mousePosition.y - hotspotContainerRect.top,\n        );\n        mouseDownPosition.current.setPosition(\n            mousePosition.x,\n            mousePosition.y,\n        );\n    }\n\n    function onMouseMove(event) {\n        if (grabbed.current) {\n            const mousePosition = getMousePositionOnScreen(event);\n\n            const x = mousePosition.x - mouseOffset.current.getX();\n            const y = mousePosition.y - mouseOffset.current.getY();\n\n            setPosition({\n                x: x,\n                y: y,\n            });\n        }\n    }\n\n    function onMouseUp(event) {\n        grabbed.current = false;\n\n        const hotspotContainerRect = hotspotElementRef.current.getBoundingClientRect();\n        const hotspotCenter = new Vector2(\n            hotspotContainerRect.left + hotspotContainerRect.width / 2,\n            hotspotContainerRect.top + hotspotContainerRect.height / 2,\n        );\n\n        const mousePosition = getMousePositionOnScreen(event);\n\n        const mouseUpPosition = new Vector2(mousePosition.x, mousePosition.y);\n\n        if (mouseDownPosition.current.distanceTo(mouseUpPosition) < 5) {\n            setEditorOpen(true);\n        }\n\n        const location = normalizeAbsolutePosition(hotspotCenter.getX(), hotspotCenter.getY());\n        hotspot.location.setPosition(location.x, location.y);\n\n        // updateHotspotAction(hotspot);\n    }\n\n    function closeEditor() {\n        setEditorOpen(false);\n    }\n\n    useEffect(() => {\n        window.addEventListener('mousemove', onMouseMove);\n        window.addEventListener('touchmove', onMouseMove);\n\n        const absolutePosition = denormalizePosition(hotspot.location.x, hotspot.location.y);\n        setPosition({\n            x: absolutePosition.x,\n            y: absolutePosition.y,\n        });\n\n        return () => {\n            window.removeEventListener('mousemove', onMouseMove);\n            window.removeEventListener('touchmove', onMouseMove);\n        };\n    }, []);\n\n    return (\n        <div>\n            <div\n                className={classes.hotspotContainer}\n                style={style}\n                onTouchStart={onMouseDown}\n                onTouchEnd={onMouseUp}\n                onMouseDown={onMouseDown}\n                onMouseUp={onMouseUp}\n                ref={hotspotElementRef}\n            >\n                <div className={classes.hotspotIconContainer}>\n                    <img draggable={false} src={`icons/${getHotspotIconName(hotspot, 'svg')}`} alt=\"hotspot-icon\" />\n                </div>\n                <div className={classes.hotspotLabelContainer}>\n                    <Typography variant=\"body2\" color=\"textSecondary\">\n                        {hotspot.label}\n                    </Typography>\n                </div>\n            </div>\n            {editorOpen\n            && (\n                <EditorEditHotspot onClose={closeEditor} hotspot={hotspot} />\n            )}\n        </div>\n    );\n}\n\nconst mapStateToProps = () => {\n    return {};\n};\n\nexport default connect(\n    mapStateToProps,\n    {\n        updateHotspotAction: updateHotspot,\n    },\n)(EditorHotspot);\n","import React from 'react';\nimport {\n    Button,\n    Dialog,\n    DialogActions,\n    DialogContent,\n    DialogTitle,\n    FormControl,\n    IconButton,\n    InputLabel,\n    makeStyles,\n    MenuItem,\n    Select,\n    Typography,\n} from '@material-ui/core';\nimport { Close } from '@material-ui/icons';\nimport { connect } from 'react-redux';\n\nimport { updateDoor } from '../../redux/actions';\n\nconst styles = makeStyles(() => {\n    return {\n        root: {\n            padding: '0px',\n        },\n        titleContainer: {\n            width: '100%',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            height: '48px',\n        },\n        closeIcon: {\n            position: 'absolute',\n        },\n    };\n});\nfunction EditorEditDoor({\n    onClose,\n    door,\n    story,\n    updateDoorAction,\n}) {\n    const classes = styles();\n\n    const onChangeTargetRoom = (event) => {\n        door.targetRoomId = event.target.value;\n\n        updateDoorAction(door);\n    };\n\n    return (\n        <Dialog onClose={onClose} open maxWidth=\"xs\" fullWidth>\n            <DialogTitle className={classes.root}>\n                <IconButton onClick={onClose} className={classes.closeIcon}>\n                    <Close />\n                </IconButton>\n                <div className={classes.titleContainer}>\n                    <Typography variant=\"body1\">\n                        Edit door\n                    </Typography>\n                </div>\n            </DialogTitle>\n            <DialogContent>\n                <FormControl variant=\"outlined\" fullWidth size=\"small\">\n                    <InputLabel id=\"target-room-input-label\">Destination room</InputLabel>\n                    <Select\n                        labelId=\"target-room-input-label\"\n                        id=\"destination-room-select\"\n                        value={door.targetRoomId}\n                        onChange={onChangeTargetRoom}\n                        label=\"Destination room\"\n                    >\n                        {story.rooms.map((room) => {\n                            return (\n                                <MenuItem key={room.id} value={room.id}>\n                                    {room.name}\n                                </MenuItem>\n                            );\n                        })}\n                    </Select>\n                </FormControl>\n            </DialogContent>\n            <DialogActions>\n                <Button variant=\"text\" color=\"primary\">\n                    Delete door\n                </Button>\n            </DialogActions>\n        </Dialog>\n    );\n}\n\nconst mapStateToProps = (state) => {\n    return {\n        story: state.project.story,\n    };\n};\n\nexport default connect(\n    mapStateToProps,\n    {\n        updateDoorAction: updateDoor,\n    },\n)(EditorEditDoor);\n","// External libraries\nimport { makeStyles, Typography } from '@material-ui/core';\nimport React, { useEffect, useRef, useState } from 'react';\nimport { normalizeAbsolutePosition, denormalizePosition } from '../../util/IconPosition';\nimport Vector2 from '../../util/Vector2';\nimport EditorEditDoor from './EditorEditDoor';\n\nconst styles = makeStyles(() => {\n    return {\n        doorContainer: {\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n            position: 'fixed',\n        },\n        doorIconContainer: {\n            background: 'white',\n            border: '1px solid rgba(0, 0, 0, 0.1)',\n            boxSizing: 'border-box',\n            borderRadius: '48px',\n            width: '48px',\n            height: '48px',\n            boxShadow: '0px 4px 6px rgba(0, 0, 0, 0.15), 0px 0px 2px rgba(0, 0, 0, 0.15);',\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'center',\n        },\n        doorLabelContainer: {\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'center',\n            padding: '8px 12px',\n            background: 'rgba(255, 255, 255, 0.9)',\n            boxShadow: '0px 4px 6px rgba(0, 0, 0, 0.15), 0px 0px 2px rgba(0, 0, 0, 0.15);',\n            borderRadius: '4px',\n            marginTop: '4px',\n        },\n    };\n});\nexport default function EditorDoor({ door, targetRoomName }) {\n    const classes = styles();\n\n    const [position, setPosition] = useState({\n        x: 200,\n        y: 400,\n    });\n    const [editorOpen, setEditorOpen] = useState(false);\n\n    const doorElementRef = useRef();\n    const mouseOffset = useRef(new Vector2());\n    const mouseDownPosition = useRef(new Vector2());\n    const grabbed = useRef(false);\n\n    const style = {\n        left: `${position.x}px`,\n        top: `${position.y}px`,\n    };\n\n    function getMousePositionOnScreen(event) {\n        const mousePosition = new Vector2(event.clientX, event.clientY);\n        if (event.clientX && event.clientY) {\n            mousePosition.setPosition(\n                event.clientX,\n                event.clientY,\n            )\n        }\n        else if (event.touches[0]) {\n            mousePosition.setPosition(\n                event.touches[0].clientX,\n                event.touches[0].clientY,\n            )\n        }\n        else if (event.changedTouches[0]) {\n            mousePosition.setPosition(\n                event.changedTouches[0].clientX,\n                event.changedTouches[0].clientY,\n            )\n        }\n\n        return mousePosition;\n    }\n\n    function onMouseDown(event) {\n        const doorContainerRect = doorElementRef.current.getBoundingClientRect();\n\n        const mousePosition = getMousePositionOnScreen(event);\n\n        grabbed.current = true;\n        mouseOffset.current.setPosition(\n            mousePosition.x - doorContainerRect.left,\n            mousePosition.y - doorContainerRect.top,\n        );\n        mouseDownPosition.current.setPosition(\n            mousePosition.x,\n            mousePosition.y,\n        );\n    }\n\n    function onMouseMove(event) {\n        if (grabbed.current) {\n            const mousePosition = getMousePositionOnScreen(event);\n\n            const x = mousePosition.x - mouseOffset.current.getX();\n            const y = mousePosition.y - mouseOffset.current.getY();\n\n            setPosition({\n                x: x,\n                y: y,\n            });\n        }\n    }\n\n    function onMouseUp(event) {\n        grabbed.current = false;\n\n        const doorContainerRect = doorElementRef.current.getBoundingClientRect();\n        const doorCenter = new Vector2(\n            doorContainerRect.left + doorContainerRect.width / 2,\n            doorContainerRect.top + doorContainerRect.height / 2,\n        );\n\n        const mousePosition = getMousePositionOnScreen(event);\n\n        const mouseUpPosition = new Vector2(mousePosition.x, mousePosition.y);\n\n        if (mouseDownPosition.current.distanceTo(mouseUpPosition) < 5) {\n            setEditorOpen(true);\n        }\n\n        const location = normalizeAbsolutePosition(doorCenter.getX(), doorCenter.getY());\n        door.location.setPosition(location.x, location.y);\n    }\n\n    function closeEditor() {\n        setEditorOpen(false);\n    }\n\n    useEffect(() => {\n        window.addEventListener('mousemove', onMouseMove);\n        window.addEventListener('touchmove', onMouseMove);\n\n        const absolutePosition = denormalizePosition(door.location.x, door.location.y);\n        setPosition({\n            x: absolutePosition.x,\n            y: absolutePosition.y,\n        });\n\n        return () => {\n            window.removeEventListener('mousemove', onMouseMove);\n            window.removeEventListener('touchmove', onMouseMove);\n        };\n    }, []);\n\n    return (\n        <div>\n            <div\n                className={classes.doorContainer}\n                style={style}\n                onTouchStart={onMouseDown}\n                onTouchEnd={onMouseUp}\n                onMouseDown={onMouseDown}\n                onMouseUp={onMouseUp}\n                ref={doorElementRef}\n            >\n                <div className={classes.doorIconContainer}>\n                    <img draggable={false} src=\"/icons/door-icon.svg\" alt=\"door-icon\" />\n                </div>\n                <div className={classes.doorLabelContainer}>\n                    <Typography variant=\"body2\" color=\"textSecondary\">\n                        {targetRoomName}\n                    </Typography>\n                </div>\n            </div>\n            {editorOpen\n            && (\n                <EditorEditDoor onClose={closeEditor} door={door} />\n            )}\n        </div>\n    );\n}\n","// External libraries\nimport { FC } from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport mime from 'mime-types';\n\n// Styles\nimport { makeStyles } from '@material-ui/core';\n\n// Components\nimport EditorHotspot from './EditorHotspot';\nimport EditorDoor from './EditorDoor';\n\n// Redux\nimport { RootState } from '../../redux/reducers/index';\nimport { addHotspot } from '../../redux/actions';\n\n// Models\nimport Hotspot from '../../models/hotspot';\n\n// Util\nimport FileLoaderUtil from '../../util/FileLoader';\nimport resizeImageAsync from '../../util/ResizeImage';\nimport { normalizeAbsolutePosition } from '../../util/IconPosition';\n\nconst styles = makeStyles(() => {\n    return {\n        backgroundImage: {\n            width: '100%',\n            height: '100%',\n            position: 'fixed',\n        },\n    };\n});\n\nconst mapStateToProps = (state: RootState) => {\n    return {\n        story: state.project.story,\n    };\n};\n\nconst connector = connect(\n    mapStateToProps,\n    {\n        addHotspotAction: addHotspot\n    },\n);\n\ntype ReduxProps = ConnectedProps<typeof connector>\n\nconst EditorBackground: FC<ReduxProps> = ({ story, addHotspotAction }) => {\n    const classes = styles();\n\n    const getRoomName = (roomId: string) => {\n        const room = story.rooms.find((room) => {\n            return room.id === roomId;\n        });\n        return room.name;\n    }\n\n    const onFileDropped = async (event: React.DragEvent<HTMLDivElement>) => {\n        event.preventDefault();\n\n        const file = event.dataTransfer.files && event.dataTransfer.files[0];\n\n        const location = normalizeAbsolutePosition(event.clientX - 35, event.clientY - 30);\n\n        if (FileLoaderUtil.isFileOfType(file, 'image')) {\n            const fileData = await FileLoaderUtil.getBinaryFileData(file);\n            const fileExtension = mime.extension(file.type);\n            const resizedImage = await resizeImageAsync(fileData, 'hotspotImage');\n\n            const hotspot = new Hotspot();\n            hotspot.image.data = resizedImage;\n            if (typeof fileExtension === 'string') {\n                hotspot.image.extension = fileExtension;\n            }\n            hotspot.image.preloaded = true;\n\n            hotspot.location = location;\n\n            addHotspotAction(hotspot, story.getActiveRoom().id);\n        }\n        if (FileLoaderUtil.isFileOfType(file, 'audio')) {\n            const fileData = await FileLoaderUtil.getBinaryFileData(file);\n            const extension = mime.extension(file.type);\n\n            const hotspot = new Hotspot();\n            hotspot.audio.data = fileData;\n            if (typeof extension === 'string') {\n                hotspot.audio.extension = extension;\n            }\n            hotspot.audio.fileName = file.name;\n\n            hotspot.location = location;\n\n            addHotspotAction(hotspot, story.getActiveRoom().id);\n        }\n    }\n\n    const onDragOver = (event: React.DragEvent<HTMLDivElement>) => {\n        event.preventDefault();\n    }\n\n    const activeRoom = story.rooms.find((room) => {\n        return room.active;\n    });\n\n    return (\n        <div>\n            <img\n                src={activeRoom.panoramaUrl.backgroundImage.data}\n                alt=\"room-background\"\n                className={classes.backgroundImage}\n                draggable={false}\n                onDragOver={onDragOver}\n                onDrop={onFileDropped}\n            />\n            {activeRoom.hotspots.map((hotspot) => {\n                return (\n                    <EditorHotspot key={hotspot.id} hotspot={hotspot} />\n                );\n            })}\n            {activeRoom.doors.map((door) => {\n                return (\n                    <EditorDoor key={door.id} door={door} targetRoomName={getRoomName(door.targetRoomId)} />\n                );\n            })}\n        </div>\n    );\n}\n\nexport default connector(EditorBackground);\n","import React from 'react';\nimport mime from 'mime-types';\nimport { connect } from 'react-redux';\nimport {\n    Box,\n    Button,\n    Dialog,\n    DialogActions,\n    DialogContent,\n    DialogTitle,\n    IconButton,\n    makeStyles,\n    TextField,\n    Typography,\n} from '@material-ui/core';\nimport { Close } from '@material-ui/icons';\n\nimport EditorAudioSelector from './EditorAudioSelector';\n\nimport { setStoryName, setStoryTags, setStorySoundtrack } from '../../redux/actions';\nimport Soundtrack from '../../models/soundtrack';\n\nconst styles = makeStyles(() => {\n    return {\n        root: {\n            padding: '0px',\n        },\n        titleContainer: {\n            width: '100%',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            height: '48px',\n        },\n        closeIcon: {\n            position: 'absolute',\n        },\n    };\n});\nfunction EditorEditStory({\n    onClose,\n    story,\n    setStoryNameAction,\n    setStoryTagsAction,\n    setStorySoundtrackAction,\n}) {\n    const classes = styles();\n\n    const onNameChange = (event) => {\n        setStoryNameAction(event.target.value);\n    };\n\n    const onTagsChange = (event) => {\n        // Split comma separated tags into an array of tags\n        const tags = event.target.value.split(',');\n\n        setStoryTagsAction(tags);\n    };\n\n    const onSoundtrackChange = (fileData, fileName, fileMimeType) => {\n        const extension = mime.extension(fileMimeType);\n\n        const soundtrack = new Soundtrack();\n        soundtrack.fileName = fileName;\n        soundtrack.data = fileData;\n        soundtrack.extension = extension;\n\n        setStorySoundtrackAction(soundtrack);\n    };\n\n    const onSoundtrackRemove = () => {\n        const soundtrack = new Soundtrack();\n\n        // Create empty soundtrack\n        setStorySoundtrackAction(soundtrack);\n    };\n\n    const onPlayInLoopChange = (loop) => {\n        const soundtrack = new Soundtrack();\n        soundtrack.fileName = story.soundtrack.fileName;\n        soundtrack.data = story.soundtrack.data;\n        soundtrack.extension = story.soundtrack.extension;\n        soundtrack.loop = loop;\n        soundtrack.volume = story.soundtrack.volume;\n\n        setStorySoundtrackAction(soundtrack);\n    }\n\n    const onVolumeChange = (volume) => {\n        const soundtrack = new Soundtrack();\n        soundtrack.fileName = story.soundtrack.fileName;\n        soundtrack.data = story.soundtrack.data;\n        soundtrack.extension = story.soundtrack.extension;\n        soundtrack.loop = story.soundtrack.loop;\n        soundtrack.volume = volume;\n\n        setStorySoundtrackAction(soundtrack);\n    }\n\n    return (\n        <Dialog onClose={onClose} open maxWidth=\"xs\" fullWidth>\n            <DialogTitle className={classes.root}>\n                <IconButton onClick={onClose} className={classes.closeIcon}>\n                    <Close />\n                </IconButton>\n                <div className={classes.titleContainer}>\n                    <Typography variant=\"body1\">\n                        Edit story\n                    </Typography>\n                </div>\n            </DialogTitle>\n            <DialogContent>\n                <TextField\n                    size=\"small\"\n                    id=\"story-name-input\"\n                    label=\"Story name\"\n                    helperText=\"Enter a short name for your story\"\n                    variant=\"outlined\"\n                    fullWidth\n                    onChange={onNameChange}\n                    value={story.name}\n                />\n                <Box m={4} />\n                <TextField\n                    size=\"small\"\n                    fullWidth\n                    id=\"story-tags-input\"\n                    label=\"Story tags\"\n                    helperText=\"Use comma to add separate tags\"\n                    variant=\"outlined\"\n                    onChange={onTagsChange}\n                    value={story.tags.join(',')}\n                />\n                <Box m={4} />\n                <EditorAudioSelector\n                    title=\"Story soundtrack\"\n                    data={story.soundtrack.data}\n                    name={story.soundtrack.fileName}\n                    loop={story.soundtrack.loop}\n                    volume={story.soundtrack.volume}\n                    onPlayInLoopChange={onPlayInLoopChange}\n                    onVolumeChange={onVolumeChange}\n                    onChange={onSoundtrackChange}\n                    onRemove={onSoundtrackRemove}\n                />\n            </DialogContent>\n            <DialogActions>\n                <Button variant=\"text\" color=\"primary\">\n                    Delete story\n                </Button>\n            </DialogActions>\n        </Dialog>\n    );\n}\n\nconst mapStateToProps = (state) => {\n    return {\n        story: state.project.story,\n    };\n};\n\nexport default connect(\n    mapStateToProps,\n    {\n        setStoryNameAction: setStoryName,\n        setStoryTagsAction: setStoryTags,\n        setStorySoundtrackAction: setStorySoundtrack,\n    },\n)(EditorEditStory);\n","import { connect } from 'react-redux';\nimport { Box, CircularProgress, Divider } from '@material-ui/core';\nimport React, { useContext, useState } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport BackArrowIcon from '@material-ui/icons/KeyboardBackspace';\nimport IconButton from '@material-ui/core/IconButton';\nimport { Link as RouterLink } from 'react-router-dom';\nimport SaveIcon from '@material-ui/icons/SaveOutlined';\nimport EditorEditStory from './EditorEditStory';\nimport UserProfile from '../user-profile/UserProfile';\nimport FirebaseContext from '../../firebase/context.ts';\nimport ShareStoryDialog from '../dialogs/ShareStoryDialog';\n\nconst styles = makeStyles((theme) => {\n    return {\n        root: {\n            position: 'fixed',\n            top: 0,\n            zIndex: 5,\n            height: '96px',\n            paddingLeft: '24px',\n            paddingRight: '24px',\n            width: '100%',\n            marginLeft: 'auto',\n            marginRight: 'auto',\n            left: 0,\n            right: 0,\n            display: 'flex',\n            flexDirection: 'row',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n        },\n        previewContainer: {\n            position: 'fixed',\n            top: '0px',\n            left: '0px',\n            right: '0px',\n            zIndex: 5,\n            pointerEvents: 'none',\n            display: 'flex',\n            justifyContent: 'center',\n            height: '96px',\n            alignItems: 'center',\n        },\n        toolBar: {\n            backgroundColor: 'rgba(0,0,0,0.6)',\n            height: 48,\n            borderRadius: 24,\n            paddingRight: 22,\n            display: 'flex',\n            alignItems: 'center',\n        },\n        backButton: {\n            borderRadius: '50% 0 0 50%',\n            color: 'rgba(255, 255, 255, 0.7)',\n        },\n        signInButton: {\n            fontWeight: 600,\n        },\n        divider: {\n            height: 48,\n            backgroundColor: 'rgba(255, 255, 255, 0.2)',\n        },\n        storyName: {\n            marginLeft: theme.spacing(2),\n            color: 'rgba(255, 255, 255, 0.7)',\n        },\n        toolBarIcon: {\n            marginLeft: theme.spacing(2),\n            borderRadius: 0,\n            color: 'rgba(255, 255, 255, 0.7)',\n        },\n        vrButton: {\n            pointerEvents: 'all',\n            backgroundColor: theme.palette.primary.main,\n            '&:hover': {\n                backgroundColor: theme.palette.primary.dark,\n            },\n        },\n    };\n});\n\nfunction EditorHeader({ project }) {\n    const classes = styles();\n\n    const firebaseContext = useContext(FirebaseContext);\n\n    const [editStoryOpen, setEditStoryOpen] = useState(false);\n    const [shareStoryDialogOpen, setShareStoryDialogOpen] = useState(false);\n    const [saving, setSaving] = useState(false);\n\n    const onEditStory = () => {\n        setEditStoryOpen(true);\n    };\n\n    const onSaveStory = async () => {\n        setSaving(true);\n        await firebaseContext.saveProject(project);\n        setSaving(false);\n    };\n\n    const onCloseEditStory = () => {\n        setEditStoryOpen(false);\n    };\n\n    const onShareStory = () => {\n        setShareStoryDialogOpen(true);\n    };\n\n    const onCloseShareStory = () => {\n        setShareStoryDialogOpen(false);\n    };\n\n    const getHomeRoom = (rooms) => {\n        let homeRoom = rooms.find((room) => {\n            return room.isHome;\n        });\n        if (!homeRoom) {\n            homeRoom = rooms[0];\n        }\n        return homeRoom;\n    }\n\n    return (\n        <>\n            <Box className={classes.root}>\n                <Box className={classes.toolBar}>\n                    <IconButton className={classes.backButton} component={RouterLink} to=\"/\">\n                        <BackArrowIcon />\n                    </IconButton>\n                    <Divider className={classes.divider} orientation=\"vertical\" flexItem />\n                    <Box className={classes.storyName}>\n                        {project.story.name}\n                    </Box>\n                    <IconButton className={classes.toolBarIcon} onClick={onEditStory}>\n                        <img alt=\"edit-story\" src=\"/icons/pencil.svg\" />\n                    </IconButton>\n                    <IconButton className={classes.toolBarIcon} onClick={onSaveStory}>\n                        {saving ? <CircularProgress size={24} /> : <SaveIcon />}\n                    </IconButton>\n                    <IconButton className={classes.toolBarIcon} onClick={onShareStory}>\n                        <img alt=\"share-story\" src=\"/icons/share-icon-light.svg\" />\n                    </IconButton>\n                </Box>\n\n                <UserProfile />\n            </Box>\n            <div className={classes.previewContainer}>\n                <IconButton className={classes.vrButton} variant=\"contained\" color=\"primary\" component={RouterLink} to={`/view/${project.id}`}>\n                    <img className={classes.vrButtonLogo} src=\"/icons/vr.svg\" alt=\"preview-story\" />\n                </IconButton>\n            </div>\n            {editStoryOpen\n            && (\n                <EditorEditStory onClose={onCloseEditStory} />\n            )}\n            {shareStoryDialogOpen\n            && (\n                <ShareStoryDialog onClose={onCloseShareStory} thumbnailUrl={getHomeRoom(project.story.rooms).panoramaUrl.thumbnail.data} project={project} />\n            )}\n        </>\n    );\n}\n\nconst mapStateToProps = (state) => {\n    return {\n        project: state.project,\n    };\n};\n\nexport default connect(\n    mapStateToProps,\n    {},\n)(EditorHeader);\n","// External libraries\nimport React from 'react';\nimport { connect } from 'react-redux';\n\n// External UI Components\nimport SpeedDial from '@material-ui/lab/SpeedDial';\nimport SpeedDialIcon from '@material-ui/lab/SpeedDialIcon';\nimport SpeedDialAction from '@material-ui/lab/SpeedDialAction';\n\n// Style\nimport { makeStyles } from '@material-ui/core/styles';\n\n// Redux Actions\nimport { addHotspot, addDoor } from '../../redux/actions';\n\n// Models\nimport Hotspot from '../../models/hotspot';\nimport Door from '../../models/door';\n\nconst useStyles = makeStyles((theme) => {\n    return {\n        speedDial: {\n            position: 'absolute',\n            bottom: theme.spacing(4),\n            left: theme.spacing(2),\n        },\n    };\n});\n\nfunction EditorFab({ addHotspotAction, addDoorAction, story }) {\n    const classes = useStyles();\n    const [open, setOpen] = React.useState(false);\n\n    const handleClose = () => {\n        setOpen(false);\n    };\n\n    const handleAddHotspot = () => {\n        const hotspot = new Hotspot();\n        addHotspotAction(hotspot, story.getActiveRoom().id);\n\n        handleClose();\n    };\n\n    const handleAddDoor = () => {\n        const targetRoom = story.rooms.find((room) => {\n            return room.id !== story.getActiveRoom().id;\n        });\n\n        if (!targetRoom) {\n            return;\n        }\n\n        const door = new Door();\n        door.targetRoomId = targetRoom.id;\n        addDoorAction(door, story.getActiveRoom().id);\n\n        handleClose();\n    };\n\n    const handleOpen = () => {\n        setOpen(true);\n    };\n\n    const actions = [{\n        icon: <img src=\"/icons/door-icon.svg\" onClick={handleAddDoor} alt=\"add-door\" />,\n        name: 'Add door',\n    }, {\n        icon: <img src=\"/icons/icon-add.svg\" onClick={handleAddHotspot} alt=\"add-hotspot\" />,\n        name: 'Add hotspot',\n    }];\n\n    return (\n        <SpeedDial\n            ariaLabel=\"add-hotspot-menu\"\n            className={classes.speedDial}\n            icon={<SpeedDialIcon />}\n            onClose={handleClose}\n            onOpen={handleOpen}\n            open={open}\n            direction=\"up\"\n        >\n            {actions.map((action) => {\n                return (\n                    <SpeedDialAction\n                        key={action.name}\n                        icon={action.icon}\n                        tooltipTitle={action.name}\n                    />\n                );\n            })}\n        </SpeedDial>\n    );\n}\n\nconst mapStateToProps = (state) => {\n    return {\n        story: state.project.story,\n    };\n};\n\nexport default connect(\n    mapStateToProps,\n    {\n        addHotspotAction: addHotspot,\n        addDoorAction: addDoor,\n    },\n)(EditorFab);\n","// External libraries\nimport React from 'react';\n\n// External UI Components\nimport { Box } from '@material-ui/core';\n\n// Style\nimport { makeStyles } from '@material-ui/core/styles';\n\n// Components\nimport EditorFab from './EditorFab';\n\nconst styles = makeStyles(() => {\n    return {\n        root: {\n            position: 'fixed',\n            bottom: 0,\n            zIndex: 3,\n            height: '96px',\n            width: '100%',\n            marginLeft: '6px',\n            left: 0,\n            right: 0,\n            display: 'flex',\n            flexDirection: 'row',\n            justifyContent: 'center',\n            alignItems: 'center',\n        },\n    };\n});\n\nexport default function EditorFooter() {\n    const classes = styles();\n    return (\n        <Box className={classes.root}>\n            <EditorFab />\n        </Box>\n    );\n}\n","import React from 'react';\nimport { connect } from 'react-redux';\nimport mime from 'mime-types';\nimport {\n    Box,\n    Button,\n    Dialog,\n    DialogActions,\n    DialogContent,\n    DialogTitle,\n    IconButton,\n    makeStyles,\n    Switch,\n    TextField,\n    Typography,\n} from '@material-ui/core';\nimport { Close } from '@material-ui/icons';\n\nimport {\n    setRoomName,\n    setRoomIsHome,\n    setRoomBackground,\n    setRoomBackgroundMusic,\n    setRoomBackgroundNarration,\n} from '../../redux/actions';\n\nimport EditorAudioSelector from './EditorAudioSelector';\nimport EditorImageSelector from './EditorImageSelector';\nimport resizeImageAsync from '../../util/ResizeImage';\n\nconst styles = makeStyles(() => {\n    return {\n        root: {\n            padding: '0px',\n        },\n        titleContainer: {\n            width: '100%',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            height: '48px',\n        },\n        closeIcon: {\n            position: 'absolute',\n        },\n        homeInfoContainer: {\n            height: '48px',\n            display: 'flex',\n            flexDirection: 'row',\n            alignItems: 'center',\n            justifyContent: 'space-between',\n        },\n    };\n});\nfunction EditorEditRoom({\n    onClose,\n    setRoomNameAction,\n    setRoomIsHomeAction,\n    setRoomBackgroundAction,\n    setRoomBackgroundMusicAction,\n    setRoomBackgroundNarrationAction,\n    room,\n}) {\n    const classes = styles();\n\n    const onNameChange = (event) => {\n        setRoomNameAction(room.id, event.target.value);\n    };\n\n    const onBackgroundImageChange = async (fileData) => {\n        const resizedImage = await resizeImageAsync(fileData, 'backgroundImage');\n\n        setRoomBackgroundAction(room.id, resizedImage.backgroundImage, resizedImage.thumbnail);\n    };\n\n    const onBackgroundMusicChange = (data, name, type) => {\n        const extension = mime.extension(type);\n\n        setRoomBackgroundMusicAction(room.id, data, name, extension, room.backgroundMusic.loop, room.backgroundMusic.volume);\n    };\n\n    const onBackgroundMusicRemove = () => {\n        setRoomBackgroundMusicAction(room.id, null, '', '', false, 0.5);\n    };\n\n    const onBackgroundNarrationChange = (data, name, type) => {\n        const extension = mime.extension(type);\n\n        setRoomBackgroundNarrationAction(room.id, data, name, extension, room.backgroundNarration.loop, room.backgroundNarration.volume);\n    };\n\n    const onBackgroundNarrationRemove = () => {\n        setRoomBackgroundNarrationAction(room.id, null, '', '', false, 0.5);\n    };\n\n    const onHomeChange = () => {\n        setRoomIsHomeAction(room.id, !room.isHome);\n    }\n\n    const onBackgroundMusicLoopChange = (loop) => {\n        setRoomBackgroundMusicAction(\n            room.id,\n            room.backgroundMusic.data,\n            room.backgroundMusic.fileName,\n            room.backgroundMusic.extension,\n            loop,\n            room.backgroundMusic.volume\n        );\n    }\n\n    const onBackgroundMusicVolumeChange = (volume) => {\n        setRoomBackgroundMusicAction(\n            room.id,\n            room.backgroundMusic.data,\n            room.backgroundMusic.fileName,\n            room.backgroundMusic.extension,\n            room.backgroundMusic.loop,\n            volume\n        );\n    }\n\n    const onBackgroundNarrationLoopChange = (loop) => {\n        setRoomBackgroundNarrationAction(\n            room.id,\n            room.backgroundNarration.data,\n            room.backgroundNarration.fileName,\n            room.backgroundNarration.extension,\n            loop,\n            room.backgroundNarration.volume\n        );\n    }\n\n    const onBackgroundNarrationVolumeChange = (volume) => {\n        setRoomBackgroundNarrationAction(\n            room.id,\n            room.backgroundNarration.data,\n            room.backgroundNarration.fileName,\n            room.backgroundNarration.extension,\n            room.backgroundNarration.loop,\n            volume\n        );\n    }\n\n    return (\n        <Dialog onClose={onClose} open maxWidth=\"xs\" fullWidth>\n            <DialogTitle className={classes.root}>\n                <IconButton onClick={onClose} className={classes.closeIcon}>\n                    <Close />\n                </IconButton>\n                <div className={classes.titleContainer}>\n                    <Typography variant=\"body1\">\n                        Edit room\n                    </Typography>\n                </div>\n            </DialogTitle>\n            <DialogContent>\n                <TextField\n                    size=\"small\"\n                    id=\"room-name-input\"\n                    label=\"Room name\"\n                    helperText=\"Enter a short name for your room\"\n                    variant=\"outlined\"\n                    fullWidth\n                    value={room.name}\n                    onChange={onNameChange}\n                />\n                <Box m={2} />\n                <div className={classes.homeInfoContainer}>\n                    <div style={{ display: 'flex' }}>\n                        <img src=\"icons/home-icon.svg\" alt=\"mark-room-as-home\" />\n                        <Box m={1} />\n                        <Typography variant=\"body1\">\n                            Set as home\n                        </Typography>\n                    </div>\n                    <div>\n                        <Switch checked={room.isHome} onChange={onHomeChange} />\n                    </div>\n                </div>\n                <Box m={2} />\n                <EditorImageSelector\n                    title=\"Background Image\"\n                    value={room.panoramaUrl.thumbnail.data}\n                    onChange={onBackgroundImageChange}\n                />\n                <Box m={4} />\n                <EditorAudioSelector\n                    title=\"Room background music\"\n                    data={room.backgroundMusic.data}\n                    name={room.backgroundMusic.fileName}\n                    loop={room.backgroundMusic.loop}\n                    volume={room.backgroundMusic.volume}\n                    onPlayInLoopChange={onBackgroundMusicLoopChange}\n                    onVolumeChange={onBackgroundMusicVolumeChange}\n                    onChange={onBackgroundMusicChange}\n                    onRemove={onBackgroundMusicRemove}\n                />\n                <Box m={4} />\n                <EditorAudioSelector\n                    title=\"Room background narration\"\n                    data={room.backgroundNarration.data}\n                    name={room.backgroundNarration.fileName}\n                    loop={room.backgroundNarration.loop}\n                    volume={room.backgroundNarration.volume}\n                    onPlayInLoopChange={onBackgroundNarrationLoopChange}\n                    onVolumeChange={onBackgroundNarrationVolumeChange}\n                    onChange={onBackgroundNarrationChange}\n                    onRemove={onBackgroundNarrationRemove}\n                />\n            </DialogContent>\n            <DialogActions>\n                <Button variant=\"text\" color=\"primary\">\n                    Delete room\n                </Button>\n            </DialogActions>\n        </Dialog>\n    );\n}\n\nconst mapStateToProps = () => {\n    return {};\n};\n\nexport default connect(\n    mapStateToProps,\n    {\n        setRoomNameAction: setRoomName,\n        setRoomIsHomeAction: setRoomIsHome,\n        setRoomBackgroundAction: setRoomBackground,\n        setRoomBackgroundMusicAction: setRoomBackgroundMusic,\n        setRoomBackgroundNarrationAction: setRoomBackgroundNarration,\n    },\n)(EditorEditRoom);\n","import { Box, makeStyles, Typography } from '@material-ui/core';\nimport React, { useState } from 'react';\nimport { connect } from 'react-redux';\nimport EditorEditRoom from './EditorEditRoom';\n\nimport { setCurrentRoom } from '../../redux/actions';\n\nconst styles = makeStyles(() => {\n    return {\n        container: {\n            minWidth: '150px',\n            width: '175px',\n            height: '135px',\n            display: 'flex',\n            flexDirection: 'column',\n            borderRadius: '8px',\n            boxSizing: 'border-box',\n            border: '2px solid',\n            marginLeft: '8px',\n        },\n        roomInfoContainer: {\n            display: 'flex',\n            alignItems: 'center',\n            padding: '12px',\n            justifyContent: 'space-between'\n        },\n        roomActionsContainer: {\n            display: 'flex',\n            alignItems: 'center'\n        },\n        roomInfo: {\n            display: 'flex',\n            flexDirection: 'column',\n            cursor: 'pointer',\n        },\n        roomItemsInfo: {\n            display: 'flex',\n        },\n        roomThumbnail: {\n            width: '100%',\n            height: '100%',\n            display: 'flex',\n            backgroundSize: 'cover',\n            backgroundRepeat: 'no-repeat',\n            backgroundPosition: 'center',\n            borderRadius: '0px 0px 6px 6px',\n            position: 'relative',\n        },\n        editRoomContainer: {\n            position: 'absolute',\n            width: '100%',\n            height: '100%',\n            backgroundColor: 'rgba(255, 255, 255, 0.9)',\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'center',\n        },\n        editIcon: {\n            cursor: 'pointer',\n            width: '17px',\n            height: '17px'\n        },\n        icon: {\n            width: '25px',\n            height: '25px',\n            marginRight: '5px'\n        }\n    };\n});\nfunction EditorRoomCard({\n    room,\n    active,\n    setCurrentRoomAction,\n    hotspotCount,\n    doorCount,\n}) {\n    const classes = styles();\n\n    const [editDialogOpen, setEditDialogOpen] = useState(false);\n\n    const onEditRoom = () => {\n        setEditDialogOpen(true);\n    };\n\n    const closeEditDialog = () => {\n        setEditDialogOpen(false);\n    };\n\n    const goToRoom = () => {\n        setCurrentRoomAction(room);\n    };\n\n    return (\n        <>\n            <div className={classes.container} style={{ borderColor: active ? '#E34B78' : '#444444' }}>\n                <div className={classes.roomInfoContainer}>\n                    <div className={classes.roomInfo} onClick={goToRoom}>\n                        <Typography variant=\"body2\">\n                            {room.name}\n                        </Typography>\n                        <div className={classes.roomItemsInfo}>\n                            <img alt=\"hotspot-count\" src=\"icons/hotspot-count-icon.svg\" />\n                            <Box m={0.2} />\n                            <Typography variant=\"caption\">\n                                {hotspotCount}\n                            </Typography>\n                            <Box m={0.5} />\n                            <img alt=\"hotspot-count\" src=\"icons/door-count-icon.svg\" />\n                            <Box m={0.2} />\n                            <Typography variant=\"caption\">\n                                {doorCount}\n                            </Typography>\n                        </div>\n                    </div>\n                    <div className={classes.roomActionsContainer}>\n                        {room.isHome &&\n                        <img src='/icons/home-icon.svg' className={classes.icon} />}\n                        <img alt=\"edit-room\" src=\"icons/pencil-dark.svg\" className={classes.editIcon} onClick={onEditRoom} />\n                    </div>\n                </div>\n                <div\n                    className={classes.roomThumbnail}\n                    style={{ backgroundImage: `url(${room.panoramaUrl.thumbnail.data})` }}\n                />\n            </div>\n            {editDialogOpen\n            && (\n                <EditorEditRoom onClose={closeEditDialog} room={room} />\n            )}\n        </>\n    );\n}\n\nconst mapStateToProps = () => {\n    return {};\n};\n\nexport default connect(\n    mapStateToProps,\n    {\n        setCurrentRoomAction: setCurrentRoom,\n    },\n)(EditorRoomCard);\n","import { makeStyles } from '@material-ui/core';\nimport React, { useRef } from 'react';\nimport { connect } from 'react-redux';\nimport Room from '../../models/room';\nimport FileLoaderUtil from '../../util/FileLoader';\nimport resizeImageAsync from '../../util/ResizeImage';\n\nimport { addRoom, setCurrentRoom } from '../../redux/actions';\nimport EditorFileSelector from './EditorFileSelector';\n\nconst styles = makeStyles(() => {\n    return {\n        container: {\n            marginLeft: '8px',\n            width: '48px',\n            height: '135px',\n            minWidth: '48px',\n            display: 'flex',\n            flexDirection: 'column',\n            borderRadius: '8px',\n            boxSizing: 'border-box',\n            border: '2px dashed rgba(0, 0, 0, 0.6);',\n            justifyContent: 'center',\n            alignItems: 'center',\n        },\n        icon: {\n            width: '24px',\n            height: '24px',\n            cursor: 'pointer',\n        },\n    };\n});\nfunction EditorAddNewRoom({ addRoomAction, setCurrentRoomAction }) {\n    const classes = styles();\n\n    const fileInput = useRef();\n\n    const onAddNewRoom = () => {\n        fileInput.current.click();\n    };\n\n    const onRoomPanoramaSelected = async (event) => {\n        const file = event.target.files && event.target.files[0];\n\n        processSelectedFile(file);\n\n        // In order to allow user to upload multiple times, we need to reset input target value\n        // eslint-disable-next-line no-param-reassign\n        event.target.value = null;\n    };\n\n    const processSelectedFile = async (file) => {\n        // Verify if input file is of valid type and format\n        await FileLoaderUtil.validateFileLoadEvent(file, 'image');\n\n        const fileData = await FileLoaderUtil.getBinaryFileData(file);\n        const resizedImage = await resizeImageAsync(fileData, 'backgroundImage');\n\n        // Create new room\n        const room = new Room();\n        room.panoramaUrl.backgroundImage.data = resizedImage.backgroundImage;\n        room.panoramaUrl.backgroundImage.extension = 'jpeg';\n        room.panoramaUrl.thumbnail.data = resizedImage.thumbnail;\n        room.panoramaUrl.thumbnail.extension = 'jpeg';\n\n        addRoomAction(room);\n\n        setCurrentRoomAction(room);\n    }\n\n    return (\n        <>\n            <EditorFileSelector onChange={processSelectedFile}>\n                <div className={classes.container}>\n                    <img alt=\"add-new-room\" src=\"icons/plus.svg\" className={classes.icon} onClick={onAddNewRoom} />\n                </div>\n            </EditorFileSelector>\n            <input\n                id=\"welcome-message-input\"\n                type=\"file\"\n                className=\"invisible\"\n                ref={fileInput}\n                onChange={onRoomPanoramaSelected}\n            />\n        </>\n    );\n}\n\nconst mapStateToProps = () => {\n    return {};\n};\n\nexport default connect(\n    mapStateToProps,\n    {\n        addRoomAction: addRoom,\n        setCurrentRoomAction: setCurrentRoom,\n    },\n)(EditorAddNewRoom);\n","import { connect } from 'react-redux';\nimport {\n    Divider,\n    IconButton,\n    makeStyles,\n    Typography,\n} from '@material-ui/core';\nimport React, { useRef, useState } from 'react';\nimport EditorRoomCard from './EditorRoomCard';\nimport EditorAddNewRoom from './EditorAddNewRoom';\n\nconst styles = makeStyles(() => {\n    return {\n        container: {\n            width: '100%',\n            height: '100%',\n            position: 'fixed',\n            display: 'flex',\n            alignItems: 'center',\n            flexDirection: 'column-reverse',\n            pointerEvents: 'none',\n            zIndex: 5,\n        },\n        header: {\n            borderRadius: '12px 12px 0px 0px',\n            backgroundColor: 'white',\n            width: '600px',\n            height: '48px',\n            display: 'flex',\n            alignItems: 'center',\n            pointerEvents: 'all',\n        },\n        body: {\n            backgroundColor: 'white',\n            width: '600px',\n            height: '200px',\n            display: 'flex',\n            flexDirection: 'column',\n            pointerEvents: 'all',\n        },\n        paginationControls: {\n            width: '100%',\n            height: '48px',\n            display: 'flex',\n            flexDirection: 'row-reverse',\n            paddingRight: '12px',\n        },\n        roomCards: {\n            display: 'flex',\n            height: '100%',\n            alignItems: 'center',\n            overflow: 'hidden',\n            flex: 1,\n        },\n    };\n});\nfunction EditorRoomsPanel({ rooms, story }) {\n    const classes = styles();\n\n    const scrollPosition = useRef(0);\n\n    const roomCardsRef = useRef();\n\n    const [expanded, setExpanded] = useState(false);\n\n    const onToggle = () => {\n        setExpanded(!expanded);\n    };\n\n    const scrollRight = () => {\n        scrollPosition.current += 250;\n\n        scrollPosition.current = Math.min(roomCardsRef.current.scrollWidth - roomCardsRef.current.clientWidth, scrollPosition.current);\n\n        roomCardsRef.current.scroll({\n            left: scrollPosition.current,\n            behavior: 'smooth',\n        });\n    };\n\n    const scrollLeft = () => {\n        scrollPosition.current -= 250;\n\n        scrollPosition.current = Math.max(0, scrollPosition.current);\n\n        roomCardsRef.current.scroll({\n            left: scrollPosition.current,\n            behavior: 'smooth',\n        });\n    };\n\n    return (\n        <div className={classes.container}>\n            {expanded\n            && (\n                <div className={classes.body}>\n                    <Divider style={{ width: '100%' }} />\n                    <div className={classes.paginationControls}>\n                        <IconButton onClick={scrollRight}>\n                            <img alt=\"move-right\" src=\"icons/chevron-right.svg\" />\n                        </IconButton>\n                        <IconButton onClick={scrollLeft}>\n                            <img alt=\"move-right\" src=\"icons/chevron-left.svg\" />\n                        </IconButton>\n                    </div>\n                    <div className={classes.roomCards} ref={roomCardsRef}>\n                        {rooms.map((room) => {\n                            return (\n                                <EditorRoomCard\n                                    key={room.id}\n                                    room={room}\n                                    active={story.getActiveRoom().id === room.id}\n                                    hotspotCount={room.hotspots.length}\n                                    doorCount={room.doors.length}\n                                />\n                            );\n                        })}\n                        <EditorAddNewRoom />\n                    </div>\n                </div>\n            )}\n            <div className={classes.header}>\n                <IconButton onClick={onToggle}>\n                    <img alt=\"toggle-rooms-panel\" src={`icons/chevron-${expanded ? 'bottom' : 'top'}.svg`} />\n                </IconButton>\n                <Typography variant=\"body2\">\n                    Rooms ({rooms.length})\n                </Typography>\n            </div>\n        </div>\n    );\n}\n\nconst mapStateToProps = (state) => {\n    return {\n        story: state.project.story,\n        rooms: state.project.story.rooms,\n    };\n};\n\nexport default connect(\n    mapStateToProps,\n    {},\n)(EditorRoomsPanel);\n","import React from 'react';\nimport EditorBackground from './EditorBackground.tsx';\nimport EditorHeader from './EditorHeader';\nimport EditorFooter from './EditorFooter';\nimport EditorRoomsPanel from './EditorRoomsPanel';\n\nexport default function EditorRoute() {\n    return (\n        <>\n            <EditorHeader />\n            <EditorBackground />\n            <EditorFooter />\n            <EditorRoomsPanel />\n        </>\n    );\n}\n","const fontSize = 26;\n\nclass TextLine {\n    constructor(x, y, text) {\n        this.x = x;\n        this.y = y;\n        this.text = text;\n    }\n}\n\nfunction printWrappedText(context, text, x, y, maxWidth, lineHeight) {\n    const lines = [];\n    const wordList = text.split(/(\\s+)/);\n    let lineContent = '';\n\n    wordList.forEach((word) => {\n        const proposedLine = `${lineContent + word} `;\n        const metrics = context.measureText(proposedLine);\n\n        if (metrics.width > maxWidth) {\n            lines.push(new TextLine(x, y, lineContent.trim()));\n            lineContent = `${word} `;\n            y += lineHeight;\n        } else {\n            lineContent = proposedLine;\n        }\n    });\n\n    lines.push(new TextLine(x, y, lineContent.trim()));\n\n    return lines;\n}\n\nexport default function getTextureSizeFromText(textContext) {\n    const width = 2 * 600;\n    const drawCanvas = document.createElement('canvas');\n    const g2d = drawCanvas.getContext('2d');\n    const fixedFontSize = fontSize * 2;\n\n    drawCanvas.width = width;\n    drawCanvas.height = 2 * 800;\n    g2d.font = `${fixedFontSize}pt Nunito`;\n    g2d.fillStyle = 'rgba(0, 0, 0, 0.7)';\n    g2d.fillRect(0, 0, drawCanvas.width, drawCanvas.height);\n    g2d.fillStyle = 'white';\n\n    const textLines = printWrappedText(g2d, textContext, 10, fixedFontSize + 10, width, fixedFontSize + 8);\n    const height = textLines[textLines.length - 1].y + fixedFontSize;\n\n    // Print text onto canvas\n    textLines.forEach((textLine) => {\n        return g2d.fillText(textLine.text, textLine.x, textLine.y);\n    });\n\n    return {\n        width: width,\n        height: height,\n        drawCanvas: drawCanvas,\n    };\n}\n","export default function getImageFromData(imageData) {\n    return new Promise((resolve) => {\n        const image = new Image();\n        image.crossOrigin = 'anonymous';\n        image.onload = () => {\n            resolve(image);\n        };\n        image.src = imageData;\n    });\n}\n","import React, { useEffect, useState } from 'react';\n\nimport { Entity } from 'aframe-react';\nimport getTextureSizeFromText from '../util/TextMaterialBuilder';\nimport { fitToMax } from '../util/ResizeImage';\nimport getImageFromData from '../util/GetImageFromData';\n\nexport default ({ hotspot }) => {\n    const [imageSrc, setImageSrc] = useState('');\n    const [imageWidth, setImageWidth] = useState(0);\n    const [imageHeight, setImageHeight] = useState(0);\n\n    useEffect(() => {\n        setupAssets();\n    }, []);\n\n    const params = () => {\n        return `coordinates: ${hotspot.location.getX()} ${hotspot.location.getY()};\n            isAudioOnly: ${isAudioOnly()}`;\n    };\n\n    const isAudioOnly = () => {\n        return !hotspot.image.data && !hotspot.text;\n    };\n\n    const setupAssets = async () => {\n        const assets = {};\n\n        const hasImageContent = Boolean(hotspot.image.data);\n        const hasTextContent = Boolean(hotspot.text);\n        // const hasAudio: boolean = !!hotspot.audioContent.hasAsset();\n        // const location = hotspot.getLocation();\n        // const position = getCoordinatePosition(location.getX(), location.getY(), 250);\n\n        let width = 0;\n        let height = 0;\n        let textSize = null;\n        let adjustedHeight = 0;\n\n        if (hasTextContent) {\n            textSize = getTextureSizeFromText(hotspot.text);\n\n            width = textSize.width > width ? textSize.width : width;\n            height += textSize.height;\n        }\n\n        // Building material\n        const canvas = document.createElement('canvas');\n        const canvasContext = canvas.getContext('2d');\n\n        canvas.width = width;\n        canvas.height = height;\n\n        if (hasImageContent) {\n            const image = await getImageFromData(hotspot.image.data);\n            const imgWidth = image.width;\n            const imgHeight = image.height;\n\n            const adjustedWidth = imgWidth >= imgHeight && width > 0 ? width : imgWidth;\n\n            adjustedHeight = imgHeight * (adjustedWidth / imgWidth);\n            width = image.width > width ? image.width : width;\n\n            height += adjustedHeight;\n            canvas.width = width;\n            canvas.height = height;\n\n            canvasContext.drawImage(image, width / 2 - adjustedWidth / 2, 0, adjustedWidth, adjustedHeight);\n        }\n\n        if (textSize !== null) {\n            const textCanvas = document.createElement('canvas');\n            const textCanvasContext = textCanvas.getContext('2d');\n\n            textCanvas.width = textSize.width;\n            textCanvas.height = textSize.height;\n\n            textCanvasContext.drawImage(textSize.drawCanvas, 0, 0, width, height, 0, 0, width, height);\n            canvasContext.drawImage(textCanvas, 0, adjustedHeight, width, textSize.height);\n        }\n\n        if (hasTextContent || hasImageContent) {\n            const imageSize = fitToMax(canvas.width, canvas.height, 3);\n            assets.image = {\n                src: canvas.toDataURL('png'),\n                width: imageSize.getX(),\n                height: imageSize.getY(),\n            };\n        }\n\n        if (assets.image) {\n            setImageSrc(assets.image.src);\n            setImageWidth(assets.image.width);\n            setImageHeight(assets.image.height);\n        }\n    };\n\n    return (\n        <Entity\n            hotspot={params()}\n            class=\"hotspot\"\n            geometry=\"primitive: plane\"\n            material=\"\n                transparent: true;\n                alphaTest:.5;\n                opacity:0\"\n            scale=\"100 100\"\n            look-at=\"[camera]\"\n        >\n            <Entity\n                class=\"outer-trigger raycast-trigger\"\n                material=\"\n                    opacity: 0;\n                    alphaTest: .5;\n                    transparent: true\"\n                geometry=\"\n                    primitive: plane;\n                    height: 1;\n                    width: 1;\"\n                position=\"0 0 -1\"\n            />\n            <Entity\n                class=\"center-trigger raycast-trigger\"\n                material=\"\n                    opacity: 0;\n                    alphaTest: .5;\n                    transparent: true\"\n                geometry=\"\n                    primitive: plane;\n                    height: .2;\n                    width: .2;\"\n                position=\"0 0 -1\"\n            />\n            <Entity\n                class=\"content-zone-trigger raycast-trigger\"\n                material=\"\n                    opacity: 0;\n                    alphaTest: .5;\n                    transparent: true\"\n                geometry=\"\n                    primitive: plane;\n                    height: .5;\n                    width: .5\"\n            />\n\n            <Entity\n                pulsating-marker\n                animation__pulsation=\"\n                    property: scale;\n                    from: 1 1 1;\n                    to: 1.3 1.3 1.3;\n                    loop: true;\n                    dur: 700;\n                    dir: alternate;\"\n            >\n                <a-image\n                    src=\"/icons/icon-hotspot-default.png\"\n                    alpha-test=\".5\"\n                    animation__scale-in=\"\n                        property: scale;\n                        dur: 500;\n                        to: 1 1 1;\n                        startEvents: start-scale-in;\n                        pauseEvents: stop-scale-in;\"\n                    animation__scale-out=\"\n                        property: scale;\n                        dur: 500;\n                        to: .001 .001 .001;\n                        startEvents: start-scale-out;\n                        pauseEvents: stop-scale-out;\"\n                />\n            </Entity>\n\n            {isAudioOnly()\n            && (\n                <a-image\n                    src=\"/icons/icon-audio.png\"\n                    position=\"0 0 .1\"\n                    hidden-marker\n                    opacity=\"0\"\n                    alpha-test=\".5\"\n                    scale=\".5 .5 .5\"\n                    animation__fade-in=\"\n                        property: opacity;\n                        from: 0;\n                        to: 1;\n                        dur: 500;\n                        pauseEvents: stop-fade-in;\n                        startEvents: start-fade-in;\"\n                    animation__fade-out=\"\n                        property: opacity;\n                        from: 1;\n                        to: 0;\n                        dur: 500;\n                        pauseEvents: stop-fade-out;\n                        startEvents: start-fade-out;\n                    \"\n                />\n            )}\n\n            {!isAudioOnly()\n            && (\n                <a-image\n                    src=\"/icons/icon-hotspot-hover.png\"\n                    hidden-marker\n                    position=\"0 0 .1\"\n                    opacity=\"0\"\n                    alpha-test=\".5\"\n                    animation__fade-in=\"\n                        property: opacity;\n                        from: 0;\n                        to: 1;\n                        dur: 500;\n                        pauseEvents: stop-fade-in;\n                        startEvents: start-fade-in;\"\n                    animation__fade-out=\"\n                        property: opacity;\n                        from: 1;\n                        to: 0;\n                        dur: 500;\n                        pauseEvents: stop-fade-out;\n                        startEvents: start-fade-out;\"\n                />\n            )}\n\n            <a-text\n                value={hotspot.label}\n                class=\"hotspot-name\"\n                align=\"center\"\n                visible=\"false\"\n                position=\"0 -.5 0\"\n                alpha-test=\".5\"\n            />\n\n            <a-entity\n                hotspot-content\n                class=\"hotspot-content\"\n                scale=\"0 0 0\"\n                width=\"2\"\n                height=\"2\"\n                position=\"0 0 -.3\"\n            >\n                {(hotspot.text || hotspot.image.data)\n                && (\n                    <a-image\n                        src={imageSrc}\n                        width={imageWidth}\n                        height={imageHeight}\n                    />\n                )}\n                {hotspot.audio.data\n                && (\n                    <a-sound\n                        src={hotspot.audio.data}\n                        volume={hotspot.audio.volume}\n                        loop={hotspot.audio.loop}\n                        sound=\"positional: false\"\n                    />\n                )}\n            </a-entity>\n        </Entity>\n    );\n}\n","import React from 'react';\n\nexport default function Door({ door, targetRoomName }) {\n    const params = () => {\n        const { location, targetRoomId } = door;\n\n        return `coordinates: ${location.x} ${location.y};\n                roomId: ${targetRoomId};\n                autoTime: ${false}`;\n    };\n\n    return (\n        <a-entity\n            door={params()}\n            class=\"door\"\n            geometry=\"primitive: plane\"\n            material=\"\n                transparent: true;\n                opacity: 0\"\n            scale=\"100 100\"\n            opacity=\"1\"\n            look-at=\"[camera]\"\n        >\n\n            <a-entity\n                class=\"outer-door-trigger raycast-trigger\"\n                material=\"\n                    opacity: 0 0;\n                    transparent: true\"\n                geometry=\"\n                    primitive: plane;\n                    height: 1;\n                    width: 1;\"\n                position=\"0 0 -1\"\n            />\n\n            <a-entity\n                class=\"center-door-trigger raycast-trigger\"\n                material=\"\n                    opacity: 0 0;\n                    transparent: true\"\n                geometry=\"\n                    primitive: plane;\n                    height: .5;\n                    width: .5;\"\n                position=\"0 0 -1\"\n            />\n\n            <a-text\n                value={targetRoomName}\n                class=\"hotspot-name\"\n                align=\"center\"\n                position=\"0 -.5 0\"\n                visible=\"false\"\n                alpha-test=\".5\"\n            />\n\n            <a-entity\n                door-pulsating-marker\n                animation__scale-out=\"\n                    property: scale;\n                    to: .001 .001 .001;\n                    dur: 200;\n                    startEvents: start-scale-out;\n                    pauseEvents: stop-scale-out;\"\n                animation__scale-in=\"\n                    property: scale;\n                    dur: 200;\n                    to: 1 1 1;\n                    startEvents: start-scale-in;\n                    pauseEvents: stop-scale-in\"\n            >\n                <a-image\n                    src=\"/icons/icon-hotspot-default.png\"\n                    alpha-test=\".5\"\n                    animation__pulsation=\"\n                        property: scale;\n                        from: 1 1 1;\n                        to: .001 .001 .001;\n                        loop: true;\n                        dur: 1500;\n                        dir: normal;\"\n                />\n\n            </a-entity>\n\n            <a-image\n                src=\"/icons/icon-doorhotspot.png\"\n                opacity=\"0\"\n                animation__fade-in=\"\n                    property: opacity;\n                    from: 0;\n                    to: 1;\n                    dur: 500;\n                    pauseEvents: stop-fade-in;\n                    startEvents: start-fade-in;\n                \"\n                animation__fade-out=\"\n                    property: opacity;\n                    from: 1;\n                    to: 0;\n                    dur: 500;\n                    pauseEvents: stop-fade-out;\n                    startEvents: start-fade-out;\n                \"\n                position=\"0 0 .1\"\n                hidden-marker\n                width=\".5\"\n                height=\".5\"\n            />\n\n        </a-entity>\n    );\n}\n","export default function loadImageForRoom(room) {\n    if (room.panoramaUrl.backgroundImage.preloaded) {\n        return room.panoramaUrl.backgroundImage.data;\n    }\n\n    const url = room.panoramaUrl.backgroundImage.data;\n\n    return new Promise((resolve) => {\n        const image = new Image();\n        image.crossOrigin = 'anonymous';\n        image.onload = () => {\n            const canvas = document.createElement(\"canvas\");\n            canvas.width = image.width;\n            canvas.height = image.height;\n\n            const ctx = canvas.getContext(\"2d\");\n            ctx.drawImage(image, 0, 0);\n\n            const dataURL = canvas.toDataURL(\"image/png\");\n\n            room.panoramaUrl.backgroundImage.data = dataURL;\n\n            room.panoramaUrl.backgroundImage.preloaded = true;\n\n            resolve();\n        }\n        image.src = url;\n    });\n}\n","// External libraries\nimport React, { useEffect, useRef } from 'react';\nimport { connect } from 'react-redux';\nimport 'aframe';\n\nimport Hotspot from './Hotspot';\nimport Door from './Door';\nimport { setCurrentRoom } from '../redux/actions';\n\nimport loadImageForRoom from '../util/ImageLoader';\nimport { IconButton, makeStyles, Typography } from '@material-ui/core';\n\nconst styles = makeStyles(() => {\n    return {\n        enterVRContainer: {\n            position: 'fixed',\n            right: '24px',\n            bottom: '24px',\n            width: '48px',\n            height: '48px',\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'center',\n            backgroundColor: 'rgba(0,0,0,0.6)',\n            borderRadius: 24,\n        }\n    };\n});\nfunction Scene({ story, setCurrentRoomAction }) {\n    const classes = styles();\n\n    const sceneRef = useRef();\n    const skyRef = useRef();\n\n    useEffect(() => {\n        sceneRef.current.addEventListener('switch-room', (e) => {\n            goToRoom(e.detail);\n        });\n    }, []);\n\n    const goToRoom = async (roomId) => {\n        const targetRoom = story.rooms.find((room) => {\n            return room.id === roomId;\n        });\n\n        await loadImageForRoom(targetRoom);\n\n        setCurrentRoomAction(targetRoom);\n\n        skyRef.current.addEventListener('materialtextureloaded', function () {\n            sceneRef.current.emit('reset-camera');\n        });\n    };\n\n    const getRoomName = (roomId) => {\n        const room = story.rooms.find((room) => {\n            return room.id === roomId;\n        });\n        return room.name;\n    }\n\n    const activeRoom = story.rooms.find((room) => {\n        return room.active;\n    });\n\n    return (\n        <>\n            <a-scene ref={sceneRef} preview-space device-orientation-permission-ui=\"enabled: true\" loading-screen=\"enabled: false\" vr-mode-ui=\"enterVRButton: #enterVRButton;\">\n                <a-camera\n                    wasd-controls-enabled=\"false\"\n                    look-controls-enabled=\"true\"\n                    fov=\"65\"\n                    animation__zoom-in=\"\n                        property: zoom;\n                        from: 1;\n                        startEvents: start-zoom-in;\n                        to: 5;\"\n                    zoom=\"1\"\n                    near=\"1\"\n                >\n                    {story.soundtrack.data &&\n                    <a-sound\n                        src={story.soundtrack.data}\n                        autoplay={true}\n                        volume={story.soundtrack.volume}\n                        loop={story.soundtrack.loop}\n                        class=\"soundtrack-audio\"\n                    >\n                    </a-sound>}\n\n                    <a-cursor\n                        id=\"cursor\"\n                        animation__scale-out=\"property: scale; from: 1 1 1; to: .2 .2 .2; startEvents: start-scale-out;\"\n                    />\n                </a-camera>\n\n                {activeRoom.hotspots.map((hotspot) => {\n                    return (\n                        <Hotspot key={hotspot.id} hotspot={hotspot} />\n                    );\n                })}\n\n                {activeRoom.doors.map((door) => {\n                    return (\n                        <Door key={door.id} door={door} targetRoomName={getRoomName(door.targetRoomId)} />\n                    );\n                })}\n\n                {activeRoom &&\n                <a-entity>\n                    {activeRoom.backgroundNarration.data &&\n                    <a-sound\n                        src={activeRoom.backgroundNarration.data}\n                        autoplay={true}\n                        volume={activeRoom.backgroundNarration.volume}\n                        loop={activeRoom.backgroundNarration.loop}\n                        class=\"narration-audio\"\n                        sound=\"positional: false\"\n                    >\n                    </a-sound>}\n                    {activeRoom.backgroundMusic.data &&\n                    <a-sound\n                        src={activeRoom.backgroundMusic.data}\n                        autoplay={true}\n                        volume={activeRoom.backgroundMusic.volume}\n                        loop={activeRoom.backgroundMusic.loop}\n                        sound=\"positional: false\"\n                    >\n                    </a-sound>}\n                </a-entity>}\n\n                <a-sky ref={skyRef} src={activeRoom.panoramaUrl.backgroundImage.data} radius=\"512\" />\n            </a-scene>\n            <div className={classes.enterVRContainer}>\n                <IconButton id=\"enterVRButton\">\n                    <Typography className=\"light-text-90\">\n                        VR\n                    </Typography>\n                </IconButton>\n            </div>\n        </>\n    );\n}\n\nconst mapStateToProps = (state) => {\n    return {\n        story: state.project.story,\n    };\n};\n\nexport default connect(\n    mapStateToProps,\n    {\n        setCurrentRoomAction: setCurrentRoom,\n    },\n)(Scene);\n","import { useHistory, useParams } from 'react-router-dom';\n\nimport { IconButton, makeStyles } from '@material-ui/core';\n\nimport ArrowBackIcon from '@material-ui/icons/KeyboardBackspace';\n\nimport 'aframe';\nimport 'aframe-look-at-component';\n\nimport Scene from '../../aframe-components/Scene';\nimport { connect } from 'react-redux';\nimport { setCurrentRoom, setProject, setStory } from '../../redux/actions';\nimport { useContext, useEffect, useState } from 'react';\nimport { FirebaseContext } from '../../firebase';\nimport loadImageForRoom from '../../util/ImageLoader';\n\nconst styles = makeStyles(() => {\n    return {\n        backButtonContainer: {\n            position: 'fixed',\n            left: '24px',\n            top: '24px',\n            width: '48px',\n            height: '48px',\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'center',\n            backgroundColor: 'rgba(0,0,0,0.6)',\n            borderRadius: 24,\n        },\n        icon: {\n            color: 'rgba(255, 255, 255, 0.7)'\n        }\n    };\n});\nfunction ViewerRoute({project, setProjectAction, setStoryAction, setCurrentRoomAction}) {\n    const classes = styles();\n\n    const firebaseContext = useContext(FirebaseContext);\n\n    const [projectLoaded, setProjectLoaded] = useState(Boolean(project));\n\n    const history = useHistory();\n    const { projectId } = useParams();\n\n    const onBack = () => {\n        // Remove CSS styles injected by a-frame when going back to landing page/editor.\n        document.documentElement.classList.remove('a-fullscreen');\n\n        history.goBack();\n    }\n\n    useEffect(async () => {\n        if (!projectLoaded) {\n            const storageProject = await firebaseContext.loadProjectWithId(projectId);\n            const projectModel = await firebaseContext.loadProject(storageProject);\n\n            // Set newly loaded story (and first room) as active story in redux\n            setProjectAction(projectModel);\n            setStoryAction(projectModel.story);\n\n            await setHomeRoomAsCurrent(projectModel.story.rooms);\n\n            setProjectLoaded(true);\n        }\n        else {\n            setHomeRoomAsCurrent(project.story.rooms);\n        }\n    }, []);\n\n    const setHomeRoomAsCurrent = async (rooms) => {\n        let homeRoom = rooms.find((room) => {\n            return room.isHome;\n        });\n        if (!homeRoom) {\n            homeRoom = rooms[0];\n        }\n\n        await loadImageForRoom(homeRoom);\n\n        setCurrentRoomAction(homeRoom);\n    }\n\n    return (\n        projectLoaded &&\n        <>\n            <Scene />\n            <div className={classes.backButtonContainer}>\n                <IconButton onClick={onBack}>\n                    <ArrowBackIcon className={classes.icon} />\n                </IconButton>\n            </div>\n        </>\n    );\n}\n\nconst mapStateToProps = (state) => {\n    return {\n        project: state.project,\n    };\n};\n\nexport default connect(\n    mapStateToProps,\n    {\n        setProjectAction: setProject,\n        setStoryAction: setStory,\n        setCurrentRoomAction: setCurrentRoom,\n    },\n)(ViewerRoute);\n","// External libraries\nimport React from 'react';\nimport {\n    BrowserRouter as Router,\n    Switch,\n    Route,\n} from 'react-router-dom';\n\n// External UI Components\nimport CssBaseline from '@material-ui/core/CssBaseline';\n\n// Style\nimport { unstable_createMuiStrictModeTheme as createMuiTheme, ThemeProvider } from '@material-ui/core/styles';\n\n// Components\nimport LandingPageRoute from './components/landing-page/LandingPageRoute';\nimport EditorRoute from './components/editor/EditorRoute';\nimport ViewerRoute from './components/viewer/ViewerRoute';\n\nexport default function App() {\n    const theme = React.useMemo(\n        () => {\n            return createMuiTheme({\n                palette: {\n                    type: 'light',\n                    primary: {\n                        dark: '#de2e62',\n                        main: '#E34B78',\n                        light: '#e86f93',\n                    },\n                    secondary: {\n                        dark: '#333333',\n                        main: '#474747',\n                        light: '#C1C1C1',\n                    },\n                },\n                typography: {\n                    fontFamily: [\n                        'Inter',\n                        'sans-serif',\n                    ],\n                    button: {\n                        textTransform: 'none',\n                    },\n                    // Heading large\n                    h1: {\n                        fontSize: '20px',\n                        fontStyle: 'normal',\n                        fontWeight: 'bold',\n                        lineHeight: '24px',\n                    },\n                    // Heading medium\n                    h2: {\n                        fontSize: '16px',\n                        fontStyle: 'normal',\n                        fontWeight: 'bold',\n                        lineHeight: '20px',\n                    },\n                    // Text large\n                    body1: {\n                        fontSize: '20px',\n                        fontStyle: 'normal',\n                        fontWeight: 'normal',\n                        lineHeight: '24px',\n                    },\n                    // Text small\n                    body2: {\n                        fontSize: '14px',\n                        fontStyle: 'normal',\n                        fontWeight: 'normal',\n                        lineHeight: '20px',\n                    },\n                },\n            });\n        }, [],\n    );\n\n    return (\n        <div className=\"App\">\n            <ThemeProvider theme={theme}>\n                <CssBaseline />\n                <Router>\n                    <Switch>\n                        <Route path=\"/editor\" component={EditorRoute} />\n                        <Route path=\"/view/:projectId\" component={ViewerRoute} />\n                        <Route path=\"/\" component={LandingPageRoute} />\n                    </Switch>\n                </Router>\n            </ThemeProvider>\n        </div>\n    );\n}\n","import update from 'immutability-helper';\n\nimport { SET_USER, CLEAR_USER, SET_USER_DISPLAYNAME } from '../actionTypes';\n\nconst initialState = null;\n\nexport default function userReducer(state = initialState, action) {\n    switch (action.type) {\n    case SET_USER: {\n        return update(state, {\n            $set: action.payload.value,\n        });\n    }\n    case SET_USER_DISPLAYNAME: {\n        return update(state, {\n            displayName: {\n                $set: action.payload.value,\n            },\n        });\n    }\n    case CLEAR_USER: {\n        return update(state, {\n            $set: initialState,\n        });\n    }\n    default:\n        return state;\n    }\n}\n","import update from 'immutability-helper';\n\nimport { SET_IS_SHOWING_SIGNIN_DIALOG } from '../actionTypes';\n\nconst initialState = {\n    isShowingSignInDialog: false,\n};\n\nexport default function displayReducer(state = initialState, action) {\n    switch (action.type) {\n    case SET_IS_SHOWING_SIGNIN_DIALOG: {\n        return update(state, {\n            isShowingSignInDialog: { $set: action.payload.value },\n        });\n    }\n    default:\n        return state;\n    }\n}\n","import update from 'immutability-helper';\n\nimport { SET_USER_STORIES } from '../actionTypes';\n\nconst initialState = [];\n\nexport default function userStoriesReducer(state = initialState, action) {\n    switch (action.type) {\n    case SET_USER_STORIES: {\n        return update(state, {\n            $set: action.payload.value,\n        });\n    }\n    default:\n        return state;\n    }\n}\n","import update from 'immutability-helper';\n\nimport { SET_PUBLIC_STORIES } from '../actionTypes';\n\nconst initialState = [];\n\nexport default function publicStoriesReducer(state = initialState, action) {\n    switch (action.type) {\n    case SET_PUBLIC_STORIES: {\n        return update(state, {\n            $set: action.payload.value,\n        });\n    }\n    default:\n        return state;\n    }\n}\n","import { combineReducers } from 'redux';\n\nimport user from './user';\nimport display from './display';\nimport userStories from './user-stories';\nimport publicStories from './public-stories';\nimport project from './project';\nimport User from '../../models/user';\nimport Story from '../../models/story';\nimport Project from '../../models/project';\n\nexport interface RootState {\n    user: User;\n    display: {\n        isShowingSignInDialog: boolean;\n    };\n    userStories: Story[];\n    publicStories: Story[];\n    project: Project;\n}\n\nexport default combineReducers<RootState>({\n    user: user,\n    display: display,\n    userStories: userStories,\n    publicStories: publicStories,\n    project: project,\n});\n","import update from 'immutability-helper';\n\nimport {\n    SET_STORY,\n    SET_CURRENT_ROOM,\n    ADD_HOTSPOT,\n    ADD_ROOM,\n    SET_HOTSPOT_LOCATION,\n    ADD_DOOR,\n    SET_STORY_NAME,\n    SET_STORY_TAGS,\n    SET_STORY_SOUNDTRACK,\n    SET_PROJECT,\n    UPDATE_DOOR,\n    SET_ROOM_NAME,\n    SET_ROOM_BACKGROUND,\n    SET_HOTSPOT_NAME,\n    SET_HOTSPOT_TEXT,\n    SET_HOTSPOT_IMAGE,\n    SET_HOTSPOT_AUDIO,\n    SET_ROOM_BACKGROUND_MUSIC,\n    SET_ROOM_BACKGROUND_NARRATION,\n    SET_ROOM_IS_HOME,\n} from '../actionTypes';\n\nconst initialState = null;\n\nexport default function projectReducer(state = initialState, action) {\n    switch (action.type) {\n    case SET_PROJECT: {\n        return update(state, {\n            $set: action.payload.project,\n        });\n    }\n    case SET_STORY: {\n        return update(state, {\n            story: {\n                $set: action.payload.value,\n            },\n        });\n    }\n    case SET_CURRENT_ROOM: {\n        return update(state, {\n            story: {\n                rooms: {\n                    $set: state.story.rooms.map((room) => {\n                        if (room.id !== action.payload.room.id) {\n                            return {\n                                ...room,\n                                active: false,\n                            };\n                        }\n\n                        return {\n                            ...room,\n                            active: true,\n                        };\n                    }),\n                },\n            },\n        });\n    }\n    case ADD_HOTSPOT: {\n        return update(state, {\n            story: {\n                rooms: {\n                    $set: state.story.rooms.map((room) => {\n                        if (room.id === action.payload.roomId) {\n                            room.hotspots.push(action.payload.hotspot);\n                        }\n\n                        return room;\n                    }),\n                },\n            },\n        });\n    }\n    case ADD_DOOR: {\n        return update(state, {\n            story: {\n                rooms: {\n                    $set: state.story.rooms.map((room) => {\n                        if (room.id === action.payload.roomId) {\n                            room.doors.push(action.payload.door);\n                        }\n\n                        return room;\n                    }),\n                },\n            },\n        });\n    }\n    case ADD_ROOM: {\n        return update(state, {\n            story: {\n                rooms: {\n                    $push: [action.payload.room],\n                },\n            },\n        });\n    }\n    case SET_HOTSPOT_LOCATION: {\n        return update(state, {\n            story: {\n                rooms: {\n                    hotspots: state.story.rooms.hotspots((hotspot) => {\n                        if (hotspot.id === action.payload.hotspot.id) {\n                            return {\n                                ...hotspot,\n                                ...action.payload.hotspot,\n                            };\n                        }\n\n                        return hotspot;\n                    }),\n                },\n            },\n        });\n    }\n    case SET_STORY_NAME: {\n        return update(state, {\n            story: {\n                name: {\n                    $set: action.payload.name,\n                },\n            },\n        });\n    }\n    case SET_STORY_TAGS: {\n        return update(state, {\n            story: {\n                tags: {\n                    $set: action.payload.tags,\n                },\n            },\n        });\n    }\n    case SET_STORY_SOUNDTRACK: {\n        return update(state, {\n            story: {\n                soundtrack: {\n                    $set: action.payload.soundtrack,\n                },\n            },\n        });\n    }\n    case UPDATE_DOOR: {\n        const currentRoom = state.story.getActiveRoom();\n\n        const doorRoom = state.story.rooms.find((room) => {\n            return room.id === currentRoom.id;\n        });\n\n        return update(state, {\n            story: {\n                rooms: {\n                    doors: {\n                        $set: doorRoom.doors.map((door) => {\n                            if (door.id === action.payload.door.id) {\n                                return {\n                                    ...door,\n                                    ...action.payload.door,\n                                };\n                            }\n\n                            return door;\n                        }),\n                    },\n                },\n            },\n        });\n    }\n    case SET_ROOM_NAME: {\n        return update(state, {\n            story: {\n                rooms: {\n                    $set: state.story.rooms.map((room) => {\n                        if (room.id !== action.payload.roomId) {\n                            return room;\n                        }\n\n                        return {\n                            ...room,\n                            name: action.payload.name,\n                        };\n                    }),\n                },\n            },\n        });\n    }\n    case SET_ROOM_IS_HOME: {\n        return update(state, {\n            story: {\n                rooms: {\n                    $set: state.story.rooms.map((room) => {\n                        if (room.id !== action.payload.roomId) {\n                            return {\n                                ...room,\n                                isHome: false,\n                            };\n                        }\n\n                        return {\n                            ...room,\n                            isHome: action.payload.isHome,\n                        };\n                    }),\n                },\n            },\n        });\n    }\n    case SET_ROOM_BACKGROUND: {\n        const currentRoom = state.story.getActiveRoom();\n\n        return update(state, {\n            story: {\n                rooms: {\n                    $set: state.story.rooms.map((room) => {\n                        if (room.id !== currentRoom.id) {\n                            return room;\n                        }\n\n                        return {\n                            ...room,\n                            panoramaUrl: {\n                                ...room.panoramaUrl,\n                                backgroundImage: {\n                                    ...room.panoramaUrl.backgroundImage,\n                                    data: action.payload.background,\n                                },\n                                thumbnail: {\n                                    ...room.panoramaUrl.thumbnail,\n                                    data: action.payload.thumbnail,\n                                },\n                            },\n                        };\n                    }),\n                },\n            },\n        });\n    }\n    case SET_ROOM_BACKGROUND_MUSIC: {\n        return update(state, {\n            story: {\n                rooms: {\n                    $set: state.story.rooms.map((room) => {\n                        if (room.id !== action.payload.roomId) {\n                            return room;\n                        }\n\n                        return {\n                            ...room,\n                            backgroundMusic: {\n                                ...room.backgroundMusic,\n                                data: action.payload.data,\n                                fileName: action.payload.name,\n                                extension: action.payload.extension,\n                                loop: action.payload.loop,\n                                volume: action.payload.volume\n                            },\n                        };\n                    }),\n                },\n            },\n        });\n    }\n    case SET_ROOM_BACKGROUND_NARRATION: {\n        return update(state, {\n            story: {\n                rooms: {\n                    $set: state.story.rooms.map((room) => {\n                        if (room.id !== action.payload.roomId) {\n                            return room;\n                        }\n\n                        return {\n                            ...room,\n                            backgroundNarration: {\n                                ...room.backgroundNarration,\n                                data: action.payload.data,\n                                fileName: action.payload.name,\n                                extension: action.payload.extension,\n                                loop: action.payload.loop,\n                                volume: action.payload.volume\n                            },\n                        };\n                    }),\n                },\n            },\n        });\n    }\n    case SET_HOTSPOT_NAME: {\n        const currentRoom = state.story.getActiveRoom();\n        const currentRoomIndex = state.story.rooms.indexOf(currentRoom);\n\n        return update(state, {\n            story: {\n                rooms: {\n                    [currentRoomIndex]: {\n                        hotspots: {\n                            $set: currentRoom.hotspots.map((hotspot) => {\n                                if (hotspot.id !== action.payload.hotspotId) {\n                                    return hotspot;\n                                }\n\n                                return {\n                                    ...hotspot,\n                                    label: action.payload.name,\n                                };\n                            }),\n                        },\n                    },\n                },\n            },\n        });\n    }\n    case SET_HOTSPOT_TEXT: {\n        const currentRoom = state.story.getActiveRoom();\n        const currentRoomIndex = state.story.rooms.indexOf(currentRoom);\n\n        return update(state, {\n            story: {\n                rooms: {\n                    [currentRoomIndex]: {\n                        hotspots: {\n                            $set: currentRoom.hotspots.map((hotspot) => {\n                                if (hotspot.id !== action.payload.hotspotId) {\n                                    return hotspot;\n                                }\n\n                                return {\n                                    ...hotspot,\n                                    text: action.payload.text,\n                                };\n                            }),\n                        },\n                    },\n                },\n            },\n        });\n    }\n    case SET_HOTSPOT_IMAGE: {\n        const currentRoom = state.story.getActiveRoom();\n        const currentRoomIndex = state.story.rooms.indexOf(currentRoom);\n\n        return update(state, {\n            story: {\n                rooms: {\n                    [currentRoomIndex]: {\n                        hotspots: {\n                            $set: currentRoom.hotspots.map((hotspot) => {\n                                if (hotspot.id !== action.payload.hotspotId) {\n                                    return hotspot;\n                                }\n\n                                return {\n                                    ...hotspot,\n                                    image: {\n                                        ...hotspot.image,\n                                        extension: action.payload.extension,\n                                        data: action.payload.imageData,\n                                    },\n                                };\n                            }),\n                        },\n                    },\n                },\n            },\n        });\n    }\n    case SET_HOTSPOT_AUDIO: {\n        const currentRoom = state.story.getActiveRoom();\n        const currentRoomIndex = state.story.rooms.indexOf(currentRoom);\n\n        return update(state, {\n            story: {\n                rooms: {\n                    [currentRoomIndex]: {\n                        hotspots: {\n                            $set: currentRoom.hotspots.map((hotspot) => {\n                                if (hotspot.id !== action.payload.hotspotId) {\n                                    return hotspot;\n                                }\n\n                                return {\n                                    ...hotspot,\n                                    audio: {\n                                        ...hotspot.audio,\n                                        fileName: action.payload.name,\n                                        extension: action.payload.extension,\n                                        data: action.payload.data,\n                                        loop: action.payload.loop,\n                                        volume: action.payload.volume\n                                    },\n                                };\n                            }),\n                        },\n                    },\n                },\n            },\n        });\n    }\n    default:\n        return state;\n    }\n}\n","import { createStore } from 'redux';\nimport rootReducer from './reducers';\n\nexport default createStore(rootReducer);\n","import AFRAME from 'aframe';\n\nimport { getCoordinatePosition } from '../../util/IconPosition';\n\nAFRAME.registerComponent('hotspot', {\n    schema: {\n        coordinates: {\n            type: 'string',\n            parse: (val) => {\n                const [x, y] = val.split(' ');\n                return getCoordinatePosition(parseInt(x, 10), parseInt(y, 10));\n            },\n        },\n        isAudioOnly: {\n            type: 'boolean',\n        },\n    },\n    hideHotspot: function hideHotspot() {\n        this.el.setAttribute('visible', false);\n    },\n    showHotspot: function showHotspot() {\n        this.el.setAttribute('visible', true);\n    },\n    showOtherHotspots: function showOtherHotspots() {\n        this.el.sceneEl.querySelectorAll('.hotspot, .door')\n            .forEach((el) => {\n                return el.emit('show');\n            });\n    },\n    hideOtherHotspots: function hideOtherHotspots() {\n        this.el.sceneEl.querySelectorAll('.hotspot, .door')\n            .forEach((el) => {\n                return el !== this.el && el.emit('hide');\n            });\n    },\n    showHotspotName: function showHotspotName() {\n        this.hotspotName.setAttribute('visible', true);\n        console.log('show');\n    },\n    hideHotspotName: function hideHotspotName() {\n        this.hotspotName.setAttribute('visible', false);\n        console.log('hide')\n    },\n    init: function init() {\n        const { x, y, z } = this.data.coordinates;\n\n        // If content revealed, then it should be\n        // hidden after clear intersection of content zone\n        this.contentIsActive = false;\n\n        // Setting up position of hotspot\n        this.el.object3D.position.set(x, y, z);\n\n        // Caching triggers\n        this.centerTrigger = this.el.querySelector('.center-trigger');\n        this.outerTrigger = this.el.querySelector('.outer-trigger');\n        this.contentZoneTrigger = this.el.querySelector('.content-zone-trigger');\n\n        // Caching elements\n        this.hotspotContent = this.el.querySelector('[hotspot-content]');\n        this.hiddenMarker = this.el.querySelector('[hidden-marker]');\n        this.pulsatingMarker = this.el.querySelector('[pulsating-marker]');\n        this.hotspotName = this.el.querySelector('.hotspot-name');\n\n        // Binding current scope to event`s callbacks\n        this.hideHotspot = this.hideHotspot.bind(this);\n        this.showHotspot = this.showHotspot.bind(this);\n\n        // Adding event listeners\n        this.el.addEventListener('hide', this.hideHotspot);\n        this.el.addEventListener('show', this.showHotspot);\n\n        this.outerTrigger.addEventListener('raycaster-intersected', () => {\n            this.pulsatingMarker.emit('scale-out');\n            this.hiddenMarker.emit('fade-in');\n            this.showHotspotName();\n        });\n\n        this.outerTrigger.addEventListener('raycaster-intersected-cleared', () => {\n            this.pulsatingMarker.emit('scale-in');\n            this.hiddenMarker.emit('fade-out');\n            this.hideHotspotName();\n        });\n\n        this.centerTrigger.addEventListener('raycaster-intersected', () => {\n            if (this.contentIsActive) return;\n\n            this.contentIsActive = true;\n\n            if (!this.data.isAudioOnly) {\n                this.hiddenMarker.emit('fade-out');\n            }\n\n            this.pulsatingMarker.emit('scale-out');\n            this.hotspotContent.emit('show-content');\n            this.hideOtherHotspots();\n            this.hideHotspotName();\n        });\n\n        this.contentZoneTrigger.addEventListener('raycaster-intersected-cleared', () => {\n            if (!this.data.isAudioOnly) {\n                this.hiddenMarker.emit('fade-in');\n            }\n            this.hotspotContent.emit('hide-content');\n            this.showOtherHotspots();\n            this.showHotspotName();\n            this.contentIsActive = false;\n        });\n        this.el.emit('hide');\n        setTimeout(() => {\n            this.el.emit('show');\n        }, 200);\n    },\n});\n","import AFRAME from 'aframe';\n\nAFRAME.registerComponent('pulsating-marker', {\n    init: function init() {\n        this.scaleIn = this.scaleIn.bind(this);\n        this.scaleOut = this.scaleOut.bind(this);\n\n        this.pulsatingHotspot = this.el.querySelector('a-image');\n\n        this.el.addEventListener('scale-in', this.scaleIn);\n        this.el.addEventListener('scale-out', this.scaleOut);\n    },\n    scaleIn: function scaleIn() {\n        const { pulsatingHotspot } = this;\n        const vectorFrom = pulsatingHotspot.getAttribute('scale').clone();\n\n        pulsatingHotspot.emit('stop-scale-out');\n        pulsatingHotspot.setAttribute('animation__scale-in', 'from', vectorFrom);\n        pulsatingHotspot.emit('start-scale-in');\n    },\n    scaleOut: function scaleOut() {\n        const { pulsatingHotspot } = this;\n        const vectorFrom = pulsatingHotspot.getAttribute('scale').clone();\n\n        pulsatingHotspot.emit('stop-scale-in');\n        pulsatingHotspot.setAttribute('animation__scale-out', 'from', vectorFrom);\n        pulsatingHotspot.emit('start-scale-out');\n    },\n});\n","import AFRAME from 'aframe';\n\nAFRAME.registerComponent('hidden-marker', {\n    init: function init() {\n        const { el } = this;\n        this.fadeIn = this.fadeIn.bind(this);\n        this.fadeOut = this.fadeOut.bind(this);\n\n        el.addEventListener('fade-in', this.fadeIn);\n        el.addEventListener('fade-out', this.fadeOut);\n    },\n    fadeOut: function fadeOut() {\n        this.el.emit('stop-fade-in');\n        this.el.emit('start-fade-out');\n    },\n    fadeIn: function fadeIn() {\n        this.el.emit('stop-fade-out');\n        this.el.emit('start-fade-in');\n    },\n});\n","import AFRAME from 'aframe';\n\nAFRAME.registerComponent('hotspot-content', {\n    animationScaleOut: {\n        property: 'scale',\n        from: '1 1 1',\n        to: '.001 .001 .001',\n        startEvents: 'start-scale-out',\n        pauseEvents: 'stop-scale-out',\n        easing: 'easeInQuart',\n    },\n    animationScaleIn: {\n        property: 'scale',\n        from: '.001 .001 .001',\n        to: '1 1 1',\n        startEvents: 'start-scale-in',\n        pauseEvents: 'stop-scale-in',\n        easing: 'easeInQuart',\n    },\n    init: function init() {\n        const { el } = this;\n\n        this.soundElement = this.el.querySelector('a-sound');\n        this.imageElement = this.el.querySelector('a-image');\n\n        el.addEventListener('show-content', this.showContent.bind(this));\n        el.addEventListener('hide-content', this.hideContent.bind(this));\n\n        el.setAttribute('animation__scale-in', this.animationScaleIn);\n        el.setAttribute('animation__scale-out', this.animationScaleOut);\n\n        el.addEventListener('animationcomplete', (e) => {\n            if (e.detail.name === 'animation__scale-out') {\n                this.imageElement.setAttribute('visible', false);\n            }\n        });\n\n        el.addEventListener('animationbegin', (e) => {\n            if (e.detail.name === 'animation__scale-in') {\n                this.imageElement.setAttribute('visible', true);\n            }\n        });\n    },\n    showContent: function showContent() {\n        const { el, soundElement } = this;\n\n        if (soundElement) {\n            el.sceneEl.emit('pause-narration-audio');\n            soundElement.components.sound.playSound();\n        }\n\n        if (!this.imageElement) return;\n\n        const vectorFrom = el.getAttribute('scale').clone();\n\n        el.setAttribute('animation__scale-in', 'from', vectorFrom);\n        el.emit('start-scale-in');\n    },\n    hideContent: function hideContent() {\n        const { el, soundElement } = this;\n\n        if (soundElement) {\n            el.sceneEl.emit('play-narration-audio');\n            soundElement.components.sound.stopSound();\n        }\n\n        if (!this.imageElement) return;\n\n        const vectorFrom = el.getAttribute('scale').clone();\n\n        el.setAttribute('animation__scale-out', 'from', vectorFrom);\n        el.emit('start-scale-out');\n    },\n});\n","import AFRAME from 'aframe';\n\nAFRAME.registerComponent('door-pulsating-marker', {\n    init: function init() {\n        const { el } = this;\n\n        this.scaleIn = this.scaleIn.bind(this);\n        this.scaleOut = this.scaleOut.bind(this);\n\n        this.pulsatingHotspot = this.el.querySelector('a-image');\n\n        el.addEventListener('scale-in', this.scaleIn);\n        el.addEventListener('scale-out', this.scaleOut);\n    },\n    scaleIn: function scaleIn() {\n        const { pulsatingHotspot } = this;\n        const vectorFrom = pulsatingHotspot.getAttribute('scale').clone();\n\n        pulsatingHotspot.emit('stop-scale-out');\n        pulsatingHotspot.setAttribute('animation__scale-in', 'from', vectorFrom);\n        pulsatingHotspot.emit('start-scale-in');\n    },\n    scaleOut: function scaleOut() {\n        const { pulsatingHotspot } = this;\n        const vectorFrom = pulsatingHotspot.getAttribute('scale').clone();\n\n        pulsatingHotspot.emit('stop-scale-in');\n        pulsatingHotspot.setAttribute('animation__scale-out', 'from', vectorFrom);\n        pulsatingHotspot.emit('start-scale-out');\n    },\n});\n","import AFRAME from 'aframe';\n\nimport { getCoordinatePosition } from '../../util/IconPosition';\n\nconst DEFAULT_TRANSITION_TIME = 700;\n\nAFRAME.registerComponent('door', {\n    schema: {\n        coordinates: {\n            type: 'string',\n            parse: function parse(val) {\n                const [x, y] = val.split(' ');\n                return getCoordinatePosition(parseInt(x, 10), parseInt(y, 10));\n            },\n        },\n        autoTime: {\n            type: 'number',\n            parse: function parse(val) {\n                if (val === 0) {\n                    return DEFAULT_TRANSITION_TIME;\n                }\n                return val * 1000;\n            },\n        },\n        roomId: {\n            type: 'string',\n        },\n    },\n    hideDoorway: function hideDoorway() {\n        this.el.setAttribute('visible', false);\n    },\n    showDoorway: function showDoorway() {\n        this.el.setAttribute('visible', true);\n    },\n    init: function init() {\n        const { x, y, z } = this.data.coordinates;\n\n        // Setting up position of hotspot\n        this.el.object3D.position.set(x, y, z);\n\n        // If this is true, then on completion\n        // of fading-in user should be teleported\n        this.inTransitionProcess = false;\n\n        const centerDoorwayTrigger = this.el.querySelector('.center-door-trigger');\n        const outerDoorwayTrigger = this.el.querySelector('.outer-door-trigger');\n        const hotspotName = this.el.querySelector('.hotspot-name');\n        const hiddenMarker = this.el.querySelector('[hidden-marker]');\n        const doorwayPulsatingMarker = this.el.querySelector('[door-pulsating-marker]');\n\n        hiddenMarker.setAttribute('animation__fade-out', 'dur', 5000);\n\n        this.hideDoorway = this.hideDoorway.bind(this);\n        this.showDoorway = this.showDoorway.bind(this);\n\n        // Adding event listeners\n        this.el.addEventListener('hide', this.hideDoorway);\n        this.el.addEventListener('show', this.showDoorway);\n\n        outerDoorwayTrigger.addEventListener('raycaster-intersected', () => {\n            doorwayPulsatingMarker.emit('scale-out');\n            hiddenMarker.emit('fade-in');\n            hotspotName.setAttribute('visible', true);\n        });\n\n        outerDoorwayTrigger.addEventListener('raycaster-intersected-cleared', () => {\n            doorwayPulsatingMarker.emit('scale-in');\n            hiddenMarker.emit('fade-out');\n            hotspotName.setAttribute('visible', false);\n        });\n\n        hiddenMarker.addEventListener('animationcomplete', (e) => {\n            if (e.detail.name === 'animation__fade-out' && this.inTransitionProcess) {\n                this.el.sceneEl.emit('switch-room-smoothly', { roomId: this.data.roomId });\n            }\n        });\n\n        centerDoorwayTrigger.addEventListener('raycaster-intersected', () => {\n            this.inTransitionProcess = true;\n            // Setting timeout of teleportation\n            hiddenMarker.setAttribute('animation__fade-out', 'dur', DEFAULT_TRANSITION_TIME);\n            hiddenMarker.emit('fade-out');\n        });\n\n        centerDoorwayTrigger.addEventListener('raycaster-intersected-cleared', () => {\n            this.inTransitionProcess = false;\n            // Rollback timeout to default value\n            hiddenMarker.setAttribute('animation__fade-out', 'dur', DEFAULT_TRANSITION_TIME);\n        });\n    },\n});\n","import AFRAME from 'aframe';\n\nimport Vector3 from '../../util/Vector3';\n\nAFRAME.registerComponent('preview-space', {\n    init: function init() {\n        const { el } = this;\n        this.camera = el.querySelector('a-camera');\n        this.cursor = this.camera.querySelector('a-cursor');\n        this.countdown = el.querySelector('[preview-countdown]');\n        this.enterVR = el.querySelector('.a-enter-vr');\n\n        el.addEventListener('run-countdown', () => {\n            return this.countdown.emit('run');\n        });\n\n        el.addEventListener('show-countdown', () => {\n            this.countdown.setAttribute('visible', true);\n        });\n\n        el.addEventListener('hide-countdown', () => {\n            this.countdown.setAttribute('visible', false);\n        });\n\n        this.camera.addEventListener('animationcomplete', (e) => {\n            if (e.detail.name === 'animation__zoom-in') {\n                this.switchRoom(this.roomId);\n            }\n        });\n\n        ['narration', 'background', 'soundtrack'].forEach((type) => {\n            el.addEventListener(`touch-${type}-audio`, () => {\n                const audio = el.querySelector(`.${type}-audio`);\n                if (audio) {\n                    const volume = audio.getAttribute('volume');\n                    audio.setAttribute('volume', 0);\n                    audio.components.sound.playSound();\n                    setTimeout(() => {\n                        audio.components.sound.pauseSound();\n                        audio.setAttribute('volume', volume);\n                    }, 0);\n                }\n            });\n\n            el.addEventListener(`pause-${type}-audio`, () => {\n                const audio = el.querySelector(`.${type}-audio`);\n                if (audio) {\n                    audio.setAttribute('paused', true);\n                    audio.components.sound.pauseSound();\n                }\n            });\n\n            el.addEventListener(`play-${type}-audio`, () => {\n                const audio = el.querySelector(`.${type}-audio`);\n                if (audio && audio.getAttribute('played-once') !== 'true') {\n                    audio.setAttribute('paused', false);\n                    audio.components.sound.playSound();\n                }\n            });\n        });\n\n        el.addEventListener('touch-all-audio', () => {\n            el.emit('touch-narration-audio');\n            el.emit('touch-soundtrack-audio');\n            el.emit('touch-background-audio');\n        });\n\n        el.addEventListener('play-all-audio', () => {\n            el.emit('play-narration-audio');\n            el.emit('play-soundtrack-audio');\n            el.emit('play-background-audio');\n        });\n\n        el.addEventListener('pause-all-audio', () => {\n            el.emit('pause-narration-audio');\n            el.emit('pause-soundtrack-audio');\n            el.emit('pause-background-audio');\n        });\n\n        el.addEventListener('switch-room-last', () => {\n            this.switchRoom('last');\n        });\n\n        el.addEventListener('switch-room-home', () => {\n            this.switchRoom('home');\n        });\n\n        el.addEventListener('switch-room-smoothly', (e) => {\n            this.roomId = e.detail.roomId;\n            this.zoomCamera();\n        });\n\n        el.addEventListener('reset-camera', () => {\n            this.resetCamera();\n        });\n    },\n    resetCamera: function resetCamera() {\n        this.camera.setAttribute('zoom', 1);\n        this.cursor.setAttribute('scale', new Vector3(1, 1, 1));\n    },\n    zoomCamera: function zoomCamera() {\n        this.camera.emit('start-zoom-in');\n        this.cursor.emit('start-scale-out');\n    },\n    switchRoom: function switchRoom(roomId) {\n        const onceAudio = this.el.querySelector('.narration-audio');\n\n        if (onceAudio) {\n            onceAudio.setAttribute('played-once', 'false');\n        }\n\n        this.el.emit('switch-room', roomId);\n    },\n});\n","import AFRAME from 'aframe';\n\nAFRAME.registerComponent('play-once', {\n    init: function init() {\n        this.el.addEventListener('sound-ended',() => {\n            var offset = this.el.components.sound.pool.children[0].offset;\n\n            if(offset === 0 || this.el.getAttribute('paused') === \"false\") {\n                this.el.setAttribute('played-once', true)\n            }\n        })\n    }\n})\n","// External libraries\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux';\n\n// Global style\nimport './index.css';\n\n// Components\nimport App from './app';\n\n// Store\nimport store from './redux/store';\n\n// Database\nimport { FirebaseContext, firebase } from './firebase/index';\n\n// AFrame Components\nimport './aframe-components/aframe/Hotspot';\nimport './aframe-components/aframe/PulsatingMarker';\nimport './aframe-components/aframe/HiddenMarker';\nimport './aframe-components/aframe/HotspotContent';\nimport './aframe-components/aframe/DoorPulsatingMarker';\nimport './aframe-components/aframe/Door';\nimport './aframe-components/aframe/PreviewSpace';\nimport './aframe-components/aframe/PlayOnce';\n\nReactDOM.render(\n    <React.StrictMode>\n        <Provider store={store}>\n            <FirebaseContext.Provider value={firebase}>\n                <App />\n            </FirebaseContext.Provider>\n        </Provider>\n    </React.StrictMode>,\n    document.getElementById('root'),\n);\n"],"sourceRoot":""}